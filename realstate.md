# Laravel 10 - Build Real Estate Property Listing Project A-Z
Kazi Ariyan

# Estructura para Laravel Real Estate

# Sección 3 - Multi Auth with Breeze
- 08. Instalar Laravel 10
- 09. Create Database
- 10. Install Laravel Breeze
- 11. Seed Demo User Part 1
- 12. Seed Demo User Part 2
- 13. Multi Auth Breeze Part 1
- 14. Multi Auth Breeze Part 2
- 15. Multi Auth Breeze Part 3
- 16. Login With Name Email or Phone

# Sección 4 - Project Admin Panel Setup
- 17. Project Theme Overview
- 18. Admin Template Setup
- 19. Dashboard Page Segmentation
- 20. Admin Logout Option
- 21. Customize Login Form
- 22. Refresh Admin Template
- 23. Update Admin Assets Path
- 24. Admin Profile & Image Update Part 1
- 25. Admin Profile & Image Update Part 2
- 26. Admin Profile & Image Update Part 3
- 27. Admin Profile & Image Update Part 4
- 28. Adding Toaster In For View Message
- 29. Admin Profile Change Password Part 1
- 30. Admin Profile Change Password Part 2
- 31. Take Backup And Restore in Localhost

# Sección 5 - Project Frontend Template Setup
- 32. Frontend Template Setup Part 1
- 33. Frontend Template Setup Part 2
- 34. Frontend Template Setup Part 3
- 35. Frontend Template Login Page Setup
- 36. Frontend Template Register Page Setup

# Sección 6 - Project Frontend User Profile Setup
- 37. User Profile Design Part 1
- 38. User Profile Design Part 2
- 39. User Profile Design Part 3
- 40. User Logout Option
- 41. User Profile Password Change
- 42. Update User Login Setup with and without Login
- 43. User Login and Logout Notification

# Sección 7 - Project Backend Property Type Setup
## 44. Property Type Crud Part 1
## 45. Property Type Crud Part 2
## 46. Property Type Crud Part 3
## 47. Property Type Crud Part 4
## 48. Property Type Crud Part 5

# Sección 8 - Project Backend Property Amenities
## 49. Amenities Crud Part 1
## 50. Add Validation Message
## 51. Amenities Crud Part 2

# Sección 9 - Backend Add Property Page Design
## 52. Add Property Database Design Part 1 
## 53. Add Property Database Design Part 2
## 54. Add Property Database and Page Design Part 1
## 55. Add Property Database and Page Design Part 2
## 56. Show Image Using Javascript
## 57. Add Property Database and Page Design Part 5
## 58. Add Property Database and Page Design Part 6
## 59. Add Property Database and Page Design Part 7
## 60. Add Property Database and Page Design Part 8
## 61. Add Property JavaScript Validation

# Sección 10 - Backend Insert Property Setup 
## 62. Install Image Intervention Package
## 63. Property Insert Database Part 1
## 64. Property Insert Database Part 2
## 65. Property Insert Database Part 3
## 66. Property Insert Database Part 4
## 67. Manage Property Read All Product
## 68. Manage Property Edit Option Part 1
## 69. Manage Property Edit Option Part 2
## 70. Manage Property Update Option
## 71. Manage Property Update Single and Multiple Image Part 1
## 72. Manage Property Update Single and Multiple Image Part 2
## 73. Manage Property Update Single and Multiple Image Part 3
## 74. Manage Property Update Single and Multiple Image Part 4
## 75. Multiple Image Delete
## 76. Add Multi Image In Property
## 77. Manage Property Update Facility Part 1
## 78. Manage Property Update Facility Part 2
## 79. Property Delete With Multiple Image
## 80. Create Property Details Page Part 1
## 81. Create Property Details Page Part 2
## 82. Property Active Inactive From Details Page
## 83. Bug Fixed for Redirect Login Page

# Sección 11 - Add Agent Register Page Setup
## 84. Add Agent Register Page Setup Part 1
## 85. Add Agent Register Page Setup Part 2

# Sección 12 - Project Agent Panel Setup
## 86. Agent Template Setup
## 87. Agent Logout Option
## 88. Agent Profile & Image Update
## 89. Agent Profile Change Password

# Sección 13 - Manage Agent In Admin Dashboard
## 90. Manage Agent In admin Page Part 1 
## 91. Manage Agent In admin Page Part 2
## 92. Manage Agent In admin Page Part 3
## 93. Active Inactive In Agent Dashboard
## 94. Active Inactive Agent From Admin Page

# Sección 14 - Backend Add Property From Agent
## 95. Add Property From Agent Part 1
## 96. Add Property From Agent Part 2
## 97. Add Property From Agent Part 3
## 98. Add Property From Agent Part 4
## 99. Add Property From Agent Part 5
## 100. Update Add Property Amenities Fields

# Sección 15 - Backend Agent Buy Packages Option
## 101. Design Buy Package Agent Dashboard
## 102. Agent Buy Package Option Part 1
## 103. Agent Buy Package Option Part 2
## 104. Agent Buy Package Option Part 3
## 105. Agent Buy Package Option Part 4
## 106. Agent Buy Package Option Part 5

# Sección 16 - Package Sales Report In Agent Dashboard With PDF
## 107. Package sales Report In Agent Dashboard Part 1
## 108. Package sales Report In Agent Dashboard Part 2
## 109. Package sales Report In Agent Dashboard Part 3 

# Sección 17 - Package Sales Report In Admin Dashboard With PDF
## 110. Package Sales Report In Admin Dashboard Part 1
## 111. Package Sales Report In Admin Dashboard Part 2

# Sección 18 - Display Property Type In Frontend
## 112. Show Property Type In Frontend Part 1
## 113. Show Property Type In Frontend Part 2

# Sección 19 - Display Features Property In Frontend 
## 114. Show Features Property In Frontend Part 1
## 115. Show Features Property In Frontend Part 2

# Sección 20 - Setup Property Details Page 
## 116. Setup Property Details Page Part 1
## 117. Setup Property Details Page Part 2
## 118. Setup Property Details Page Part 3
## 119. Setup Property Details Page Part 4
## 120. Setup Property Details Page Part 5
## 121. Setup Property Details Related Page

# Sección 21 - Setup Property Wishlist Option
## 122. Property Wishlist Setup Part 1
## 123. Property Wishlist Setup Part 2
## 124. Property Wishlist Setup Part 3
## 125. Property Wishlist Setup Part 4
## 126. Property Wishlist Setup Part 5
## 127. Property Wishlist Setup Part 6
## 128. Property Wishlist Setup Part 7

# Sección 22 - Setup Property Compare Option 
- 129. Property Compare Setup Part 1
- 130. Property Compare Setup Part 2
- 131. Property Compare Setup Part 3
- 132. Property Compare Setup Part 4

# Sección 23 - Setup Send Message From Details Page
- 133. Send Message To agent Part 1
- 134. Send Message To agent Part 2
- 135. Send Message To agent Part 3

# Sección 24 - Setup Property Message In Agent Dashboard 
- 136. Send Message To Agent Part 1
- 137. Send Message To Agent Part 2
- 138. Send Message To Agent Part 3
- 139. Show Message In Admin Dashboard

# Sección 25 - Property Agent Page In Frontend
- 140. Display Agent Page in Frontend
- 141. Display Agent Details Page Part 1
- 142. Display Agent Details Page Part 2
- 143. Display Agent Details Page Part 3
- 144. Display Agent Details Page Part 4

# Sección 26 - Setup Property Buy and Rent List Page
- 145. Property Rent List Part 1
- 146. Property Rent List Part 2
- 147. Property Buy List
- 148. Get Type Wise Property
- 149. Update Header Menu

# Sección 27 - Create Custom Pagination 
- 150. Add Custom Pagination Part 1
- 151. Add Custom Pagination Part 2

# Sección 28 - Display Hot Latest Property In Frontend 
- 152. Show Hot Property in Frontend

# Sección 29 - Work For Property Location By State In Admin 
- 153. Property Location By State in Admin Part 1
- 154. Property Location By State in Admin Part 2
- 155. Property Location By State in Admin Part 3
- 156. Property Location By State in Admin Part 4
- 157. Update Admin Add and Edit Property for State Part 1
- 158. Update Admin Add and Edit Property for State Part 2
- 159. Update Agent Add and Edit Property for State

# Sección 30 - Property Location Area In Frontend
- 160. Property Location Area in Frontend Part 1
- 161. Property Location Area in Frontend Part 2
- 162. Property Location Area in Frontend Part 3

# Sección 31 - Property Search Option In Home Page 
- 163. Property Search Option in Home Page Part 1
- 164. Property Search Option in Home Page Part 2
- 165. Property Search Option in Home Page Part 3

# Sección 32 - Property Search Option In Category Page
- 166. Property Search Option in Category Page

# Sección 33 - Setup Testimonials From Admin Backend
- 167. Setup Testimonials from Admin Part 1
- 168. Setup Testimonials from Admin Part 2
- 169. Setup Testimonials from Admin Part 3
- 170. Setup Testimonials in Frontend

# Sección 34 - Admin Blog Category Setup
- 171. Advance Blog Category Setup Part 1
- 172. Advance Blog Category Setup Part 2
- 173. Advance Blog Category Setup Part 3
- 174. Advance Blog Category Setup Part 4

# Sección 35 - Admin Blog Management Setup
- 175. Blog Post Setup Part 1
- 176. Blog Post Setup Part 2
- 177. Blog Post Setup Part 3
- 178. Blog Post Setup Part 4

# Sección 36 - Show Blog In Front Page
- 179. Show Blog in Frontend Page Part 1
- 180. Show Blog in Frontend Page Part 2
- 181. Show Blog in Frontend Page Part 3

# Sección 37 - Category Wise Blog List Page
- 182. Show Blog Category List Page
- 183. Show Blog List Page

# Sección 38 - Blog Comment Function Frontend Page
- 184. Show Blog Comment in Frontend Page Part 1
- 185. Show Blog Comment in Frontend Page Part 2

# Sección 39 - Blog Comment Function Backend With Replay
- 186. Comment Function Backend With Replay Part 1
- 187. Comment Function Backend With Replay Part 2
- 188. Comment Function Backend With Replay Part 3

# Sección 40 - Schedule a Tour Setup for Property
- 189. Property Schedule a Tour Setup Part 1
- 190. Property Schedule a Tour Setup Part 2

# Sección 41 - Schedule a Tour Setup In Admin With Email
- 191. Schedule a Tour in Admin With Email Part 1
- 192. Schedule a Tour in Admin With Email Part 2
- 193. Schedule a Tour in Admin With Email Part 3
- 194. Schedule a Tour in Admin With Email Part 4
- 195. Schedule a Tour in Admin With Email Part 5

# Sección 42 - Dynamic Email Configuration In Laravel Edit env
- 196. Dynamic Email Configuration Part 1
- 197. Dynamic Email Configuration Part 2
- 198. Dynamic Email Configuration Part 3

# Sección 43 - Property Schedule in User Dashboard
- 199. Schedule in User Dashboard Part 1
- 200. Schedule in User Dashboard Part 2

# Sección 44 - Site Setting Option Update
- 201. Site Setting Option Part 1
- 202. Site Setting Option Part 2
- 203. Site Setting Option Part 3
- 204. Update Custom Title

# Sección 45 - Setup User Permission
- 205. User Permission Introduction
- 206. Install Laravel Spatie Permission
- 207. Setup User Permission Part 1
- 208. Setup User Permission Part 2
- 209. Setup User Permission Part 3

# Sección 46 - Permission Import and Export From Excel File
- 210. Install Laravel Excel Package in Project
- 211. How to Import and Export Permission Part 1
- 212. How to Import and Export Permission Part 2
- 213. How to Import and Export Permission Part 3

# Sección 47 - Setup User Roles 
- 214. Setup User Roles Part 1
- 215. Setup User Roles Part 2
- 216. Add Roles in Permission Part 1
- 217. Add Roles in Permission Part 2
- 218. Add Roles in Permission Part 3
- 219. Add Roles in Permission Part 4
- 220. Add Roles in Permission Part 5
- 221. Add Roles in Permission Part 6
- 222. Edit Roles in Permission Part 1
- 223. Edit Roles in Permission Part 2
- 224. Delete Roles in Permission

# Sección 48 - Multi Admin For Store 
- 225. Multi Admin Setup Part 1
- 226. Multi Admin Setup Part 2
- 227. Multi Admin Setup Part 3
- 228. Multi Admin Setup Part 4

# Sección 49 - Add Role And Permission in Sidebar
- 229. Add Role and Permission for Admin User Part 1
- 230. Add Role and Permission for Admin User Part 2

# Sección 50 - Create 404 and 403 Page
- 231. How to Create 404 Page
- 232. How to Create 403 Page

# Sección 51 - Live Chat Application System For User and Agent
- 233. Live Chat Application Introduction
- 234. Live Chat Application Part 1
- 235. Live Chat Application Part 2
- 236. Live Chat Application Part 3
- 237. Live Chat Application Part 4
- 238. Live Chat Application Part 5
- 239. Live Chat Application In User Page Part 1
- 240. Live Chat Application In User Page Part 2
- 241. Live Chat Application In User Page Part 3
- 242. Live Chat Application In User Page Part 4
- 243. Live Chat Application In User Page Part 5
- 244. Live Chat Application In User Page Part 6
- 245. Live Chat Application In User Page Part 7
- 246. Update Date Format With Moment
- 247. Live Chat Application for Agent Part 1
- 248. Live Chat Application for Agent Part 2


***


# Contenido
***

# Sección 1 Introduccion
## 01. Que contruiremos



# Sección 3 - Multi Auth with Breeze
## 13. Laravel Multi Auth with Breeze Part 1
## 14. Laravel Multi Auth with Breeze Part 2
- Para ver la lista de routes:
php artisan r:l

- Controlador responsable de redirigir:
app/Http/Controllers/Auth/AuthenticatedSessionController.php

- El control de router esta en:
app/Providers/RouteServiceProvider.php

Entonces para poder redirigir al usuario a nuestras tres rutas posibles:
- user
- admin
- agent

Tenemos que trabajar en:
app/Http/Controllers/Auth/AuthenticatedSessionController.php

Los datos los tomamos del Login Request:
app/Http/Requests/Auth/LoginRequest.php

En app/Http/Controllers/Auth/AuthenticatedSessionController.php 
Entonces podemos agregar el codigo de comparacion de que rol tiene el usuario asi:
```php
$url = '';
if ($request->user()->role === 'admin') {
    $url = 'admin/dashboard';
}elseif($request->user()->role === 'agent'){
    $url = 'agent/dashboard';
}elseif($request->user()->role === 'user'){
    $url = '/dashboard';
}

return redirect()->intended($url);
```
Listo!
Hasta aqui la redireccion esta lista, ahora falta la proteccion de las rutas para que un 
rol de user no pueda entrar a los otros dos dashboards (admin y agent).
## 15. Laravel Multi Auth with Breeze Part 3
Para proteger las rutas, necesitamos usar el middleware que nos ofrece Laravel.
- php artisan make:middleware Role

Nos crea:
app/Http/Middleware/Role.php

Ahora registrar este middleware en app/Http/Kernel.php:
'role' => \App\Http\Middleware\Role::class,

Ahora trabajamos en nuestro middleware app/Http/Middleware/Role.php:
```php
public function handle(Request $request, Closure $next, $role): Response
{
    if ($request->user()->role !== $role) {
        return redirect('dashboard');
    }
    return $next($request);
}
```

Ahora para proteger las rutas aplicamos middleware de grupo en routes/web.php:
```php
// Admin group middleware
Route::middleware(['auth','role:admin'])->group(function(){
    Route::get('/admin/dashboard', [AdminController::class, 'AdminDashboard'])->name('admin.dashboard');
});

// Agent group middleware
Route::middleware(['auth','role:agent'])->group(function(){
    Route::get('/agent/dashboard', [AgentController::class, 'AgentDashboard'])->name('agent.dashboard');
});
```
Listo!
## 16. Login with Name or Emailor Phone
Cambiar el label del login page en resources/views/auth/login.blade.php:
```php
<!-- Email Address -->
<div>
    <x-input-label for="login" :value="__('Email/Name/Phone')" />
    <x-text-input id="login" class="block mt-1 w-full" type="text" name="login" :value="old('login')" required autofocus autocomplete="username" />
</div>
```

Ahora modificar el codigo en app/Http/Requests/Auth/LoginRequest.php:
```php
use App\Models\User;
use Illuminate\Support\Facades\Hash;

public function rules(): array
{
    return [
        'login' => ['required', 'string'],
        'password' => ['required', 'string'],
    ];
}

public function authenticate(): void
{
    $this->ensureIsNotRateLimited();

    $user = User::where('email', $this->login)
                ->orWhere('name', $this->login)
                ->orWhere('phone', $this->login)
                ->first();

    if( !$user || !Hash::check($this->password, $user->password) ){
        RateLimiter::hit($this->throttleKey());

        throw ValidationException::withMessages([
            'login' => trans('auth.failed'),
        ]);
    }

    Auth::login($user, $this->boolean('remember'));
    RateLimiter::clear($this->throttleKey());
}
```
Listo!
Ya podemos ingresas con nombre, email o phone

# Sección 4 - Admin Panel Setup## 31. Take Backup And Restore in Localhost
Para hacer Backup de todo el proyecto:
Primero remover y limpiar cache de laravel asi:
- php artisan config:cache
- php artisan cache:clear
- php artisan view:clear
- php artisan optimize
## 17. Project Theme Overview
Descargar los recursos (bootstrap backend theme) en:
~/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files
## 18. Admin template Setup
Copiar todo el folder de assets:
/home/enrique/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Backend Theme/assets
a:
/home/enrique/Sites/realestate/public

Ahora copiar las carpetas pages y partials de:
/home/enrique/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Backend Theme/Main
a:
/home/enrique/Sites/realestate/public/backend

Copiar el dashboard.html de:
/home/enrique/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Backend Theme/Main
a:
resources/views/admin/admin_dashboard.blade.php

Actualizar los assets con:
{{asset('') }}

Para parcializar nuestro contenido creamos:
resources/views/admin/index.blade.php
```php
@extends('admin.admin_dashboard')
@section('admin')

    {{-- Contenido --}}
    <div class="page-content"> 
    	...
    </div>
    <!-- End Contenido -->

@endsection
```

En resources/views/admin/admin_dashboard.blade.php:
```php
<!DOCTYPE html>

<html lang="en">

<head> 
	...
</head>

<body>

	<div class="main-wrapper">
	
		<!-- partial:partials/_sidebar.html -->
	    <nav class="sidebar">
			...
		</nav>
	    <!-- partial -->
	
	    <div class="page-wrapper">
	    
			<!-- Header Top Bar partial:partials/_navbar.html -->
          	<nav class="navbar">    
				...
			</nav>

			{{-- Contenido --}}
	      	@yield('admin')

			<!-- partial:partials/_footer.html -->
	      	<footer>
	      		...
      		</footer>
	   		 
	     </div>
	</div>
	
    <!-- core:js -->
    <script src="{{ asset('../assets/vendors/core/core.js') }}"></script>
    <!-- endinject -->
    			
	...
	
</body>

</html>
```
## 19. Dashboard Page Segmentation
Secmentar las secciones, creando:

- resources/views/admin/body/header.blade.php
- resources/views/admin/body/sidebar.blade.php
- resources/views/admin/body/footer.blade.php

En resources/views/admin/admin_dashboard.blade.php
```php
<div class="main-wrapper">

  <!-- partial:partials/_sidebar.html -->
  @include('admin.body.sidebar')

  <div class="page-wrapper">

    <!-- Header Top Bar partial:partials/_navbar.html -->
    @include('admin.body.header')

    {{-- Contenido --}}
    @yield('admin')

    <!-- partial:partials/_footer.html -->
    @include('admin.body.footer')

  </div>

</div>
```
## 20. Admin Logout Option
En resources/views/admin/body/header.blade.php:
```php
 <li class="dropdown-item py-2">
     <a href="{{ route('admin.logout') }}" class="text-body ms-0">
         <i class="me-2 icon-md" data-feather="log-out"></i>
         <span>Log Out</span>
     </a>
 </li>
```

En routes/web.php:
```php
Route::get('/admin/logout', [AdminController::class, 'AdminLogout'])->name('admin.logout');
```

En app/Http/Controllers/AdminController.php:
```php
use Illuminate\Support\Facades\Auth;
// Admin Logout
public function AdminLogout(Request $request){

    Auth::guard('web')->logout();
    $request->session()->invalidate();
    $request->session()->regenerateToken();
    return redirect('/login');

}
```
## 21. Customize Login Form
En routes/web.php:
Fuera del grupo de Admin group middleware
```php
Route::get('/admin/login', [AdminController::class, 'AdminLogin'])->name('admin.login');
```

En resources/views/admin/admin_login.blade.php:
```php
<head>
	...
	<title>Admin Login Page</title>

    <style type="text/css">
        .authlogin-side-wrapper{
            width: 100%;
            height: 100%;
            background-image: url({{ asset('upload/login.png') }});
        }
    </style>
	...
</head>

<body>
...
	{{-- Side Image --}}
    <div class="col-md-4 pe-md-0">
        <div class="authlogin-side-wrapper">

        </div>
    </div>

    {{-- Formulario de login --}}
    <div class="col-md-8 ps-md-0">
        <div class="auth-form-wrapper px-4 py-5">

            <a href="#"
                class="noble-ui-logo logo-light d-block mb-2">Fotos<span>Oficiales</span></a>
            <h5 class="text-muted fw-normal mb-4">Welcome back! Log in to your account.</h5>

            <form class="forms-sample" method="POST" action="{{ route('login') }}">
            @csrf

                {{-- Email/Name/Phone --}}
                <div class="mb-3">
                    <label for="login" class="form-label">Email/Name/Phone</label>
                    <input type="text" name="login" class="form-control" id="login"
                        placeholder="Email, Name, or Phone">
                </div>

                {{-- password --}}
                <div class="mb-3">
                    <label for="userPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" name="password"
                        autocomplete="current-password" placeholder="Password">
                </div>

                {{-- Remember me --}}
                <div class="form-check mb-3">
                    <input type="checkbox" class="form-check-input" id="authCheck">
                    <label class="form-check-label" for="authCheck">
                        Remember me
                    </label>
                </div>

                {{-- botón login --}}
                <div>
                    <button type="submit" class="btn btn-outline-primary btn-icon-text mb-2 mb-md-0">
                        Login
                    </button>
                </div>

                {{-- Not a user? Sign up --}}
                <a href="register.html" class="d-block mt-3 text-muted">Not a user? Sign up</a>

            </form>

        </div>
    </div>
...
</body>
```
## 22. Refresh Admin Template
Dejar en el sidebar unos cuantos menus, en resources/views/admin/body/sidebar.blade.php:
```php
<li class="nav-item nav-category">Main</li>
<li class="nav-item">
    <a href="{{ route('admin.dashboard') }}" class="nav-link">
        <i class="link-icon" data-feather="box"></i>
        <span class="link-title">Dashboard</span>
    </a>
</li>

{{-- * WEB APPS --}}

{{-- * COMPONENTS --}}

{{-- * DOCS --}}

```

Quitar algunas cosas del header resources/views/admin/body/header.blade.php:
```php
Quitar lo de los lenguajes
```

Dejar soloen resources/views/admin/index.blade.php:
```php
{{-- Row 2 --}}
<div class="row">
  {{-- Monthly sales --}} a  12 columnas

{{-- Row 3 --}}
<div class="row">
    {{-- Inbox --}}
  	{{-- Projects --}}
```
## 23. Update Admin Assets Path
Mover la carpeta de assets a public/backend/assets y modificar en resources/views/admin/admin_dashboard.blade.php:
```php
<link rel="stylesheet" href="{{ asset('backend/assets/vendors/core/core.css') }}">
y en todas las partes donde sea necesario!
```

Tambien modificar los paths en resources/views/admin/admin_login.blade.php:
```php
<link rel="stylesheet" href="{{ asset('../../../assets/vendors/core/core.css') }}">
a
<link rel="stylesheet" href="{{ asset('backend/assets/vendors/core/core.css') }}">
y en todas las partes donde sea necesario!
```

Volver a cargar la pagina y par alimpiar el cache correr:
- php artisan optimize
## 24. Admin Profile & Image Update Part 1
Agregar la ruta a resources/views/admin/body/header.blade.php:
```php
<li class="dropdown-item py-2">
    <a href="{{ route('admin.profile') }}" class="text-body ms-0">
        <i class="me-2 icon-md" data-feather="user"></i>
        <span>Profile</span>
    </a>
</li>
```
En routes/web.php:
```php
Route::get('/admin/profile', [AdminController::class, 'AdminProfile'])->name('admin.profile');
```
En app/Http/Controllers/AdminController.php:
```php
// Admin Profile
public function AdminProfile(){
    $id = Auth::user()->id;
    $profileData = User::find($id);
    return view('admin.admin_profile_view', compact('profileData'));
}
```
En resources/views/admin/admin_profile_view.blade.php:
```php
@extends('admin.admin_dashboard')
@section('admin')

@endsection
```
Si hacemos cambios de ruta en web.php y queremos checar los cambios, laravel nos
manda un error como este:
```Route [admin.profile] not defined.```
Para corregir esto correr:
```php artisan optimize```
Para limpiar el cache!
Listo!
## 25. Admin Profile & Image Update Part 2
Customizar la forma izquierda de desplegar datos de perfil.
En resources/views/admin/admin_profile_view.blade.php:
```php
<div class="card-body">
    <div class="d-flex align-items-center justify-content-between mb-2">

        {{-- Foto --}}
        <div>
            <img class="wd-100 rounded-circle" src="{{ (!empty($profileData->photo)) ? url('upload/admin_images/'.$profileData->photo) : url('upload/no_image.jpg') }}" alt="profile">
            <span class="h4 ms-3">{{ $profileData->username }}</span>
        </div>

    </div>

    <div class="mt-3">
        <label class="tx-11 fw-bolder mb-0 text-uppercase">Name:</label>
        <p class="text-muted">{{ $profileData->name }}</p>
    </div>
    <div class="mt-3">
        <label class="tx-11 fw-bolder mb-0 text-uppercase">Email:</label>
        <p class="text-muted">{{ $profileData->email }}</p>
    </div>
    <div class="mt-3">
        <label class="tx-11 fw-bolder mb-0 text-uppercase">Phone:</label>
        <p class="text-muted">{{ $profileData->phone }}</p>
    </div>
    <div class="mt-3">
        <label class="tx-11 fw-bolder mb-0 text-uppercase">Address:</label>
        <p class="text-muted">{{ $profileData->address }}</p>
    </div>
    <div class="mt-3 d-flex social-links">
        <a href="javascript:;" class="btn btn-icon border btn-xs me-2">
            <i data-feather="github"></i>
        </a>
        <a href="javascript:;" class="btn btn-icon border btn-xs me-2">
            <i data-feather="twitter"></i>
        </a>
        <a href="javascript:;" class="btn btn-icon border btn-xs me-2">
            <i data-feather="instagram"></i>
        </a>
    </div>
</div>
```
## 26. Admin Profile & Image Update Part 3
Vamos a trabajar en la forma de la derecha "UPDATE ADMIN PROFILE"
En resources/views/admin/admin_profile_view.blade.php:
```php
@extends('admin.admin_dashboard')
@section('admin')

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
</head>

{{-- Contenido del profile form html --}}
<div class="page-content">

    <div class="row profile-body">

        <!-- left wrapper - Datos actuales del perfil -->
        <div class="d-none d-md-block col-md-4 col-xl-4 left-wrapper">
            <div class="card rounded">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between mb-2">

                        {{-- Foto --}}
                        <div>
                            <img class="wd-100 rounded-circle" src="{{ (!empty($profileData->photo)) ? url('upload/admin_images/'.$profileData->photo) : url('upload/no_image.jpg') }}" alt="profile">
                            <span class="h4 ms-3">{{ $profileData->username }}</span>
                        </div>

                    </div>

                    <div class="mt-3">
                        <label class="tx-11 fw-bolder mb-0 text-uppercase">Name:</label>
                        <p class="text-muted">{{ $profileData->name }}</p>
                    </div>
                    <div class="mt-3">
                        <label class="tx-11 fw-bolder mb-0 text-uppercase">Email:</label>
                        <p class="text-muted">{{ $profileData->email }}</p>
                    </div>
                    <div class="mt-3">
                        <label class="tx-11 fw-bolder mb-0 text-uppercase">Phone:</label>
                        <p class="text-muted">{{ $profileData->phone }}</p>
                    </div>
                    <div class="mt-3">
                        <label class="tx-11 fw-bolder mb-0 text-uppercase">Address:</label>
                        <p class="text-muted">{{ $profileData->address }}</p>
                    </div>
                    <div class="mt-3 d-flex social-links">
                        <a href="javascript:;" class="btn btn-icon border btn-xs me-2">
                            <i data-feather="github"></i>
                        </a>
                        <a href="javascript:;" class="btn btn-icon border btn-xs me-2">
                            <i data-feather="twitter"></i>
                        </a>
                        <a href="javascript:;" class="btn btn-icon border btn-xs me-2">
                            <i data-feather="instagram"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- wrapper derecha datos para editar -->
        <div class="col-md-8 col-xl-8 middle-wrapper">
            <div class="row">

                <div class="card">
                    <div class="card-body">

                        <h6 class="card-title">Update Admin Profile</h6>

                        <form class="forms-sample">

                            {{-- username --}}
                            <div class="mb-3">
                                <label for="exampleInputUsername1" class="form-label">Username</label>
                                <input type="text" name="username" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->username }}">
                            </div>

                            {{-- Name --}}
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Name</label>
                                <input type="text" name="name" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->name }}">
                            </div>

                            {{-- Email --}}
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Email</label>
                                <input type="email" name="email" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->email }}">
                            </div>

                            {{-- Phone --}}
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Phone</label>
                                <input type="text" name="phone" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->phone }}">
                            </div>

                            {{-- Address --}}
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Address</label>
                                <input type="text" name="address" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->address }}">
                            </div>

                            {{-- Seleccionar Photo --}}
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Photo</label>
                                <input type="file" class="form-control" name="photo" id="image">
                            </div>

                            {{-- Desplegar Photo --}}
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label"></label>
                                <img id="showImage" class="wd-80 rounded-circle" src="{{ (!empty($profileData->photo)) ? url('upload/admin_images/'.$profileData->photo) : url('upload/no_image.jpg') }}" alt="profile">
                            </div>

                            <button type="submit" class="btn btn-primary me-2">Save Changes</button>

                        </form>

                    </div>
                </div>

            </div>
        </div>

    </div>

</div>

<script type="text/javascript">

    $(document).ready(function(){
        $('#image').change(function(e){
            var reader = new FileReader();
            reader.onload = function(e){
                $('#showImage').attr('src',e.target.result);
            }
            reader.readAsDataURL(e.target.files['0']);
        });
    });

</script>

@endsection
```
Usamos java script para poder actualizar la imagen de la photo, y su usamos JS tenemos que traernos
Jquery, el cual lo copiamos de w3 schools.
## 27. Admin Profile & Image Update Part 4
Agregar el mrtodo de post y la ruta a la forma en resources/views/admin/admin_profile_view.blade.php
```php
<form method="POST" action="{{ route('admin.profile.store') }}" class="forms-sample" enctype="multipart/form-data">
@csrf

    {{-- username --}}
    <div class="mb-3">
        <label for="exampleInputUsername1" class="form-label">Username</label>
        <input type="text" name="username" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->username }}">
    </div>

    {{-- Name --}}
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Name</label>
        <input type="text" name="name" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->name }}">
    </div>

    {{-- Email --}}
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Email</label>
        <input type="email" name="email" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->email }}">
    </div>

    {{-- Phone --}}
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Phone</label>
        <input type="text" name="phone" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->phone }}">
    </div>

    {{-- Address --}}
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Address</label>
        <input type="text" name="address" class="form-control" id="exampleInputUsername1" autocomplete="off" value="{{ $profileData->address }}">
    </div>

    {{-- Seleccionar Photo --}}
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Photo</label>
        <input type="file" class="form-control" name="photo" id="image">
    </div>

    {{-- Desplegar Photo --}}
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label"></label>
        <img id="showImage" class="wd-80 rounded-circle" src="{{ (!empty($profileData->photo)) ? url('upload/admin_images/'.$profileData->photo) : url('upload/no_image.jpg') }}" alt="profile">
    </div>

    <button type="submit" class="btn btn-primary me-2">Save Changes</button>

</form>
```

Crear la ruta en routes/web.php
```php
Route::post('/admin/profile/store', [AdminController::class, 'AdminProfileStore'])->name('admin.profile.store');
```

Crear el metodo "AdminProfileStore" en app/Http/Controllers/AdminController.php
```php
// Admin Profile Store
public function AdminProfileStore(Request $request){
    $id = Auth::user()->id;
    $data = User::find($id);

    $data->username = $request->username;
    $data->name = $request->name;
    $data->email = $request->email;
    $data->phone = $request->phone;
    $data->address = $request->address;

    if ($request->file('photo')) {
        $file = $request->file('photo');
        $filename = date('YmdHi').$file->getClientOriginalName();
        $file->move(public_path('upload/admin_images'), $filename);
        $data['photo'] = $filename; //Guardar a Base de Datos
    }

    $data->save();

    return redirect()->back();
}
```
Listo!
## 28. Adding Tostaer In For View Message
Agregar toaster cdn en resources/views/admin/admin_dashboard.blade.php:
```php
<head>
  	...
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css" >
</head>

<body>
	...
	
	{{-- Toaster cdn --}}
	    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
	
	    {{-- Toaster script --}}
	    <script>
	        @if(Session::has('message'))
	            var type = "{{ Session::get('alert-type','info') }}"
	                switch(type){
	                case 'info':
	                toastr.info(" {{ Session::get('message') }} ");
	                break;
	
	                case 'success':
	                toastr.success(" {{ Session::get('message') }} ");
	                break;
	
	                case 'warning':
	                toastr.warning(" {{ Session::get('message') }} ");
	                break;
	
	                case 'error':
	                toastr.error(" {{ Session::get('message') }} ");
	                break;
	            }
	        @endif
	    </script>

</body>
```

Y en app/Http/Controllers/AdminController.php
```php
public function AdminProfileStore(Request $request){

    $id = Auth::user()->id;
    $data = User::find($id);

    $data->username = $request->username;
    $data->name = $request->name;
    $data->email = $request->email;
    $data->phone = $request->phone;
    $data->address = $request->address;

    if ($request->file('photo')) {
        $file = $request->file('photo');
        unlink(public_path('upload/admin_images/'.$data->photo)); // para borrar la imagen anterior
        $filename = date('YmdHi').$file->getClientOriginalName();
        $file->move(public_path('upload/admin_images'), $filename);
        $data['photo'] = $filename; //Guardar a Base de Datos
    }

    $data->save();

    $notification = array(
        'message' => 'Perfil de Admin Actualizado Correctamente',
        'alert-type' => 'success'
    );

    return redirect()->back()->with($notification);
}
```

Para actualizar los datos del profileDropdown menu en resources/views/admin/body/header.blade.php
```php
...
@php

    $id = Auth::user()->id;
    $profileData = App\Models\User::find($id);

@endphp

{{-- profileDropdown --}}
<li class="nav-item dropdown">

    {{-- Imagen de Perfil de Arriba Header --}}
    <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button"
        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <img class="wd-30 ht-30 rounded-circle" src="{{ (!empty($profileData->photo)) ? url('upload/admin_images/'.$profileData->photo) : url('upload/no_image.jpg') }}" alt="profile">
    </a>

    <div class="dropdown-menu p-0" aria-labelledby="profileDropdown">

        <div class="d-flex flex-column align-items-center border-bottom px-5 py-3">
            {{-- Imagen de Perfil de Abajo Menu --}}
            <div class="mb-3">
                <img class="wd-80 ht-80 rounded-circle" src="{{ (!empty($profileData->photo)) ? url('upload/admin_images/'.$profileData->photo) : url('upload/no_image.jpg') }}" alt="">
            </div>
            {{-- nombre y correo --}}
            <div class="text-center">
                <p class="tx-16 fw-bolder">{{ $profileData->name }}</p>
                <p class="tx-12 text-muted">{{ $profileData->email }}</p>
            </div>
        </div>

        {{-- menus --}}
        <ul class="list-unstyled p-1">

            {{-- Profile --}}
            <li class="dropdown-item py-2">
                <a href="{{ route('admin.profile') }}" class="text-body ms-0">
                    <i class="me-2 icon-md" data-feather="user"></i>
                    <span>Profile</span>
                </a>
            </li>

			...
			
        </ul>

    </div>
</li>
```
Listo!
## 29. Admin Profile Change Password Part 1
resources/views/admin/admin_change_password.blade.php
```php
<form method="POST" action="{{ route('admin.profile.store') }}" class="forms-sample" enctype="multipart/form-data">
@csrf


    {{-- Old Password --}}
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Contraseña Vieja</label>
        <input type="password" name="old_password" class="form-control @error('old_password') is-invalid @enderror" id="old_password" autocomplete="off">
        @error('old_password')
            <span class="text-danger">{{ $message }}</span>
        @enderror
    </div>

    {{-- New Password --}}
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Contraseña Nueva</label>
        <input type="password" name="new_password" class="form-control @error('new_password') is-invalid @enderror" id="new_password" autocomplete="off">
        @error('new_password')
            <span class="text-danger">{{ $message }}</span>
        @enderror
    </div>

    {{-- Confirm Password --}}
    <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Confirmar Contraseña Nueva</label>
        <input type="password" name="new_password_confirmation" class="form-control" id="new_password_confirmation" autocomplete="off">
    </div>

    <button type="submit" class="btn btn-primary me-2">Save Changes</button>

</form>
```
Listo!
## 30. Admin Profile Change Password Part 2
Cambios en:
- resources/views/admin/admin_change_password.blade.php
- routes/web.php
- app/Http/Controllers/AdminController.php- 
Para los detalles ver este commit en GitHub.

admin
udemy12345
Listo!
## 31. Take Backup And Restore in Localhost
Para hacer Backup de todo el proyecto:

1. Primero remover y limpiar cache de laravel asi:
- php artisan config:cache
- php artisan cache:clear
- php artisan view:clear
- php artisan optimize

2. Comprimir toda la carpeta:
-  ~/Sites/realestate
Right click en explorer y comprimir a ZIP, queda un archivo como de 70MB:
- realestate.zip
Ahora exportar la base de datos, exportarla con phpMyadmin
- Export
- Custom
- Tick ON (IF NOT EXIST - less efficient as indexes will be generated during table creation)
- Go
Listo!

Para restaurarlo:
- pasar estos dos archivos a un carpeta y:
- extraer el realestate.zip
- crear una nueva base de datos en phpMyadmin "laravelbackup" por ejemplo.
- importar base de datos de file realestate.sql con phpMyadmin
- ahora ir a la carpeta ~/Sites/realestate_backup/realestate y correr:
- composer update
- para conectarnos a nuestra nueva base de datos importada, modificar .env
```php
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravelbackup
DB_USERNAME=enrique
DB_PASSWORD=sousa1234
```
- Probar corriendo:
- php artisan serve
Listo!

# Sección 5 - Project Frontend Template Setup
## 32. Frontend Template Setup Part 1
Cargar un tema para el frontend para todo los usuarios.
Copiar el Frontend theme de:
~/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Frontend

Crear nuevo controlador
```php
php artisan make:controller UserController
```

Copiar los assets de: ~/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Frontend/assets
a: public/frontend/assets

y copiar el index a:
resources/views/frontend/frontend_dashboard.blade.php

Update loas accesos a css js e images, en resources/views/frontend/frontend_dashboard.blade.php:
usando: {{ asset('frontend/') }}
```php
...
<!-- Stylesheets -->
<link href="{{ asset('frontend/assets/css/font-awesome-all.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/flaticon.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/owl.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/bootstrap.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/jquery.fancybox.min.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/animate.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/jquery-ui.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/nice-select.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/color/theme-color.css') }}" id="jssDefault" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/switcher-style.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/style.css') }}" rel="stylesheet">
<link href="{{ asset('frontend/assets/css/responsive.css') }}" rel="stylesheet">
...
<!-- jequery plugins -->
<script src="{{ asset('frontend/assets/js/jquery.js') }}"></script>
<script src="{{ asset('frontend/assets/js/popper.min.js') }}"></script>
<script src="{{ asset('frontend/assets/js/bootstrap.min.js') }}"></script>
<script src="{{ asset('frontend/assets/js/owl.js') }}"></script>
<script src="{{ asset('frontend/assets/js/wow.js') }}"></script>
<script src="{{ asset('frontend/assets/js/validation.js') }}"></script>
<script src="{{ asset('frontend/assets/js/jquery.fancybox.js') }}"></script>
<script src="{{ asset('frontend/assets/js/appear.js') }}"></script>
<script src="{{ asset('frontend/assets/js/scrollbar.js') }}"></script>
<script src="{{ asset('frontend/assets/js/isotope.js') }}"></script>
<script src="{{ asset('frontend/assets/js/jquery.nice-select.min.js') }}"></script>
<script src="{{ asset('frontend/assets/js/jQuery.style.switcher.min.js') }}"></script>
<script src="{{ asset('frontend/assets/js/jquery-ui.js') }}"></script>
<script src="{{ asset('frontend/assets/js/nav-tool.js') }}"></script> 
```

En routes/web.php
```php
// Home User Frontend All Route
Route::get('/', [UserController::class, 'index']); 
```

Y en app/Http/Controllers/UserController.php:
```php
public function index(){
    return view('frontend.frontend_dashboard');
} 
```
Antes de probar, No olvidar correr:
```php
php artisan optimize 
```
No funciono!

Ya funciono!
me estaba faltando el asset:
```php 
<!-- main-js -->
<script src="{{ asset('frontend/assets/js/script.js') }}"></script>
```

También actualice todos las {{ asset('frontend/) }} para todas las images de la pagina, que son como 50!
Listo!
## 33. Frontend Template Setup Part 2
Segmentar en secciones.
En resources/views/frontend/frontend_dashboard.blade.php:
```php
<body>

    <div class="boxed_wrapper">

        <!-- preloader -->
        @include('frontend.home.preload')

        <!-- main header -->
        @include('frontend.home.header')

        <!-- Mobile Menu  -->
        @include('frontend.home.mobile_menu')


        {{-- Sección principal --}}
        @yield('main')

        <!-- main-footer -->
        @include('frontend.home.footer')


        <!--Scroll to top-->
        <button class="scroll-top scroll-to-target" data-target="html">
            <span class="fal fa-angle-up"></span>
        </button>

    </div>


    <!-- jequery plugins -->
    <script src="{{ asset('frontend/assets/js/jquery.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/popper.min.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/owl.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/wow.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/validation.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/jquery.fancybox.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/appear.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/scrollbar.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/isotope.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/jquery.nice-select.min.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/jQuery.style.switcher.min.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/jquery-ui.js') }}"></script>
    <script src="{{ asset('frontend/assets/js/nav-tool.js') }}"></script>

    <!-- main-js -->
    <script src="{{ asset('frontend/assets/js/script.js') }}"></script>

</body> 
```

En resources/views/frontend/index.blade.php
Ponemos en main content
```php
@extends('frontend.frontend_dashboard')

@section('main')
    ...
@endsection
```
Listo!
## 34. Frontend Template Setup Part 3
Ahora seccionar el main content.
En resources/views/frontend/index.blade.php
```php
@extends('frontend.frontend_dashboard')

@section('main')

<!-- banner-section -->
@include('frontend.home.banner')

<!-- category-section -->
@include('frontend.home.category')

<!-- feature-section -->
@include('frontend.home.feature')

<!-- video-section -->
@include('frontend.home.video')

<!-- deals-section -->
@include('frontend.home.deals')

<!-- testimonial-section end -->
@include('frontend.home.testimonial')

<!-- choose us - section -->
@include('frontend.home.chooseus')

<!-- place-section -->
@include('frontend.home.place')

<!-- team-section -->
@include('frontend.home.team')

<!-- cta-section -->
@include('frontend.home.cta')

<!-- news-section -->
@include('frontend.home.news')


<!-- download-section -->
@include('frontend.home.download')

@endsection 
```
Listo!
## 35. Frontend Template Login Page Setup
Tomar como base la forma de singin de:
- ~/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Frontend/signin.html

En resources/views/auth/login.blade.php
Solo la parte del tab-1 iniciar sesión
```php
{{-- tab-1 Login --}}
<div class="tab active-tab" id="tab-1">
    <div class="inner-box">
        <h4>Inicia Sesión</h4>
        <form action="{{ route('login') }}" method="post" class="default-form">
        @csrf

            {{-- Nombre --}}
            <div class="form-group">
                <label>Nombre/Correo/Teléfono</label>
                <input type="text" name="login" id="login" required="">
            </div>

            {{-- Password --}}
            <div class="form-group">
                <label>Contraseña</label>
                <input type="password" name="password" id="password" required="">
            </div>

            {{-- boton Sign In --}}
            <div class="form-group message-btn">
                <button type="submit" class="theme-btn btn-one">Iniciar</button>
            </div>

        </form>
        <div class="othre-text">
            <p>Have not any account? <a href="signup.html">Register Now</a></p>
        </div>
    </div>
</div> 
```
Listo!
## 36. Frontend Template Register Page Setup
En el tab-2 Registrarse resources/views/auth/login.blade.php
```php
{{-- tab-2 Regístrate --}}
<div class="tab" id="tab-2">
    <div class="inner-box">
        <h4>Registrarse</h4>

        <form action="{{ route('register') }}" method="POST" class="default-form">
            @csrf

            {{-- Nombre --}}
            <div class="form-group">
                <label>Nombre</label>
                <input type="text" name="name" id="name" required="">
            </div>

            {{-- Email --}}
            <div class="form-group">
                <label>Correo Electrónico</label>
                <input type="email" name="email" id="email" required="">
            </div>

            {{-- Password --}}
            <div class="form-group">
                <label>Contraseña</label>
                <input type="password" name="password" id="password" required="">
            </div>

            {{-- Confirm Password --}}
            <div class="form-group">
                <label>Confirma Contraseña</label>
                <input type="password" name="password_confirmation" id="password_confirmation" required="">
            </div>

            {{-- botón regístrate --}}
            <div class="form-group message-btn">
                <button type="submit" class="theme-btn btn-one">Regístrate</button>
            </div>

        </form>

        <div class="othre-text">
            <p>Have not any account? <a href="signup.html">Register Now</a></p>
        </div>

    </div>
</div> 
``` 

Para redirigir a la pagina de login cuando visiten http://realestate.test/register
Modificar el acceso en app/Http/Controllers/Auth/RegisteredUserController.php
En vez de apuntar a return view('auth.register'); que apunte a login page!
```php
public function create(): View
{
    return view('auth.login');
} 
```
Listo!

# Sección 6 - Project Frontend User Profile Setup
## 37. User Profile Design Part 1
Setup Theme Page
Tomar:
~/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Frontend/my-profile.html

Y copiar solo estas tres secciones en resources/views/dashboard.blade.php:
```php
@extends('frontend.frontend_dashboard')
@section('main')


<!--Page Title-->
...
<!--End Page Title-->

<!-- sidebar-page-container --> 
...
<!-- sidebar-page-container -->

<!-- subscribe-section -->
...
<!-- subscribe-section end -->

@endsection
``` 
Las modificaciones las podemos ver en este commit en github
Listo!
## 38. User Profile Design Part 2
Display User
Archivos que modifique:
- resources/views/dashboard.blade.php
- app/Http/Controllers/UserController.php
- resources/views/frontend/dashboard/edit_profile.blade.php
- routes/web.php
- resources/views/frontend/dashboard/dashboard_sidebar.blade.php
Listo!
## 39. User Profile Design Part 3
Update User
Archivos que modifique:
- app/Http/Controllers/UserController.php
- resources/views/frontend/frontend_dashboard.blade.php
- resources/views/frontend/dashboard/edit_profile.blade.php
- resources/views/admin/admin_profile_view.blade.php
- routes/web.php

Nota:
En app/Http/Controllers/UserController.php
Para que no falle la linea:
unlink(public_path('upload/user_images/' . $data->photo)); // para borrar la imagen anterior
La primera vez tenemos que comentarla, para salvar por lo menos una imagen.
Ya que este salvada la primer imagen ya podemos des-comentarla.

Para arreglar este problema usar:
```php
// dd($data->photo); //regresa null si es la primera vez (si no hay foto)
if (!empty($data->photo)) {
    unlink(public_path('upload/user_images/' . $data->photo)); // para borrar la imagen anterior
}
```
Listo!
## 40. User Logout Option
User Logout
- resources/views/frontend/dashboard/dashboard_sidebar.blade.php
- routes/web.php
- app/Http/Controllers/UserController.php
Listo!
## 41. User Profile Password Change
Cambiar Contraseña
- resources/views/frontend/dashboard/dashboard_sidebar.blade.php
- routes/web.php
- app/Http/Controllers/UserController.php
- resources/views/frontend/dashboard/change_password.blade.php
Listo!
## 42. Update User Login Setup with and without Login
En resources/views/frontend/home/header.blade.php
```php
@auth
    <div class="sign-box">
        <a href="{{ route('dashboard') }}"><i class="fas fa-user"></i>Panel</a>
        <a href="{{ route('user.logout') }}" class="pl-3"><i class="fas fa-user"></i>Cerrar Sesión</a>
    </div>
@else
    <div class="sign-box">
        <a href="{{ route('login') }}"><i class="fas fa-user"></i>Iniciar Sesión</a>
    </div>
@endauth 
```
Listo!
## 43. User Login and Logout Notification
Para el User Logout
En app/Http/Controllers/UserController.php
```php
// User Logout
public function UserLogout(Request $request)
{

    Auth::guard('web')->logout();
    $request->session()->invalidate();
    $request->session()->regenerateToken();

    $notification = array(
        'message' => 'Cierre de Sesión Exitosa',
        'alert-type' => 'success'
    );

    return redirect('/login')->with($notification);

} 
```
Para el Admin Logout
En app/Http/Controllers/AdminController.php
```php
// Admin Logout
public function AdminLogout(Request $request)
{

    Auth::guard('web')->logout();
    $request->session()->invalidate();
    $request->session()->regenerateToken();

    $notification = array(
        'message' => 'Cierre de Sesión Exitosa',
        'alert-type' => 'success'
    );

    return redirect('/admin/login')->with($notification);

} 
```
Y agregar el toaster drivers a resources/views/admin/admin_login.blade.php
```php
<head> 
...
{{-- Toaster cdn --}}
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css">
</head> 
<body>
...
{{-- Toaster cdn --}}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

{{-- Toaster script --}}
<script>
    @if(Session::has('message'))
        var type = "{{ Session::get('alert-type','info') }}"
            switch(type){
            case 'info':
            toastr.info(" {{ Session::get('message') }} ");
            break;

            case 'success':
            toastr.success(" {{ Session::get('message') }} ");
            break;

            case 'warning':
            toastr.warning(" {{ Session::get('message') }} ");
            break;

            case 'error':
            toastr.error(" {{ Session::get('message') }} ");
            break;
        }
    @endif
</script>
</body>
``` 

Ahora para las notificaciones del login para todos los usuarios
desplegando su nombre!
En app/Http/Controllers/Auth/AuthenticatedSessionController.php
```php
public function store(LoginRequest $request): RedirectResponse
{
    $request->authenticate();

    // Para saber quien esta haciendo el login
    $id = Auth::user()->id;
    $adminData = User::find($id);
    $userName = $adminData->name;

    $request->session()->regenerate();

    $notification = array(
        'message' => 'Usuario '. $userName .' ha iniciado sesión con éxito',
        'alert-type' => 'info'
    );

    $url = '';
    if ($request->user()->role === 'admin') {
        $url = 'admin/dashboard';
    }elseif($request->user()->role === 'agent'){
        $url = 'agent/dashboard';
    }elseif($request->user()->role === 'user'){
        $url = '/dashboard';
    }

    return redirect()->intended($url)->with($notification);
} 
```
Listo!

# Sección 7 - Project Backend Property Type Setup
## 44. Property Type Crud Part 1
Crear un nuevo controlador
```php
php artisan make:controller Backend/PropertyTypeController 
```
Crear un modelo y una tabla de migración
```php
php artisan make:model PropertyType -m 
```
En app/Models/PropertyType.php
```php
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class PropertyType extends Model
{
    use HasFactory;
    // Para que todos los campos sean fillables
    protected $guarded = [];
}
```
En database/migrations/2023_05_31_212917_create_property_types_table.php
```php
Schema::create('property_types', function (Blueprint $table) {
    $table->id();

    $table->string('type_name');
    $table->string('type_icon')->nullable();

    $table->timestamps();
}); 
```
Hacer la migración:
```php
php artisan migrate 
```
En app/Http/Controllers/Backend/PropertyTypeController.php
```php
use Illuminate\Support\Facades\Auth;
use App\Models\PropertyType;

class PropertyTypeController extends Controller
{
    // Tomar todos los datos de la tabla property_types
    public function AllType(){

        $types = PropertyType::latest()->get();

        return view('backend.type.all_type', compact('types'));
    }

}
```
En resources/views/backend/type/all_type.blade.php
```php
@extends('admin.admin_dashboard')
@section('admin')



@endsection 
```

Añadir otro grupo de rutas solo para admins
En routes/web.php
```php
// Admin group middleware
Route::middleware(['auth','role:admin'])->group(function(){

    // Property All Routes
    Route::controller(PropertyTypeController::class)->group(function(){

        Route::get('/all/type', 'AllType')->name('all.type');

    });

}); 
```
Listo!
## 45. Property Type Crud Part 2
- resources/views/backend/type/all_type.blade.php
- resources/views/admin/admin_dashboard.blade.php
Listo!
## 46. Property Type Crud Part 3
- resources/views/backend/type/all_type.blade.php
- routes/web.php
- app/Http/Controllers/Backend/PropertyTypeController.php
- resources/views/backend/type/add_type.blade.php
Listo!
## 47. Property Type Crud Part 4
Edit Update Type
- resources/views/backend/type/edit_type.blade.php
- app/Http/Controllers/Backend/PropertyTypeController.php - UpdateType()
- routes/web.php - ruta '/update/type'
Listo!
## 48. Property Type Crud Part 5
Delete y aviso con Sweet Alert 2
- En resources/views/admin/admin_dashboard.blade.php
```php
{{-- Plugin for sweet alert 2 --}}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script src="{{ asset('backend/assets/js/code/code.js') }}"></script> 
```
- Crear public/backend/assets/js/code/code.js
```php
$(function () {
    $(document).on("click", "#delete", function (e) {
        e.preventDefault();
        var link = $(this).attr("href");

        Swal.fire({
            title: "Are you sure?",
            text: "Delete This Data?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, delete it!",
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = link;
                Swal.fire("Deleted!", "Your file has been deleted.", "success");
            }
        });
    });
}); 
```
Y en resources/views/backend/type/all_type.blade.php usar el id="delete"
```php
<td>
    <a href="{{ route('edit.type',$item->id) }}" class="btn btn-inverse-warning">Editar</a>
    <a href="{{ route('delete.type',$item->id) }}" class="btn btn-inverse-danger" id="delete">Borrar</a>
</td>
```
Ahora ya podemos usar nuestro mensaje con sweet alert 2.
Para modificar los mensajes solo editarlos en public/backend/assets/js/code/code.js

En routes/web.php
```php
Route::get('/delete/type/{id}', 'DeleteType')->name('delete.type'); 
```

En app/Http/Controllers/Backend/PropertyTypeController.php
```php
// Delete Type
public function DeleteType($id){

    PropertyType::findOrFail($id)->delete();

    $notification = array(
        'message' => 'Property Type se elimino con éxito!',
        'alert-type' => 'success'
    );

    return redirect()->back()->with($notification);

} 
```
Listo!

# Sección 8 - Project Backend Property Amenities
## 49. Amenities Crud Part 1
Crear una nueva tabla y su modelo
```php
php artisan make:model Amenities -m 
```
Agregar un solo campo, en database/migrations/2023_06_01_151806_create_amenities_table.php
```php
$table->string('amenities_name'); 
```
En en modelo hacer fillable todos los campos, app/Models/Amenities.php
```php
protected $guarded = []; 
```
Hacer la migracion:
```php
php artisan migrate 
```
Varios archivos mas ver este commit en github.
Listo!
## 50. Add Validation Message con JS Crud Part 1
Ahora vamos hacer la validación del campo con Java Script
- Copiar validate.min.js a /home/enrique/Sites/realestate/public/backend/assets/js/code
Para soportar este nuevo código tenemos que agregarlo a resources/views/admin/admin_dashboard.blade.php:
```php
{{-- Plugin para hacer validación de campos con JS --}}
<script src="{{ asset('backend/assets/js/code/validate.min.js') }}"></script> 
```
Y agregar este código JS en la pagina donde vamos a usar la validación, en este caso en resources/views/backend/amenities/add_amenities.blade.php, insertarlo antes de que termine la sección:
```php
<script type="text/javascript">
    $(document).ready(function (){
        $('#myForm').validate({
            rules: {
                field_name: {
                    required : true,
                }, 
                
            },
            messages :{
                field_name: {
                    required : 'Please Enter FieldName',
                }, 
                 

            },
            errorElement : 'span', 
            errorPlacement: function (error,element) {
                error.addClass('invalid-feedback');
                element.closest('.form-group').append(error);
            },
            highlight : function(element, errorClass, validClass){
                $(element).addClass('is-invalid');
            },
            unhighlight : function(element, errorClass, validClass){
                $(element).removeClass('is-invalid');
            },
        });
    });
    
</script>

@endsection 
```
Asegurarnos de incluir también el código Jquery al inicio de la sección:
```php
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script> 
```
Para que podamos usar ejecutar el código JS.
Agregar el id="myForm" correspondiente a nuestra forma:
```php
<form id="myForm" method="POST" action="{{ route('store.type') }}" class="forms-sample">
@csrf 
```
La forma y el codigo js ya modificados queda asi:
```php
...
<form id="myForm" method="POST" action="{{ route('store.type') }}" class="forms-sample">
@csrf


    {{-- Type Name --}}
    <div class="form-group mb-3">
        <label for="amenities_name" class="form-label">Amenities Name</label>
        <input type="text" name="amenities_name" class="form-control">
    </div>

    <button type="submit" class="btn btn-primary me-2">Save Changes</button>

</form> 
...
<script type="text/javascript">
    $(document).ready(function (){
        $('#myForm').validate({

            rules: {

                amenities_name: {
                    required : true,
                },

            },
            messages :{
                amenities_name: {
                    required : 'Favor entrar nombre de amenities, campo requerido',
                },


            },
            errorElement : 'span',
            errorPlacement: function (error,element) {
                error.addClass('invalid-feedback');
                element.closest('.form-group').append(error);
            },
            highlight : function(element, errorClass, validClass){
                $(element).addClass('is-invalid');
            },
            unhighlight : function(element, errorClass, validClass){
                $(element).removeClass('is-invalid');
            },
        });
    });

</script>
```
La ventaja que tenemos al usar la validación con JS es que sin tener que recargar la pagina
los errores de validación son desplegados.
Listo!
## 51. Amenities Crud Part 2
Completar las acciones de:
- Añadir
- Editar
- Update
- y Borrar
- resources/views/backend/amenities/add_amenities.blade.php
- routes/web.php
- app/Http/Controllers/Backend/PropertyTypeController.php
listo!

# Sección 9 - Backend Add Property Page Design
## 52. Add Property Database Design Part 1 
Crear un controlador nuevo:
```php
php artisan make:controller Backend/PropertyController 
```
Crear una nueva tabla, esto se hace creando su modelo con migración:
```php
php artisan make:model Property -m 
```
En el modelo app/Models/Property.php:
```php
class Property extends Model
{
    use HasFactory;

    // Para que todos los campos sean fill-ables
    protected $guarded = [];

} 
```
Los campos que vamos a crear en la tabla database/migrations/2023_06_02_011542_create_properties_table.php
```php
public function up(): void
{
    Schema::create('properties', function (Blueprint $table) {
        $table->id();

        $table->string('ptype_id');
        $table->string('amenities_id');
        $table->string('property_name');
        $table->string('property_slug');
        $table->string('property_code');
        $table->string('property_status');
        $table->string('lowest_price')->nullable();
        $table->string('max_price')->nullable();
        $table->string('property_thambnail');
        $table->string('short_descp')->nullable();
        $table->text('long_descp')->nullable();
        $table->string('bedrooms')->nullable();
        $table->string('bathrooms')->nullable();
        $table->string('garage')->nullable();
        $table->string('garage_size')->nullable();
        $table->string('property_size')->nullable();
        $table->string('property_video')->nullable();
        $table->string('address')->nullable();
        $table->string('city')->nullable();
        $table->string('state')->nullable();
        $table->string('postal_code')->nullable();
        $table->string('neighborhood')->nullable();
        $table->string('latitude')->nullable();
        $table->string('longitude')->nullable();
        $table->string('featured')->nullable();
        $table->string('hot')->nullable();
        $table->integer('agent_id')->nullable();
        $table->string('status')->default(0);

        $table->timestamps();
    });
} 
```
Listo!
## 53. Add Property Database Design Part 2
Crear una nueva tabla para almacenar las multiples imágenes asociadas a una propiedad.
```php
php artisan make:model MultiImage -m 
```
En app/Models/MultiImage.php
```php
// Para que todos los campos sean fill-ables
protected $guarded = []; 
```
Y en la tabla database/migrations/2023_06_02_013822_create_multi_images_table.php
```php
public function up(): void
{
    Schema::create('multi_images', function (Blueprint $table) {
        $table->id();

        $table->integer('property_id');
        $table->string('photo_name');

        $table->timestamps();
    });
} 
```
Crear otra tabla para los lugares cercanos (neighborhood).
```php
php artisan make:model Facility -m
```
Los campos en esta tabla database/migrations/2023_06_02_014659_create_facilities_table.php
```php
public function up(): void
{
    Schema::create('facilities', function (Blueprint $table) {
        $table->id();

        $table->integer('property_id');
        $table->string('facility_name')->nullable();
        $table->string('distance')->nullable();

        $table->timestamps();
    });
} 
```

Finalmente hacer las migraciones:
```php
php artisan migrate 
```
Se crearon las tres tablas con éxito:
```php
2023_06_02_011542_create_properties_table ....................... 89ms DONE
2023_06_02_013822_create_multi_images_table ..................... 24ms DONE
2023_06_02_014659_create_facilities_table ....................... 30ms DONE 
```
Listo!
## 54. Add Property Database and Page Design Part 1
Añadir otra opción de menu en el sidebar 
en resources/views/admin/body/sidebar.blade.php
```php
{{-- Property --}}
<a class="nav-link" data-bs-toggle="collapse" href="#property" role="button" aria-expanded="false"
    aria-controls="emails">
    <i class="link-icon" data-feather="mail"></i>
    <span class="link-title">Propiedades</span>
    <i class="link-arrow" data-feather="chevron-down"></i>
</a>
<div class="collapse" id="property">
    <ul class="nav sub-menu">
        <li class="nav-item">
            <a href="{{ route('all.property') }}" class="nav-link">Todas las Propiedades</a>
        </li>
        <li class="nav-item">
            <a href="{{ route('add.amenities') }}" class="nav-link">Añadir una Comodidad</a>
        </li>
    </ul>
</div> 
```
Crear su ruta en web.php
```php
// Admin group middleware
Route::middleware(['auth','role:admin'])->group(function(){
    ...
    // Property All Routes
    Route::controller(PropertyController::class)->group(function(){
        Route::get('/all/property', 'AllProperty')->name('all.property');
    });

}); 
```
En el controlador app/Http/Controllers/Backend/PropertyController.php
```php
// All Property / Todas las Propiedades
public function AllProperty(){

    // Recuperar todos los datos de la tabla properties
    $property = Property::latest()->get();
    return view('backend.property.all_property', compact('property'));
} 
```
Crear la vista donde presentaremos los datos en una tabla resources/views/backend/property/all_property.blade.php
Listo!
## 55. Add Property Database and Page Design Part 2
Diseño de la forma de captura de datos en resources/views/backend/property/add_property.blade.php
```php
Nos quedamos hasta aqui:
{{-- picture thumbnail --}}
<div class="col-sm-6">
    <div class="mb-3">
        <label class="form-label">Imagen Miniatura</label>
        <input type="file" name="lowest_price" class="form-control">
    </div>
</div><!-- Col -->

{{-- Multiple Image --}}
<div class="col-sm-6">
    <div class="mb-3">
        <label class="form-label">Imágenes Multiples</label>
        <input type="file" name="lowest_price" class="form-control">
    </div>
</div><!-- Col --> 
```
En la siguiente lección implementaremos la selección de la imágenes!
Listo!
## 56. Show Image Using Javascript
Usar los scrips de JS para visualizar tanto single image como multiple images.
en resources/views/backend/property/add_property.blade.php
```php
...
{{-- picture thumbnail --}}
<div class="col-sm-6">
    <div class="mb-3">
        <label class="form-label">Imagen Miniatura</label>
        <input type="file" name="property_thambnail" class="form-control" onChange="mainThamUrl(this)"  >
        <img src="" id="mainThmb">
    </div>
</div><!-- Col -->

{{-- Multiple Image --}}
<div class="col-sm-6">
    <div class="mb-3">
        <label class="form-label">Imágenes Multiples</label>
        <input type="file" name="multi_img[]" class="form-control" id="multiImg" multiple="">
        <div class="row" id="preview_img"> </div>
    </div>
</div><!-- Col --> 
...
{{-- Script de JS para visualizar la imagen --}}
<script type="text/javascript">
    function mainThamUrl(input){
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e){
              $('#mainThmb').attr('src',e.target.result).width(80).height(80);
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>

{{-- Script de JS para visualizar multiples imágenes --}}
<script type="text/javascript">

    $(document).ready(function(){
        $('#multiImg').on('change', function(){ //on file input change
        if (window.File && window.FileReader && window.FileList && window.Blob) //check File API supported browser
        {
            var data = $(this)[0].files; //this file data

            $.each(data, function(index, file){ //loop though each file
                if(/(\.|\/)(gif|jpe?g|png|webp)$/i.test(file.type)){ //check supported file type
                    var fRead = new FileReader(); //new filereader
                    fRead.onload = (function(file){ //trigger function on successful read
                    return function(e) {
                        var img = $('<img/>').addClass('thumb').attr('src', e.target.result) .width(100)
                    .height(80); //create image element
                        $('#preview_img').append(img); //append image to output element
                    };
                    })(file);
                    fRead.readAsDataURL(file); //URL representing the file's data.
                }
            });

        }else{
            alert("Your browser doesn't support File API!"); //if File API is absent
        }
        });
    });

</script>
```
Listo!
## 57. Add Property Database and Page Design Part 5
Seguir diseñando la forma en resources/views/backend/property/add_property.blade.php
```php
<form>

    {{-- Row 1 --}}
    <div class="row">

        {{-- Nombre Propiedad --}}
        <div class="col-sm-6">
            <div class="mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" name="property_name" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- Property Status --}}
        <div class="col-sm-6">
            <div class="mb-3">
                <label class="form-label">Estatus</label>
                <select name="property_status" class="form-select"
                    id="exampleFormControlSelect1">
                    <option selected="" disabled="">Seleccionar Estatus</option>
                    <option value="rent">Para Renta</option>
                    <option value="buy">Para Compra</option>
                </select>
            </div>
        </div><!-- Col -->

        {{-- Lowest Price --}}
        <div class="col-sm-6">
            <div class="mb-3">
                <label class="form-label">Precio mas Bajo</label>
                <input type="text" name="lowest_price" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- Max Price --}}
        <div class="col-sm-6">
            <div class="mb-3">
                <label class="form-label">Precio mas Alto</label>
                <input type="text" name="max_price" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- picture thumbnail --}}
        <div class="col-sm-6">
            <div class="mb-3">
                <label class="form-label">Imagen Miniatura</label>
                <input type="file" name="property_thambnail" class="form-control"
                    onChange="mainThamUrl(this)">
                <img src="" id="mainThmb">
            </div>
        </div><!-- Col -->

        {{-- Multiple Image --}}
        <div class="col-sm-6">
            <div class="mb-3">
                <label class="form-label">Imágenes Multiples</label>
                <input type="file" name="multi_img[]" class="form-control" id="multiImg"
                    multiple="">
                <div class="row" id="preview_img"> </div>
            </div>
        </div><!-- Col -->

    </div><!-- Row -->

    {{-- Row 2 --}}
    <div class="row">

        {{-- BedRooms --}}
        <div class="col-sm-3">
            <div class="mb-3">
                <label class="form-label">Dormitorios</label>
                <input type="text" name="bedrooms" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- Bathrooms --}}
        <div class="col-sm-3">
            <div class="mb-3">
                <label class="form-label">Baños</label>
                <input type="text" name="bathrooms" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- Garage --}}
        <div class="col-sm-3">
            <div class="mb-3">
                <label class="form-label">Cochera</label>
                <input type="text" name="garage" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- Garage Size --}}
        <div class="col-sm-3">
            <div class="mb-3">
                <label class="form-label">Tamaño de Cochera</label>
                <input type="text" name="garage_size" class="form-control">
            </div>
        </div><!-- Col -->

    </div><!-- Row -->

    {{-- Row 3 --}}
    <div class="row">

        {{-- Address --}}
        <div class="col-sm-3">
            <div class="mb-3">
                <label class="form-label">Dirección</label>
                <input type="text" name="address" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- City --}}
        <div class="col-sm-3">
            <div class="mb-3">
                <label class="form-label">Ciudad</label>
                <input type="text" name="city" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- State --}}
        <div class="col-sm-3">
            <div class="mb-3">
                <label class="form-label">Estado</label>
                <input type="text" name="state" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- Postal Code --}}
        <div class="col-sm-3">
            <div class="mb-3">
                <label class="form-label">Código Postal</label>
                <input type="text" name="postal_code" class="form-control">
            </div>
        </div><!-- Col -->

    </div><!-- Row -->

    {{-- Row 4 --}}
    <div class="row">

        {{-- Property Size --}}
        <div class="col-sm-4">
            <div class="mb-3">
                <label class="form-label">Tamaño Propiedad</label>
                <input type="text" name="property_size"  class="form-control" >
            </div>
        </div><!-- Col -->

        {{-- Property Video --}}
        <div class="col-sm-4">
            <div class="mb-3">
                <label class="form-label">Video Propiedad</label>
                <input type="text" name="property_video"  class="form-control" >
            </div>
        </div><!-- Col -->

        {{-- Neighborhood --}}
        <div class="col-sm-4">
            <div class="mb-3">
                <label class="form-label">Vecindario</label>
                    <input type="text" name="neighborhood"  class="form-control" >
            </div>
        </div><!-- Col -->

    </div><!-- Row -->

    {{-- Row 5 --}}
    <div class="row">

        {{-- Latitude --}}
        <div class="col-sm-6">
            <div class="mb-3">
                <label class="form-label">Latitude</label>
                <input type="text" name="latitude" class="form-control">
                <a href="https://www.latlong.net/convert-address-to-lat-long.html" target="_blank">Go here to get Latitude
                    from address</a>
            </div>
        </div><!-- Col -->

        {{-- Longitude --}}
        <div class="col-sm-6">
            <div class="mb-3">
                <label class="form-label">Longitude</label>
                <input type="text" name="longitude" class="form-control">
                <a href="https://www.latlong.net/convert-address-to-lat-long.html" target="_blank">Go here to get Longitude
                    from address</a>
            </div>
        </div><!-- Col -->

    </div><!-- Row -->

    {{-- Row 6 --}}
    <div class="row">

        {{-- Property Type --}}
        <div class="col-sm-4">
            <div class="mb-3">
                <label class="form-label">Property Type</label>
                <input type="text" name="property_size" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- Property Amenities --}}
        <div class="col-sm-4">
            <div class="mb-3">
                <label class="form-label">Property Amenities</label>
                <input type="text" name="property_video" class="form-control">
            </div>
        </div><!-- Col -->

        {{-- Agent --}}
        <div class="col-sm-4">
            <div class="mb-3">
                <label class="form-label">Agent</label>
                <input type="text" name="neighborhood" class="form-control">
            </div>
        </div><!-- Col -->

    </div><!-- Row -->

</form> 
```
Dejamos par ala siguiente lección el {{-- Row 6 --}}
Ya que estos campos los tenemos que relacionar con nuestras otras tablas.
Listo!
## 58. Add Property Database and Page Design Part 6
Relacionar la tabla de "property_types", "amenities", y de la tabla "users" vamos a relacionar al agente donde su 'role' sea un "agent" y que este "activo" (en campo 'status'), pasando los datos desde el controlador app/Http/Controllers/Backend/PropertyController.php
```php
// Añadir Propiedad
public function AddProperty(){

    $propertytype = PropertyType::latest()->get();
    $amenities = Amenities::latest()->get();
    $activeAgent = User::where('status','active')->where('role','agent')->latest()->get();

    return view('backend.property.add_property',compact('propertytype','amenities','activeAgent'));
} 
```
Para la seleccion de Tipo de Propiedad y Agente lo podemos resolver con una seleccion single:
en resources/views/backend/property/add_property.blade.php
```php
{{-- Row 6, Tipo de Propiedad, Comodidades, Agente --}}
<div class="row">

    {{-- Property Type --}}
    <div class="col-sm-4">
        <div class="mb-3">
            <label class="form-label">Tipo de Propiedad</label>
            <select name="ptype_id" class="form-select" id="exampleFormControlSelect1">
                <option selected="" disabled="">Seleccionar Tipo</option>
                @foreach($propertytype as $ptype)
                    <option value="{{ $ptype->id }}">{{ $ptype->type_name }}</option>
                @endforeach
            </select>
        </div>
    </div><!-- Col -->


    {{-- Agent --}}
    <div class="col-sm-4">
        <div class="mb-3">
            <label class="form-label">Agente</label>
            <select name="agent_id" class="form-select" id="exampleFormControlSelect1">
                <option selected="" disabled="">Seleccionar Agente</option>
                @foreach($activeAgent as $agent)
                    <option value="{{ $agent->id }}">{{ $agent->name }}</option>
                @endforeach
            </select>
        </div>
    </div><!-- Col -->

</div><!-- Row --> 
```
Para la seleccion de Comodidades lo podemos resolver con una seleccion multiple:
en resources/views/backend/property/add_property.blade.php
La estructura la podemos sacar de matreial de ejercicio en:
~/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Backend Theme/Main/pages/forms/advanced-elements.html 
usando "Multiple select using select 2"
Tenemos ue cargar el css y js especifico para este tipo de Multiple Select
```php
{{-- Property Amenities --}}
<div class="col-sm-4">
    <label class="form-label">Comodidades</label>
    <select name="amenities_id[]" class="js-example-basic-multiple form-select" multiple="multiple" data-width="100%">
        @foreach($amenities as $ameni)
            <option value="{{ $ameni->id }}">{{ $ameni->amenities_name }}</option>
        @endforeach
    </select>
</div><!-- Col -->
```
Y para soportar la seleccion multiple en resources/views/admin/admin_dashboard.blade.php:
```php
...
{{-- Plugins para la "Multiple select using select 2" que usamos en Property Amenities en resources/views/backend/property/add_property.blade.php --}}
<link rel="stylesheet" href="{{ asset('backend/assets/vendors/select2/select2.min.css') }}">
<link rel="stylesheet" href="{{ asset('backend/assets/vendors/jquery-tags-input/jquery.tagsinput.min.css') }}"> 
...
Y antes de que cierre el Body tag colocamos el codigo JS
{{-- Plugins para la "Multiple select using select 2" que usamos en Property Amenities en resources/views/backend/property/add_property.blade.php --}}
{{-- input tags --}}
<script src="{{ asset('backend/assets/vendors/inputmask/jquery.inputmask.min.js') }}"></script>
<script src="{{ asset('backend/assets/vendors/select2/select2.min.js') }}"></script>
<script src="{{ asset('backend/assets/vendors/typeahead.js/typeahead.bundle.min.js') }}"></script>
<script src="{{ asset('backend/assets/vendors/jquery-tags-input/jquery.tagsinput.min.js') }}"></script>
<script src="{{ asset('backend/assets/js/inputmask.js') }}"></script>
<script src="{{ asset('backend/assets/js/select2.js') }}"></script>
<script src="{{ asset('backend/assets/js/typeahead.js') }}"></script>
<script src="{{ asset('backend/assets/js/tags-input.js') }}"></script>
```
Listo!
## 59. Add Property Database and Page Design Part 7
Buscar una text area input para nuestros campos descripcion corta y larga.
Los drivers para tener un editor en el text area.
Para el txt area del long description:
~/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Backend Theme/Main/pages/forms/editors.html
En resources/views/backend/property/add_property.blade.php
```php
{{-- Short Description --}}
<div class="col-sm-12">
    <div class="mb-3">
        <label class="form-label">Descripción Corta</label>
        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
    </div>
</div><!-- Col -->

{{-- Long Description --}}
<div class="col-sm-12">
    <div class="mb-3">
        <label class="form-label">Descripción Larga</label>
        <textarea class="form-control" name="tinymce" id="tinymceExample" rows="10"></textarea>
    </div>
</div><!-- Col --> 
```
Para soportar el tinymce hay que incluir en resources/views/admin/admin_dashboard.blade.php
```php
{{-- Plugins para soportar al editor tinymce que lo usamos en resources/views/backend/property/add_property.blade.php --}}
<script src="{{ asset('backend/assets/vendors/tinymce/tinymce.min.js') }}"></script>
<script src="{{ asset('backend/assets/js/tinymce.js') }}"></script>
```
Para los check boxes de Features Property y Hot Property insertamos en resources/views/backend/property/add_property.blade.php
```php
{{-- Checkboxes Features Property y Hot Property --}}
<div class="mb-3">

    <div class="form-check form-check-inline">
        <input type="checkbox" name="featured" value="1" class="form-check-input" id="checkInline1">
        <label class="form-check-label" for="checkInline1">
            Features Property
        </label>
    </div>

    <div class="form-check form-check-inline">
        <input type="checkbox" name="hot" value="1" class="form-check-input" id="checkInline">
        <label class="form-check-label" for="checkInline">
            Hot Property
        </label>
    </div>

</div> 
```
En name va el nombre del campo y en value va el valor que inertaremos en el campo si lo dejaron en check!
Listo!
## 60. Add Property Database and Page Design Part 8
Agregar las Instalaciones Cercas en resources/views/backend/property/add_property.blade.php
```php
...
{{-- Facilities Option --}}
<div class="row add_item">

    {{-- Instalaciones Cercanas --}}
    <div class="col-md-4">
        <div class="mb-3">
            <label for="facility_name" class="form-label">Instalaciones Cercanas</label>
            <select name="facility_name[]" id="facility_name" class="form-control">
                <option value="">Selecciona Instalación</option>
                <option value="Hospital">Hospital</option>
                <option value="Super Mercado">Super Mercado</option>
                <option value="Escuela">Escuela</option>
                <option value="Entretenimiento">Entretenimiento</option>
                <option value="Farmacia">Farmacia</option>
                <option value="Aeropuerto">Aeropuerto</option>
                <option value="Estación de Tren">Estación de Tren</option>
                <option value="Parada de autobus">Parada de autobus</option>
                <option value="Playa">Playa</option>
                <option value="Centro Comercial">Centro Comercial</option>
                <option value="Banco">Banco</option>
                <option value="Cine">Cine</option>
                <option value="Restaurante">Restaurante</option>
            </select>
        </div>
    </div>

    {{-- Distance --}}
    <div class="col-md-4">
        <div class="mb-3">
            <label for="distance" class="form-label">Distancia</label>
            <input type="text" name="distance[]" id="distance" class="form-control" placeholder="Distancia en (Km)">
        </div>
    </div>

    {{-- Add More.. --}}
    <div class="form-group col-md-4" style="padding-top: 30px;">
        <a class="btn btn-success addeventmore"><i class="fa fa-plus-circle"></i>Agregar mas...</a>
    </div>

</div>
<!---end row--> 
...
<!--========== Start of add multiple class with ajax, Para agregar mas opciones a Facilities Option ==============-->
<div style="visibility: hidden">
    <div class="whole_extra_item_add" id="whole_extra_item_add">
        <div class="whole_extra_item_delete" id="whole_extra_item_delete">
            <div class="container mt-2">
                <div class="row">

                    <div class="form-group col-md-4">
                        <label for="facility_name">Facilities</label>
                        <select name="facility_name[]" id="facility_name" class="form-control">

                            <option value="">Selecciona Instalación</option>
                            <option value="Hospital">Hospital</option>
                            <option value="Super Mercado">Super Mercado</option>
                            <option value="Escuela">Escuela</option>
                            <option value="Entretenimiento">Entretenimiento</option>
                            <option value="Farmacia">Farmacia</option>
                            <option value="Aeropuerto">Aeropuerto</option>
                            <option value="Estación de Tren">Estación de Tren</option>
                            <option value="Parada de autobus">Parada de autobus</option>
                            <option value="Playa">Playa</option>
                            <option value="Centro Comercial">Centro Comercial</option>
                            <option value="Banco">Banco</option>
                            <option value="Cine">Cine</option>
                            <option value="Restaurante">Restaurante</option>

                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label for="distance">Distancia</label>
                        <input type="text" name="distance[]" id="distance" class="form-control"
                            placeholder="Distancia en (Km)">
                    </div>
                    <div class="form-group col-md-4" style="padding-top: 20px">
                        <span class="btn btn-success btn-sm addeventmore"><i class="fa fa-plus-circle">Agregar</i></span>
                        <span class="btn btn-danger btn-sm removeeventmore"><i class="fa fa-minus-circle">Remover</i></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!----For Section-------->
<script type="text/javascript">
    $(document).ready(function(){
       var counter = 0;
       $(document).on("click",".addeventmore",function(){
             var whole_extra_item_add = $("#whole_extra_item_add").html();
             $(this).closest(".add_item").append(whole_extra_item_add);
             counter++;
       });
       $(document).on("click",".removeeventmore",function(event){
             $(this).closest("#whole_extra_item_delete").remove();
             counter -= 1
       });
    });
</script>
<!--========== End of add multiple class with ajax ==============-->
```
Con esto logramos poder poder agregar Instalciones cercas y todas las podremos grabar a la tabla, esto
se vera mas adelante.
Listo!
## 61. Add Property JavaScript Validation
Agragar validacion a nuestra forma!
En resources/views/backend/property/add_property.blade.php
- Empatar la forma con el id="myForm" que ya definimos en el codigo JS al final de la pagina
- No olvidar usar el "form-group" par alos campos que queremos validar
```php
...
{{-- Nombre Propiedad --}}
<div class="col-sm-6">
    <div class="form-group mb-3">
        <label class="form-label">Nombre</label>
        <input type="text" name="property_name" class="form-control">
    </div>
</div><!-- Col -->

{{-- Property Status --}}
<div class="col-sm-6">
    <div class="form-group mb-3">
        <label class="form-label">Estatus</label>
        <select name="property_status" class="form-select"
            id="exampleFormControlSelect1">
            <option selected="" disabled="">Seleccionar Estatus</option>
            <option value="rent">Para Renta</option>
            <option value="buy">Para Compra</option>
        </select>
    </div>
</div><!-- Col -->

{{-- Lowest Price --}}
<div class="col-sm-6">
    <div class="form-group mb-3">
        <label class="form-label">Precio mas Bajo</label>
        <input type="text" name="lowest_price" class="form-control">
    </div>
</div><!-- Col -->

{{-- Max Price --}}
<div class="col-sm-6">
    <div class="form-group mb-3">
        <label class="form-label">Precio mas Alto</label>
        <input type="text" name="max_price" class="form-control">
    </div>
</div><!-- Col --> 
...
{{-- Property Type --}}
<div class="col-sm-4">
    <div class="form-group mb-3">
        <label class="form-label">Tipo de Propiedad</label>
        <select name="ptype_id" class="form-select" id="exampleFormControlSelect1">
            <option selected="" disabled="">Seleccionar Tipo</option>
            @foreach($propertytype as $ptype)
                <option value="{{ $ptype->id }}">{{ $ptype->type_name }}</option>
            @endforeach
        </select>
    </div>
</div><!-- Col -->
...
{{-- Script de JS para la Validación --}}
<script type="text/javascript">
    $(document).ready(function (){
        $('#myForm').validate({

            rules: {
                property_name: {
                    required : true,
                },
                property_status: {
                    required : true,
                },
                lowest_price: {
                    required : true,
                },
                max_price: {
                    required : true,
                },
                ptype_id: {
                    required : true,
                },

            },

            messages :{

                property_name: {
                    required : 'Favor entrar nombre de la Propiedad, campo requerido',
                },
                property_status: {
                    required : 'Favor seleccionar Estatus de la Propiedad, campo requerido',
                },
                lowest_price: {
                    required : 'Favor entrar precio mas bajo, campo requerido',
                },
                max_price: {
                    required : 'Favor entrar precio mas alto, campo requerido',
                },
                ptype_id: {
                    required : 'Favor seleccionar Tipo de Propiedad, campo requerido',
                },

            },

            errorElement : 'span',
            errorPlacement: function (error,element) {
                error.addClass('invalid-feedback');
                element.closest('.form-group').append(error);
            },
            highlight : function(element, errorClass, validClass){
                $(element).addClass('is-invalid');
            },
            unhighlight : function(element, errorClass, validClass){
                $(element).removeClass('is-invalid');
            },
        });
    });

</script>
```
Listo!

# Sección 10 - Backend Insert Property Setup 
## 62. Install Image Intervention Package
Utilizar el paquete de Laravel Intervention Packeage para reizes las imagenes que vamos a subir!
https://image.intervention.io/v2
Intervention Image is an open source PHP image handling and manipulation library. It provides an easier and expressive way to create, edit, and compose images and supports currently the two most common image processing libraries GD Library and Imagick.
Instalar el paquete:
```php
composer require intervention/image 
```
After you have installed Intervention Image, open your Laravel config file config/app.php and add the following lines.
In the $providers array add the service providers for this package.
En config/app.php, en Autoloaded Service Providers - Package Service Providers, agregar:
```php
/*
* Package Service Providers...
*/
Intervention\Image\ImageServiceProvider::class,
```
Add the facade of this package to the $aliases array, en la seccion de Class Aliases.
```php
'aliases' => Facade::defaultAliases()->merge([
    // 'Example' => App\Facades\Example::class,
    'Image' => Intervention\Image\Facades\Image::class
])->toArray(),
```
By default Intervention Image uses PHP's GD library extension to process all images. If you want to switch to Imagick, you can pull a configuration file into your application by running one of the following artisan command.
Publish configuration in Laravel
```php
php artisan vendor:publish --provider="Intervention\Image\ImageServiceProviderLaravelRecent"
```
Copying file [vendor/intervention/image/src/config/config.php] to [config/image.php] ........................................................ DONE
Listo!
## 63. Property Insert Database Part 1
Empezando por crear la ruta en la forma de captura en resources/views/backend/property/add_property.blade.php
```php
...
<form method="POST" action="{{ route('store.property') }}" id="myForm" enctype="multipart/form-data">
@csrf
... 
```
Definimos la ruta en routes/web.php
```php
Route::post('/store/property', 'StoreProperty')->name('store.property'); 
```
Empezamos a crear el metodo StoreProperty() en app/Http/Controllers/Backend/PropertyController.php
```php
...
use Intervention\Image\Facades\Image;
...
// Store Property
public function StoreProperty(Request $request){
    $image = $request->file('property_thambnail');
    // crear un unique id para la imagen
    $name_gen = hexdec(uniqid()).'.'.$image->getClientOriginalExtension();
    Image::make($image)->resize(370,250)->save('upload/property/thambnail/'.$name_gen);
    $save_url = 'upload/property/thambnail/'.$name_gen;
} 
```
Listo!
## 64. Property Insert Database Part 2
Para empezar a traer los datos a la tabla 'properties', en nuestro metodo StoreProperty(Request $request)
En app/Http/Controllers/Backend/PropertyController.php
```php
public function StoreProperty(Request $request){

    $amen = $request->amenities_id;
    dd($amen);
}
```
Para checcar que nos llega con el campo "comodidades" donde colocamos codigo para 
recuperar multiples comodidades.
Vamos viendo que nos entrega.
```php
array:3 [▼ // app/Http/Controllers/Backend/PropertyController.php:39
  0 => "2"
  1 => "6"
  2 => "7"
] 
```
Nos regresa un array con lso id de los multiples items que escogimos.
Para poder separar estos items, tenemos que usar la funcion implode() asi:
```php
$amen = $request->amenities_id;
// dd($amen);
$comodidades = implode(",", $amen);
dd($comodidades); 
```
Esto nos da:
```php
"2,6,7" // app/Http/Controllers/Backend/PropertyController.php:41 
```
Como podemos ver nos entrega un string con los datos separados por coma.
Este tipo de string es el que nos conviene guardar en el campo 'amenities_id' de la tabla 'properties'.

En el campo de 'property_code' tiene que ser unique y tiene que ser automaticamente generado.
Para eso podemos usar un paquete de laravel "Laravel ID Generator":
```php
composer require haruncpi/laravel-id-generator
```
Para usar el paquete:
```php
use Haruncpi\LaravelIdGenerator\IdGenerator;
```
Para generar el codigo unique
```php
$pcode = IdGenerator::generate([
            'table' => 'properties',
            'field' => 'property_code',
            'length' => 5, 
            'prefix' => 'PC' 
        ]); 
```
 Asi queda en app/Http/Controllers/Backend/PropertyController.php
 ```php
 ...
use Intervention\Image\Facades\Image;
use Haruncpi\LaravelIdGenerator\IdGenerator;
use Carbon\Carbon;
 ...
// Store Property
public function StoreProperty(Request $request){

    $amen = $request->amenities_id;
    // dd($amen);
    $comodidades_str = implode(",", $amen);
    // dd($comodidades);

    // Generar un código unique de 5 dígitos con un prefix property code (PC)
    $pcode = IdGenerator::generate([
                    'table' => 'properties',
                    'field' => 'property_code',
                    'length' => 5,
                    'prefix' => 'PC'
                ]);

    $image = $request->file('property_thambnail');
    $name_gen = hexdec(uniqid()).'.'.$image->getClientOriginalExtension(); // crear un unique id para la imagen
    Image::make($image)->resize(370,250)->save('upload/property/thambnail/'.$name_gen);
    $save_url = 'upload/property/thambnail/'.$name_gen;

    $property_id = Property::insertGetId([

        'ptype_id' => $request->ptype_id,
        'amenities_id' => $comodidades_str,
        'property_name' => $request->property_name,
        'property_slug' => strtolower(str_replace(' ', '-', $request->property_name)),
        'property_code' => $pcode,
        'property_status' => $request->property_status,

        'lowest_price' => $request->lowest_price,
        'max_price' => $request->max_price,
        'short_descp' => $request->short_descp,
        'long_descp' => $request->long_descp,
        'bedrooms' => $request->bedrooms,
        'bathrooms' => $request->bathrooms,
        'garage' => $request->garage,
        'garage_size' => $request->garage_size,

        'property_size' => $request->property_size,
        'property_video' => $request->property_video,
        'address' => $request->address,
        'city' => $request->city,
        'state' => $request->state,
        'postal_code' => $request->postal_code,

        'neighborhood' => $request->neighborhood,
        'latitude' => $request->latitude,
        'longitude' => $request->longitude,
        'featured' => $request->featured,
        'hot' => $request->hot,
        'agent_id' => $request->agent_id,
        'status' => 1,
        'property_thambnail' => $save_url,
        'created_at' => Carbon::now(),

    ]);

}  
 ```
Listo!
## 65. Property Insert Database Part 3
Insertar las imagenes multiples en la tabla 'multi_images'
En app/Http/Controllers/Backend/PropertyController.php
```php
// Insertar datos a tabla 'multi_images', Multiple Image Upload From Here
$images = $request->file('multi_img');
foreach ($images as $img) {

    $make_name = hexdec(uniqid()) . '.' . $img->getClientOriginalExtension();
    Image::make($img)->resize(770, 520)->save('upload/property/multi-image/' . $make_name);
    $uploadPath = 'upload/property/multi-image/' . $make_name;

    MultiImage::insert([
        'property_id' => $property_id,
        'photo_name' => $uploadPath,
        'created_at' => Carbon::now(),
    ]);

} // End Foreach 
```
Listo!
## 66. Property Insert Database Part 4
Agregar codigo en metodo para agregar las "Instalaciones Cercanas" 
En app/Http/Controllers/Backend/PropertyController.php
```php
use App\Models\Facility;
...
// Insertar datos a tabla 'facilities', Instalaciones cercanas - Facilities Add From Here
$facilities = Count($request->facility_name);
if ($facilities != NULL) {
    for ($i=0; $i < $facilities; $i++) {
        $fcount = new Facility();
        $fcount->property_id = $property_id;
        $fcount->facility_name = $request->facility_name[$i];
        $fcount->distance = $request->distance[$i];
        $fcount->save();
    }
}

$notification = array(
    'message' => 'La Propiedad fue añadida con éxito!',
    'alert-type' => 'success'
);

return back()->roue('all.property')->with($notification); 
...
```
Aqui usamos otro metodo para grabar los datos, de cualquier for de todas maneras se 
necesita soportar el objeto de Gacility con:
```php
use App\Models\Facility; 
```
Listo!
## 67. Manage Property Read All Product y Traduccion a Español
Ajustar en config/app.php:
```php
// 'timezone' => 'UTC',
'timezone' => 'America/Tijuana', 
```
Para tener las fechas con mi zona.

Para traducciones al español.
https://github.com/amendozaaguiar/laravel-lat-es
Puedes instalar este paquete mediante composer:
```php
composer require amendozaaguiar/laravel-lat-es
```
Ahora simplemente necesitamos actualizar las traducciones que lo haremos con el siguiente comando:
```php
php artisan vendor:publish --tag=lang
```
Esto lo podemos hacer modificando el parámetro locale de la configuración de Laravel en config/app.php:
```php
// Ej: español
'locale'          => 'es',
// Ej: inglés
'locale'          => 'en',
```
Se puede ser mas concreto e indicar las variaciones de un lenguaje:
```php
// Inglés americano
'locale' => 'en_US',
// Portugués de Portugal
'locale' => 'pt_PT',
```
No! me creo la carpeta  resources/lang/es.json

Me funciono mejor este paquete:
Laravel Espanol
https://github.com/Laraveles/spanish

Puedes instalar este paquete mediante composer:
```php
composer require laraveles/spanish
```

Ahora simplemente necesitamos actualizar las traducciones que lo haremos con el siguiente comando:
```php
php artisan vendor:publish --tag=lang
```

Esto lo podemos hacer modificando el parámetro locale de la configuración de Laravel en config/app.php:
```php
// Ej: español
'locale'          => 'es',
// Ej: inglés
'locale'          => 'en',
```

Para hacer las traducciones de los campos que inician con {{ __('Email') }} por ejemplo, en resources/views/auth/login.blade.php, entonces tenemos que crear un archivo es.json y ahi hacer las traducciones. en resources/lang/es.json:
```php
{
    "E-Mail Address": "Correo electrónico",
    "Email": "Correo",
    "Password": "Contraseña",
    "Remember Me": "Recuérdame",
    "Login": "Acceder",
    "Forgot Your Password?": "¿Olvidaste tu contraseña?",
    "Register": "Registro",
    "Name": "Nombre",
    "Confirm Password": "Confirmar contraseña",
    "Reset Password": "Restablecer contraseña",
    "Reset Password Notification": "Aviso para restablecer contraseña",
    "You are receiving this email because we received a password reset request for your account.": "Estás recibiendo este email porque se ha solicitado un cambio de contraseña para tu cuenta.",
    "This password reset link will expire in :count minutes.": "Este enlace para restablecer la contraseña caduca en :count minutos.",
    "If you did not request a password reset, no further action is required.": "Si no has solicitado un cambio de contraseña, puedes ignorar o eliminar este e-mail.",
    "Please confirm your password before continuing.": "Por favor confirme su contraseña antes de continuar.",
    "Regards": "Saludos",
    "Whoops!": "¡Ups!",
    "Hello!": "¡Hola!",
    "If you’re having trouble clicking the \":actionText\" button, copy and paste the URL below\ninto your web browser: [:actionURL](:actionURL)": "Si tienes problemas haciendo click en el botón \":actionText\", copia y pega el siguiente\nenlace en tu navegador: [:actionURL](:actionURL)",
    "If you’re having trouble clicking the \":actionText\" button, copy and paste the URL below\ninto your web browser: [:displayableActionUrl](:actionURL)": "Si tienes problemas haciendo click en el botón \":actionText\", copia y pega el siguiente\nenlace en tu navegador: [:displayableActionUrl](:actionURL)",
    "If you’re having trouble clicking the \":actionText\" button, copy and paste the URL below\ninto your web browser:": "Si tienes problemas haciendo click en el botón \":actionText\", copia y pega el siguiente\nenlace en tu navegador:",
    "Send Password Reset Link": "Enviar enlace para restablecer contraseña",
    "Logout": "Cerrar sesión",
    "Verify Email Address": "Confirmar correo electrónico",
    "Please click the button below to verify your email address.": "Por favor pulsa el siguiente botón para confirmar tu correo electrónico.",
    "If you did not create an account, no further action is required.": "Si no has creado ninguna cuenta, puedes ignorar o eliminar este e-mail.",
    "Verify Your Email Address": "Confirma tu correo electrónico",
    "A fresh verification link has been sent to your email address.": "Se ha enviado un nuevo enlace de verificación a tu correo electrónico.",
    "Before proceeding, please check your email for a verification link.": "Antes de poder continuar, por favor, confirma tu correo electrónico con el enlace que te hemos enviado.",
    "If you did not receive the email": "Si no has recibido el email",
    "click here to request another": "pulsa aquí para que te enviemos otro",
    "All rights reserved.":  "Todos los derechos reservados.",
    "Profile":  "Perfil"
}  
```

Este si funciono, traduje perfil en resources/views/admin/body/header.blade.php
```php
{{-- Profile --}}
<li class="dropdown-item py-2">
    <a href="{{ route('admin.profile') }}" class="text-body ms-0">
        <i class="me-2 icon-md" data-feather="user"></i>
        <span>{{ __('Profile') }}</span>
    </a>
</li> 
```
Listo!

Relacionar el ptype_id con la tabla property_types para desplegar nombre type_name.
En app/Models/Property.php
```php
// Relacion del campo 'ptype_id' con el 'id' de la tabla 'property_types'
public function type(){
    return $this->belongsTo(PropertyType::class,'ptype_id','id');
} 
```

Ahora para desplegar el nombre en vez del 'ptype_id' 
En resources/views/backend/property/all_property.blade.php
```php
<td>{{ $item['type']['type_name'] }}</td> 
``` 
agregar nueva columna con el property_code
```php
<td>{{ $item->property_code }}</td> 
```

En la siguiente leccion veremos el boton de Editar.
Listo!
## 68. Manage Property Edit Option Part 1
En resources/views/backend/property/all_property.blade.php
```php
<a href="{{ route('edit.property',$item->id) }}" class="btn btn-inverse-warning">Editar</a> 
```

En routes/web.php
```php
Route::get('/edit/property/{id}', 'EditProperty')->name('edit.property'); 
``` 

En app/Http/Controllers/Backend/PropertyController.php
```php
// Editar Datos de la Propiedad
public function EditProperty($id){

    $property = Property::findOrFail($id);
    $propertytype = PropertyType::latest()->get();
    $amenities = Amenities::latest()->get();
    $activeAgent = User::where('status','active')->where('role','agent')->latest()->get();

    return view('backend.property.edit_property',compact('property','propertytype','amenities','activeAgent'));

} 
``` 

Copiar el codigo add_property y hacer algunas modificaciones en resources/views/backend/property/edit_property.blade.php, Desplegar los campos para poder ser editardos, agregando los values a cada input:
```php
value="{{ $property->property_name }}"
value="{{ $property->lowest_price }}"
value="{{ $property->max_price }}"
Etc..
```

Para desplegar html en textarea de long_descp tenemos que usra la sintaxis
```php
{!! $str!!} 
```
Quedaria asi:
```php
{{-- Long Description --}}
<div class="col-sm-12">
    <div class="mb-3">
        <label class="form-label text-warning">Descripción Larga</label>
        <textarea name="long_descp" class="form-control" id="tinymceExample" rows="10">
            {!! $property->long_descp !!}
        </textarea>
    </div>
</div><!-- Col --> 
```
Listo!
## 69. Manage Property Edit Option Part 2
Para colocar la seleccion en la seleccion correcta para Property Status, ya sea rent or buy
En resources/views/backend/property/edit_property.blade.php
```php
{{-- Property Status --}}
<div class="col-sm-6">
    <div class="form-group mb-3">
        <label class="form-label text-warning">Estatus</label>
        <select name="property_status" class="form-select"
            id="exampleFormControlSelect1">
            <option selected="" disabled="">Seleccionar Estatus</option>
            <option value="rent" {{ $property->property_status == 'rent' ? 'selected' : '' }}>Para Renta</option>
            <option value="buy" {{ $property->property_status == 'buy' ? 'selected' : '' }}>Para Compra</option>
        </select>
    </div>
</div><!-- Col --> 
```

Para el Tippo de Propiedad podemos hacer:
```php
{{-- Property Type --}}
<div class="col-sm-4">
    <div class="form-group mb-3">
        <label class="form-label text-warning">Tipo de Propiedad</label>
        <select name="ptype_id" class="form-select" id="exampleFormControlSelect1">
            <option selected="" disabled="">Seleccionar Tipo</option>
            @foreach($propertytype as $ptype)
                <option value="{{ $ptype->id }}" {{ $ptype->id == $property->ptype_id ? 'selected' : '' }}>{{ $ptype->type_name }}</option>
            @endforeach
        </select>
    </div>
</div><!-- Col -->
```

Para el Agente igual
```php
{{-- Agent --}}
<div class="col-sm-4">
    <div class="mb-3">
        <label class="form-label text-warning">Agente</label>
        <select name="agent_id" class="form-select" id="exampleFormControlSelect1">
            <option selected="" disabled="">Seleccionar Agente</option>
            @foreach($activeAgent as $agent)
                <option value="{{ $agent->id }}" {{ $agent->id == $property->agent_id ? 'selected' : '' }}>{{ $agent->name }}</option>
            @endforeach
        </select>
    </div>
</div><!-- Col --> 
```

Para las coomodidades, ahora hay que expander en app/Http/Controllers/Backend/PropertyController.php
```php
...
$type = $property->amenities_id;
$property_ami = explode(',', $type);
..
Y pasarla en la funcion compact
return view('backend.property.edit_property',compact('property','propertytype','amenities','activeAgent', 'property_ami'));
```
Y en resources/views/backend/property/edit_property.blade.php
```php
{{-- Property Amenities --}}
<div class="col-sm-4">
    <label class="form-label text-warning">Comodidades</label>
    <select name="amenities_id[]" class="js-example-basic-multiple form-select" multiple="multiple" data-width="100%">
        @foreach($amenities as $ameni)
            <option value="{{ $ameni->id }}" {{ (in_array($ameni->id, $property_ami)) ? 'selected' : '' }}>{{ $ameni->amenities_name }}</option>
        @endforeach
    </select>
</div><!-- Col --> 
```

Ahora los check de Features Property y Hot Property
```php
{{-- Checkboxes Features Property y Hot Property --}}
<div class="mb-3">

    <div class="form-check form-check-inline">
        <input type="checkbox" name="featured" value="1" class="form-check-input" id="checkInline1" {{ $property->featured == 1 ? 'checked' : '' }}>
        <label class="form-check-label text-warning" for="checkInline1">
            Features Property
        </label>
    </div>

    <div class="form-check form-check-inline">
        <input type="checkbox" name="hot" value="1" class="form-check-input" id="checkInline" {{ $property->hot == 1 ? 'checked' : '' }}>
        <label class="form-check-label text-warning" for="checkInline">
            Hot Property
        </label>
    </div>

</div> 
```
Listo!
## 70. Manage Property Update Option
Actualizar la accion de la forma para poder redirigirlo a una ruta de update!
En resources/views/backend/property/edit_property.blade.php
```php
<form method="POST" action="{{ route('update.property') }}" id="myForm" enctype="multipart/form-data">
@csrf
    
    {{-- Para capturar el id del record que queremos editar --}}
    <input type="hidden" name="id" value="{{ $property->id }}"> 

    ...

</form>
```

En routes/web.php
```php
Route::post('/update/property', 'UpdateProperty')->name('update.property'); 
```

Y el metodo Update en app/Http/Controllers/Backend/PropertyController.php
```php
// Update Property
public function UpdateProperty(Request $request){

    $amen = $request->amenities_id;
    $comodidades_str = implode(",", $amen);

    $property_id = $request->id;

    Property::findOrFail($property_id)->update([

        'ptype_id' => $request->ptype_id,
        'amenities_id' => $comodidades_str,
        'property_name' => $request->property_name,
        'property_slug' => strtolower(str_replace(' ', '-', $request->property_name)),
        'property_status' => $request->property_status,

        'lowest_price' => $request->lowest_price,
        'max_price' => $request->max_price,
        'short_descp' => $request->short_descp,
        'long_descp' => $request->long_descp,
        'bedrooms' => $request->bedrooms,
        'bathrooms' => $request->bathrooms,
        'garage' => $request->garage,
        'garage_size' => $request->garage_size,

        'property_size' => $request->property_size,
        'property_video' => $request->property_video,
        'address' => $request->address,
        'city' => $request->city,
        'state' => $request->state,
        'postal_code' => $request->postal_code,

        'neighborhood' => $request->neighborhood,
        'latitude' => $request->latitude,
        'longitude' => $request->longitude,
        'featured' => $request->featured,
        'hot' => $request->hot,
        'agent_id' => $request->agent_id,
        'updated_at' => Carbon::now(),

    ]);

    $notification = array(
        'message' => 'La propiedad se actualizo con éxito!',
        'alert-type' => 'success'
    );

    return redirect()->route('all.property')->with($notification);

} 
```
Listo!
## 71. Manage Property Update Single and Multiple Image Part 1
Agregarla seccion de poder actualizar la foto thumbnail principal.
En resources/views/backend/property/edit_property.blade.php
```php
{{-- Property Mail Thumbnail Image Update  --}}
<div class="page-content" style="margin-top: -35px">
    <div class="row profile-body">

        <!-- wrapper datos para editar con el total del ancho 12 columnas -->
        <div class="col-md-12 col-xl-12 middle-wrapper">
            <div class="row">

                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title">Editar Imagen Miniatura Principal</h6>

                        <form method="POST" action="{{ route('update.property') }}" id="myForm" enctype="multipart/form-data">
                        @csrf

                            {{-- Para capturar el id del record que queremos editar --}}
                            <input type="hidden" name="id" value="{{ $property->id }}">
                            {{-- Enviar también la imagen vieja para poder borrarla --}}
                            <input type="hidden" name="old_img" value="{{ $property->property_thambnail }}">

                            {{-- Escoger Nueva y Ver Imagen Miniatura Anterior --}}
                            <div class="row mb-3">

                                {{-- Escoger Nueva - picture thumbnail --}}
                                <div class="form-group col-md-6">
                                    <label class="form-label text-warning">Imagen Miniatura</label>
                                    <input type="file" name="property_thambnail" class="form-control"
                                        onChange="mainThamUrl(this)">
                                    <img src="" id="mainThmb">
                                </div>

                                {{-- picture thumbnail Anterior --}}
                                <div class="form-group col-md-6">
                                    <label class="form-label text-warning"></label>
                                    <img src="{{ asset($property->property_thambnail) }}" alt="" style="width: 100px; height: 100px;">
                                </div>

                            </div>

                            <button type="submit" class="btn btn-primary">Salvar Cambios</button>

                        </form>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div> 
```
Creamos otra forma bajo la otra forma para separalas y sea mas claro
lo que estamos tratando de actualizar.
En la roxiam leccion terminamos la ruta para que reemplaza la foto vieja por la nueva.
Listo!
## 72. Manage Property Update Single and Multiple Image Part 2
Vamos a crear el metodo para actualizar solo la Imagen Miniatura
En resources/views/backend/property/edit_property.blade.php
```php
<form method="POST" action="{{ route('update.property.thumbnail') }}" id="myForm" enctype="multipart/form-data">
```
Creamos la ruta en routes/web.php
```php
Route::post('/update/property/thumbnail', 'UpdatePropertyThumbnail')->name('update.property.thumbnail'); 
```
Creamos el metodo en el controlador app/Http/Controllers/Backend/PropertyController.php
```php
// Update Property Thumbnail
public function UpdatePropertyThumbnail(Request $request){

    $pro_id = $request->id;
    $oldImage = $request->old_img;

    $image = $request->file('property_thambnail');
    $name_gen = hexdec(uniqid()).'.'.$image->getClientOriginalExtension(); // crear un unique id para la imagen
    Image::make($image)->resize(370,250)->save('upload/property/thambnail/'.$name_gen);
    $save_url = 'upload/property/thambnail/'.$name_gen;

    // Remover la imagen anterior
    if (file_exists($oldImage)) {
        unlink($oldImage);
    }

    Property::findOrFail($pro_id)->update([

        'property_thambnail' => $save_url,
        'updated_at' => Carbon::now(),

    ]);

    $notification = array(
        'message' => 'La imagen miniatura fue actualizada con éxito!',
        'alert-type' => 'success'
    );

    return redirect()->back()->with($notification);
} 
```
Listo!
## 73. Manage Property Update Single and Multiple Image Part 3
Ahora vamos a update las imagenes multiples de la propiedad
Preparar las imagenes que vamos mandar a la vista en el metodo EditProperty en app/Http/Controllers/Backend/PropertyController.php
```php
public function EditProperty($id){
    ...
    // Cargar las imágenes de la tabla 'multi_images' que correspondan con el $id de la propiedad editada
    $multiImage = MultiImage::where('property_id',$id)->get();
    ...
    return view('backend.property.edit_property',compact('property','propertytype','amenities','activeAgent', 'property_ami', 'multiImage'));
} 
```
Y en la vista crear una forma mas, resources/views/backend/property/edit_property.blade.php
```php
<form method="POST" action="{{ route('update.property.thumbnail') }}" id="myForm" enctype="multipart/form-data">
    @csrf

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Serie</th>
                <th>Imagen</th>
                <th>Cambiar Imagen</th>
                <th>Actualizar - Eliminar</th>
            </tr>
        </thead>
        <tbody>
            @foreach ($multiImage as $key => $img)
                <tr>
                    <td>{{ $key+1 }}</td>
                    <td class="py-1">
                        <img src="{{ asset($img->photo_name) }}" alt="image" style="width: 50px; height: 50px;">
                    </td>
                    <td>
                        <input type="file" class="form-group" name="multi_img">
                    </td>
                    <td>
                        <input type="submit" class="btn btn-primary px-4" value="Actualizar Imagen">
                        <a href="" class="btn btn-danger" id="delete">Eliminar</a>
                    </td>
                </tr>
            @endforeach
        </tbody>
    </table>

    <br><br>
    <button type="submit" class="btn btn-primary">Salvar Cambios</button>

</form> 
```
En la siguiente leccion crearemos las rutas.
Listo!
## 74. Manage Property Update Single and Multiple Image Part 4
Cambiar el formato del input file, al estilo de nuestra plantilla usando la clase class="form-control"
En resources/views/backend/property/edit_property.blade.php
```php
<td>
    <input type="file" class="form-control" name="multi_img[{{ $img->id }}]">
</td>
```
La ruta en routes/web.php
```php
Route::post('/update/property/multi-image', 'UpdatePropertyMultiImage')->name('update.property.multi-image'); 
```
Y el metodo en app/Http/Controllers/Backend/PropertyController.php
```php
// Update Property Multi Image
public function UpdatePropertyMultiImage(Request $request){

    $imgs = $request->multi_img;

    foreach ($imgs as $id => $img) {
        // get img que vamos a unlink (reemplazar)
        $imgDel = MultiImage::findOrFail($id);
        unlink($imgDel->photo_name);

        $make_name = hexdec(uniqid()) . '.' . $img->getClientOriginalExtension();
        Image::make($img)->resize(770, 520)->save('upload/property/multi-image/' . $make_name);
        $uploadPath = 'upload/property/multi-image/' . $make_name;

        MultiImage::where('id', $id)->update([
            'photo_name' => $uploadPath,
            'updated_at' => Carbon::now(),
        ]);
    } //End foreach

    $notification = array(
        'message' => 'La multi-imagen fue actualizada con éxito!',
        'alert-type' => 'success'
    );

    return redirect()->back()->with($notification);
} 
```
Listo!
## 75. Multiple Image Delete
Eliminar una imagen de Multi Imagen
Primero asignar la ruta en el boton de borrar en resources/views/backend/property/edit_property.blade.php
```php
<td>
    <input type="submit" class="btn btn-primary px-4" value="Actualizar Imagen">
    <a href="{{ route('delete.property.multi-image', $img->id) }}" class="btn btn-danger" id="delete">Borrar</a>
</td> 
```
Definir la ruta en routes/web.php
```php
Route::get('/delete/property/multi-image/{id}', 'DeleteMultiImageProperty')->name('delete.property.multi-image'); 
```
Crear metodo en app/Http/Controllers/Backend/PropertyController.php
```php
// Eliminar una imagen de las de Multi Image de una propiedad
public function DeleteMultiImageProperty($id){
    $oldImg = MultiImage::findOrFail($id);
    unlink($oldImg->photo_name);

    MultiImage::findOrFail($id)->delete();

    $notification = array(
        'message' => 'La multi-imagen fue eliminada con éxito!',
        'alert-type' => 'success'
    );
    return redirect()->back()->with($notification);
} 
```
Listo!
## 76. Add Multi Image In Property
Crear una forma mas para poder añadir un Milti Imagen mas.
En resources/views/backend/property/edit_property.blade.php
```php
<form method="POST" action="{{ route('store.new.multi-image') }}" id="myForm" enctype="multipart/form-data">
@csrf

    <input type="hidden" name="imageId" value="{{ $property->id }}">

    <table class="table table-striped">
        <tbody>
            <tr>
                <td>
                    <input type="file" class="form-control" name="multi_img">
                </td>
                <td>
                    <input type="submit" class="btn btn-info px-4" value="Añadir Imagen">
                </td>
            </tr>
        </tbody>
    </table>

</form> 
```
Crear su ruta en routes/web.php
```php
Route::post('/store/new/multi-image', 'StoreNewMultiImage')->name('store.new.multi-image'); 
```
Crear el metodo en app/Http/Controllers/Backend/PropertyController.php
```php
// Store New Multi Image
public function StoreNewMultiImage(Request $request){

    $new_multi = $request->imageId;
    $image = $request->file('multi_img');


    if (!empty($image)) {

        $make_name = hexdec(uniqid()) . '.' . $image->getClientOriginalExtension();
        Image::make($image)->resize(770, 520)->save('upload/property/multi-image/' . $make_name);
        $uploadPath = 'upload/property/multi-image/' . $make_name;

        MultiImage::insert([
            'property_id' => $new_multi,
            'photo_name' => $uploadPath,
            'created_at' => Carbon::now(),
        ]);

        $notification = array(
            'message' => 'Multi-Imagen fue añadida con éxito!',
            'alert-type' => 'success'
        );

    } else {

        $notification = array(
            'message' => 'No hay Imagen para Añadir!',
            'alert-type' => 'warning'
        );
    }

    return redirect()->back()->with($notification);
}
```
Listo!
## 77. Manage Property Update Facility Part 1
Update Facilities - Actualizar Instalaciones Cercanas
Agregar una nueva forma (row) al final de la pagina
En resources/views/backend/property/edit_property.blade.php
```php
{{-- Update Facilities - Actualizar Instalaciones Cercanas  --}}
<div class="page-content" style="margin-top: -35px">
    <div class="row profile-body">
        <!-- wrapper datos para editar con el total del ancho 12 columnas -->
        <div class="col-md-12 col-xl-12 middle-wrapper">
            <div class="row">
                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title">Editar Instalaciones Cercanas de la Propiedad</h6>

                        <form method="POST" action="{{ route('update.property.thumbnail') }}" id="myForm" enctype="multipart/form-data">
                        @csrf

                        @foreach ($facilities as $item)

                            {{-- Facilities Option / Instalaciones Cercanas --}}
                            <div class="whole_extra_item_delete" id="whole_extra_item_delete">
                                <div class="container mt-2">
                                    <div class="row">

                                        <div class="form-group col-md-4">
                                            <label for="facility_name">Instalación Cercana</label>
                                            <select name="facility_name[]" id="facility_name" class="form-control">

                                                <option value="">Selecciona Instalación</option>
                                                <option value="Hospital" {{ $item->facility_name == 'Hospital' ? 'selected' : '' }}>Hospital</option>
                                                <option value="Super Mercado" {{ $item->facility_name == 'Super Mercado' ? 'selected' : '' }}>Super Mercado</option>
                                                <option value="Escuela" {{ $item->facility_name == 'Escuela' ? 'selected' : '' }}>Escuela</option>
                                                <option value="Entretenimiento" {{ $item->facility_name == 'Entretenimiento' ? 'selected' : '' }}>Entretenimiento</option>
                                                <option value="Farmacia" {{ $item->facility_name == 'Farmacia' ? 'selected' : '' }}>Farmacia</option>
                                                <option value="Aeropuerto" {{ $item->facility_name == 'Aeropuerto' ? 'selected' : '' }}>Aeropuerto</option>
                                                <option value="Estación de Tren" {{ $item->facility_name == 'Estación de Tren' ? 'selected' : '' }}>Estación de Tren</option>
                                                <option value="Parada de autobus" {{ $item->facility_name == 'Parada de autobus' ? 'selected' : '' }}>Parada de autobus</option>
                                                <option value="Playa" {{ $item->facility_name == 'Playa' ? 'selected' : '' }}>Playa</option>
                                                <option value="Centro Comercial" {{ $item->facility_name == 'Centro Comercial' ? 'selected' : '' }}>Centro Comercial</option>
                                                <option value="Banco" {{ $item->facility_name == 'Banco' ? 'selected' : '' }}>Banco</option>
                                                <option value="Cine" {{ $item->facility_name == 'Cine' ? 'selected' : '' }}>Cine</option>
                                                <option value="Restaurante" {{ $item->facility_name == 'Restaurante' ? 'selected' : '' }}>Restaurante</option>

                                            </select>
                                        </div>
                                        <div class="form-group col-md-4">
                                            <label for="distance">Distancia</label>
                                            <input type="text" name="distance[]" id="distance" class="form-control" value="{{ $item->distance }}">
                                        </div>
                                        <div class="form-group col-md-4" style="padding-top: 20px">
                                            <span class="btn btn-success btn-sm addeventmore"><i class="fa fa-plus-circle">Agregar</i></span>
                                            <span class="btn btn-danger btn-sm removeeventmore"><i class="fa fa-minus-circle">Remover</i></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        @endforeach

                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
```

Y en el metodo Edit pasar los facilities.
En app/Http/Controllers/Backend/PropertyController.php
```php
// Editar Datos de la Propiedad
public function EditProperty($id){

    // Cargar solo los datos de la tabla 'facilities' donde el 'property_id' es igual al $id de la Propiedad
    $facilities = Facility::where('property_id',$id)->get();

    // Cargar todos los datos de la tabla 'properties' donde el id es igual al $id pasado por la función
    $property = Property::findOrFail($id);

    $type = $property->amenities_id;
    $property_ami = explode(',', $type);

    // Cargar las imágenes de la tabla 'multi_images' que correspondan con el $id de la propiedad editada
    $multiImage = MultiImage::where('property_id',$id)->get();

    $propertytype = PropertyType::latest()->get();
    $amenities = Amenities::latest()->get();
    $activeAgent = User::where('status','active')->where('role','agent')->latest()->get();

    return view('backend.property.edit_property',compact('property','propertytype','amenities','activeAgent', 'property_ami', 'multiImage', 'facilities'));

} 
```
Listo!
## 78. Manage Property Update Facility Part 2
Empezamos creando la ruta en la forma en resources/views/backend/property/edit_property.blade.php
```php
<form method="POST" action="{{ route('update.property.facilities') }}" id="myForm" enctype="multipart/form-data"> 
```
Añadir la ruta en routes/web.php
```php
Route::post('/store/property/facilities', 'UpdatePropertyFacilities')->name('update.property.facilities'); 
```
Agregar el metodo en app/Http/Controllers/Backend/PropertyController.php
```php
// Update Property Facilities
public function UpdatePropertyFacilities(Request $request){

    $pid = $request->id;

    if ($request->facility_name == NULL) {
        return redirect()->back();
    }else{
        // Borrar registro
        Facility::where('property_id', $pid)->delete();

        // Si queda algún registro Insertar datos a tabla 'facilities'
        $facilities = Count($request->facility_name);
        for ($i=0; $i < $facilities; $i++) {
            $fcount = new Facility();
            $fcount->property_id = $pid;
            $fcount->facility_name = $request->facility_name[$i];
            $fcount->distance = $request->distance[$i];
            $fcount->save();
        }
    }

    $notification = array(
        'message' => 'Instalaciones cercanas actualizadas con éxito!',
        'alert-type' => 'success'
    );
    return redirect()->back()->with($notification);
} 
```
El codigo de la forma en resources/views/backend/property/edit_property.blade.php
```php
<form method="POST" action="{{ route('update.property.facilities') }}" id="myForm" enctype="multipart/form-data">
@csrf

    {{-- Para capturar el id del record que queremos editar --}}
    <input type="hidden" name="id" value="{{ $property->id }}">

    @foreach ($facilities as $item)

    {{-- Facilities Option / Instalaciones Cercanas --}}
    <div class="row add_item">
        <div class="whole_extra_item_add" id="whole_extra_item_add">
            <div class="whole_extra_item_delete" id="whole_extra_item_delete">
                <div class="container mt-2">
                    <div class="row">
                        {{-- Input Instalación Cercana con un Select --}}
                        <div class="form-group col-md-4">
                            <label for="facility_name">Instalación Cercana</label>
                            <select name="facility_name[]" id="facility_name" class="form-control">

                                <option value="">Selecciona Instalación</option>
                                <option value="Hospital" {{ $item->facility_name == 'Hospital' ? 'selected' : '' }}>Hospital</option>
                                <option value="Super Mercado" {{ $item->facility_name == 'Super Mercado' ? 'selected' : '' }}>Super Mercado</option>
                                <option value="Escuela" {{ $item->facility_name == 'Escuela' ? 'selected' : '' }}>Escuela</option>
                                <option value="Entretenimiento" {{ $item->facility_name == 'Entretenimiento' ? 'selected' : '' }}>Entretenimiento</option>
                                <option value="Farmacia" {{ $item->facility_name == 'Farmacia' ? 'selected' : '' }}>Farmacia</option>
                                <option value="Aeropuerto" {{ $item->facility_name == 'Aeropuerto' ? 'selected' : '' }}>Aeropuerto</option>
                                <option value="Estación de Tren" {{ $item->facility_name == 'Estación de Tren' ? 'selected' : '' }}>Estación de Tren</option>
                                <option value="Parada de autobus" {{ $item->facility_name == 'Parada de autobus' ? 'selected' : '' }}>Parada de autobus</option>
                                <option value="Playa" {{ $item->facility_name == 'Playa' ? 'selected' : '' }}>Playa</option>
                                <option value="Centro Comercial" {{ $item->facility_name == 'Centro Comercial' ? 'selected' : '' }}>Centro Comercial</option>
                                <option value="Banco" {{ $item->facility_name == 'Banco' ? 'selected' : '' }}>Banco</option>
                                <option value="Cine" {{ $item->facility_name == 'Cine' ? 'selected' : '' }}>Cine</option>
                                <option value="Restaurante" {{ $item->facility_name == 'Restaurante' ? 'selected' : '' }}>Restaurante</option>

                            </select>
                        </div>
                        {{-- Input Distancia --}}
                        <div class="form-group col-md-4">
                            <label for="distance">Distancia</label>
                            <input type="text" name="distance[]" id="distance" class="form-control" value="{{ $item->distance }}">
                        </div>
                        {{-- Botones de Agregar y Remover --}}
                        <div class="form-group col-md-4" style="padding-top: 20px">
                            <span class="btn btn-success btn-sm addeventmore"><i class="fa fa-plus-circle">Agregar</i></span>
                            <span class="btn btn-danger btn-sm removeeventmore"><i class="fa fa-minus-circle">Remover</i></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @endforeach

    <br><br>
    <button type="submit" class="btn btn-primary">Salvar Cambios</button>

</form> 
```
Listo!
## 79. Property Delete With Multiple Image
Eliminar una Propiedad.
Empezamos por determinar una ruta en resources/views/backend/property/all_property.blade.php
```php
<a href="{{ route('delete.property',$item->id) }}" class="btn btn-inverse-danger" id="delete">Borrar</a> 
```
Creamos su ruta en routes/web.php
```php
Route::get('/delete/property/{id}', 'DeleteProperty')->name('delete.property'); 
```
Creamos su controlador en app/Http/Controllers/Backend/PropertyController.php
```php
// Delete Property
public function DeleteProperty($id){

    // Encontrar el registro en la tabla 'properties' y eliminarlo con todo y foto de thumbnail
    $property = Property::findOrFail($id);
    unlink($property->property_thambnail);
    Property::findOrFail($id)->delete();

    // Ahora eliminar todas las multi fotos relacionadas con este registro $id
    $images = MultiImage::where('property_id',$id)->get();
    foreach ($images as $img) {
        unlink($img->photo_name);
        MultiImage::where('property_id',$id)->delete();
    }

    // Ahora eliminar todos los facilities de tabla 'facilities' donde 'property_id' sea igual al $id
    $comodidades = Facility::where('property_id',$id)->get();
    foreach ($comodidades as $item) {
        $item->facility_name;
        Facility::where('property_id',$id)->delete();
    }

    $notification = array(
        'message' => 'Propiedad Eliminada con éxito!',
        'alert-type' => 'success'
    );
    return redirect()->back()->with($notification);
} 
```
Listo!
## 80. Create Property Details Page Part 1
Vamos hacer la vista de detalle.
De una vez aprovechamos para agregar unos iconos que trae nuestra plantilla.
En resources/views/backend/property/all_property.blade.php
```php
<td>
    <a href="{{ route('details.property',$item->id) }}" class="btn btn-inverse-info" title="Detalles"><i data-feather="eye"></i></a>

    <a href="{{ route('edit.property',$item->id) }}" class="btn btn-inverse-warning" title="Editar"><i data-feather="edit"></i></a>

    <a href="{{ route('delete.property',$item->id) }}" class="btn btn-inverse-danger" id="delete" title="Eliminar"><i data-feather="trash-2"></i></a>

</td> 
```
En routes/web.php
```php
Route::get('/details/property/{id}', 'DetailsProperty')->name('details.property'); 
```
En app/Http/Controllers/Backend/PropertyController.php
```php
// Details Property - Desplegar solo los detalles de una propiedad en una sola pagina
public function DetailsProperty($id){

    // Cargar solo los datos de la tabla 'facilities' donde el 'property_id' es igual al $id de la Propiedad
    $facilities = Facility::where('property_id',$id)->get();

    // Cargar todos los datos de la tabla 'properties' donde el id es igual al $id pasado por la función
    $property = Property::findOrFail($id);

    $type = $property->amenities_id;
    $property_ami = explode(',', $type);

    // Cargar las imágenes de la tabla 'multi_images' que correspondan con el $id de la propiedad editada
    $multiImage = MultiImage::where('property_id',$id)->get();

    $propertytype = PropertyType::latest()->get();
    $amenities = Amenities::latest()->get();
    $activeAgent = User::where('status','active')->where('role','agent')->latest()->get();

    return view('backend.property.details_property',compact('property','propertytype','amenities','activeAgent', 'property_ami', 'multiImage', 'facilities'));
} 
```
Y en la vista resources/views/backend/property/details_property.blade.php
```php
{{-- Primer Tabla a la Izquierda --}}
<div class="col-md-6 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <h6 class="card-title">Detalles Propiedad</h6>
            <p class="text-muted mb-3">Add class <code>.table</code></p>
            <div class="table-responsive">
                <table class="table table-striped">

                    <tbody>

                        <tr>
                            <td>Nombre</td>
                            <td>{{ $property->property_name }}</td>
                        </tr>

                        <tr>
                            <td>Estatus</td>
                            <td>{{ $property->property_status }}</td>
                        </tr>

                    </tbody>

                </table>
            </div>
        </div>
    </div>
</div> 
```
Listo!
## 81. Create Property Details Page Part 2
Continuamos llenando de datos las dos tablas.
En resources/views/backend/property/details_property.blade.php
```php
{{-- Segunda Tabla a la Derecha --}}
<div class="col-md-6 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <tbody>

                        <tr>
                            <td>Código</td>
                            <td><code>{{ $property->property_code }}</code></td>
                        </tr>

                        <tr>
                            <td>Tamaño</td>
                            <td><code>{{ $property->property_size }}</code></td>
                        </tr>

                        <tr>
                            <td>Video</td>
                            <td><code>{{ $property->property_video }}</code></td>
                        </tr>

                        <tr>
                            <td>Vecindario</td>
                            <td><code>{{ $property->neighborhood }}</code></td>
                        </tr>

                        <tr>
                            <td>Latitud</td>
                            <td><code>{{ $property->latitude }}</code></td>
                        </tr>

                        <tr>
                            <td>Longitud</td>
                            <td><code>{{ $property->longitude }}</code></td>
                        </tr>

                        <tr>
                            <td>Tipo</td>
                            <td><code>{{ $property['type']['type_name'] }}</code></td>
                        </tr>

                        <tr>
                            <td>Comodidades</td>
                            <td>
                                <select name="amenities_id[]" class="js-example-basic-multiple form-select" multiple="multiple" data-width="100%">
                                    @foreach($amenities as $ameni)
                                        <option value="{{ $ameni->id }}" {{ (in_array($ameni->id, $property_ami)) ? 'selected' : '' }}>{{ $ameni->amenities_name }}</option>
                                    @endforeach
                                </select>
                            </td>
                        </tr>

                        <tr>
                            <td>Agente</td>
                            <td>
                                @if ($property->agent_id == NULL)
                                    <td><code> Admin </code></td>
                                @else
                                    <td><code>{{ $property['user']['name'] }}</code></td>
                                @endif
                            </td>
                        </tr>

                        {{-- <tr>
                            <td>Descripción Corta</td>
                            <td><code>{{ $property->short_descp }}</code></td>
                        </tr> --}}

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div> 
```
Para desplegar lso odatos que tiene una relacion:
```php
<tr>
    <td>Tipo</td>
    <td><code>{{ $property['type']['type_name'] }}</code></td>
</tr> 

<tr>
    <td>Agente</td>
    <td>
        @if ($property->agent_id == NULL)
            <td><code> Admin </code></td>
        @else
            <td><code>{{ $property['user']['name'] }}</code></td>
        @endif
    </td>
</tr>
```
Tenemos que asignar la relacion al modelo app/Models/Property.php
```php
// Relación del campo 'ptype_id' con el 'id' de la tabla 'property_types'
public function type(){
    return $this->belongsTo(PropertyType::class,'ptype_id','id');
}

// Relación del campo 'agent_id' con el 'id' de la tabla 'users'
public function user(){
    return $this->belongsTo(User::class,'agent_id','id');
} 
```
Listo!
## 82. Property Active Inactive Form Details Page
Agrgar boton para Activar o Desactivar la Propiedad
En resources/views/backend/property/details_property.blade.php
```php
<br><br>
{{-- Desplegar forma  para  cambiar estado de del 'status' --}}
@if ($property->status == 1)
    <form method="POST" action="{{ route('inactive.property') }}">
    @csrf
        <input type="hidden" name="id" value="{{ $property->id }}">
        <button type="submit" class="btn btn-primary">Desactivar</button>
    </form>
@else
    <form method="POST" action="{{ route('active.property') }}">
    @csrf
        <input type="hidden" name="id" value="{{ $property->id }}">
        <button type="submit" class="btn btn-primary">Activar</button>
    </form>
@endif 
```
En routes/web.php
```php
Route::post('/inactive/property', 'InactiveProperty')->name('inactive.property');
Route::post('/active/property', 'ActiveProperty')->name('active.property'); 
```
En app/Http/Controllers/Backend/PropertyController.php
```php
// Cambiar el status de la propiedad a Inactiva
public function InactiveProperty(Request $request){

    $pid = $request->id;
    Property::findOrFail($pid)->update([
        'status' => 0,
    ]);

    $notification = array(
        'message' => 'Estado de Propiedad Inactiva!',
        'alert-type' => 'success'
    );
    return redirect()->route('all.property')->with($notification);
}

// Cambiar el status de la propiedad a Activa
public function ActiveProperty(Request $request){

    $pid = $request->id;
    Property::findOrFail($pid)->update([
        'status' => 1,
    ]);

    $notification = array(
        'message' => 'Estado de Propiedad Activa!',
        'alert-type' => 'success'
    );
    return redirect()->route('all.property')->with($notification);
} 
```
Listo!
## 83. Bug Fixed for Redirect Login Page
El Bug que tenemos ahorita es:
Si estamos login como admin y visitamos: http://realestate.test/admin/login
nos manda a la pagina de login de admin, y no es corercto pues ya estamos login.
La solucion es modifucar el middleware que usa laravel breeze.

Vamos customizar la redireccion del home page 
en app/Http/Middleware/RedirectIfAuthenticated.php
```php
public function handle(Request $request, Closure $next, string ...$guards): Response
{
    $guards = empty($guards) ? [null] : $guards;

    foreach ($guards as $guard) {
        if (Auth::guard($guard)->check()) {

            if (Auth::check() && Auth::user()->role == 'user') {
                return redirect('/dashboard');
            }

            if (Auth::check() && Auth::user()->role == 'agent') {
                return redirect('/agent/dashboard');
            }

            if (Auth::check() && Auth::user()->role == 'admin') {
                return redirect('/admin/dashboard');
            }

        }
    }

    return $next($request);
} 
```
Ahora usar este middleware en routes/web.php
Pra proteger a nuestra ruta de admin
```php
use App\Http\Middleware\RedirectIfAuthenticated;

Route::get('/admin/login', [AdminController::class, 'AdminLogin'])->name('admin.login')->middleware(RedirectIfAuthenticated::class);
```
Listo!






# Sección 11 - Add Agent Register Page Setup
## 84. Add Agent Register Page Setup Part 1
Crear las ruta pertinente al login de agente!
Organize mejor las rutas en routes/web.php
```php
Route::get('/agent/login', [AgentController::class, 'AgentLogin'])->name('agent.login')->middleware(RedirectIfAuthenticated::class); 
```
En el controlador app/Http/Controllers/AgentController.php
```php
// Agent Login
public function AgentLogin(){
    return view('agent.agent_login');
} 
```
En la vista resources/views/agent/agent_login.blade.php
Copiamos la misma vista de resources/views/auth/login.blade.php
Y la modificamos ligeramente para visualizar que es login y registro para Agente
```php
...
{{-- Tabs Login y Register --}}
<div class="tab-btn-box">
    <ul class="tab-btns tab-buttons centred clearfix">
        <li class="tab-btn active-btn" data-tab="#tab-1">Acceso Agente</li>
        <li class="tab-btn" data-tab="#tab-2"> Registro Agente</li>
    </ul>
</div>

...
{{-- tab-1 Login --}}
<div class="tab active-tab" id="tab-1">
    <div class="inner-box">
        <h4>Inicia Sesión Agente</h4>
        ...

{-- tab-2 Regístrate --}}
<div class="tab" id="tab-2">
    <div class="inner-box">
        <h4>Registro de Agente</h4>
        ...
...
```
Listo!
## 85. Add Agent Register Page Setup Part 2
En resources/views/agent/agent_login.blade.php
```php
<form action="{{ route('agent.register') }}" method="POST" class="default-form">
@csrf

    {{-- Nombre --}}
    <div class="form-group">
        <label>Nombre Agente</label>
        <input type="text" name="name" id="name" required="">
    </div>

    {{-- Email --}}
    <div class="form-group">
        <label>Correo Electrónico</label>
        <input type="email" name="email" id="email" required="">
    </div>

    {{-- Phone --}}
    <div class="form-group">
        <label>Teléfono</label>
        <input type="text" name="phone" id="phone" required="">
    </div>

    {{-- Password --}}
    <div class="form-group">
        <label>Contraseña</label>
        <input type="password" name="password" id="password" required="">
    </div>


    {{-- botón regístrate --}}
    <div class="form-group message-btn">
        <button type="submit" class="theme-btn btn-one">Regístrate</button>
    </div>

</form> 
```
En routes/web.php
```php
Route::post('/agent/register', [AgentController::class, 'AgentRegister'])->name('agent.register'); 
```
En app/Http/Controllers/AgentController.php
```php
// Registro de Agent
public function AgentRegister(Request $request){

    $user = User::create([
        'name' => $request->name,
        'email' => $request->email,
        'phone' => $request->phone,
        'password' => Hash::make($request->password),
        'role' => 'agent',
        'status' => 'inactive',
    ]);

    event(new Registered($user));
    Auth::login($user);
    return redirect(RouteServiceProvider::AGENT);
} 
```
Para el codigo de AgentRegister() tomamos como base el de app/Http/Controllers/Auth/RegisteredUserController.php

Y en app/Providers/RouteServiceProvider.php
```php
public const HOME = '/dashboard';
public const AGENT = '/agent/dashboard'; 
```
Listo!





# Sección 12 - Project Agent Panel Setup
## 86. Agent Template Setup
Copiar de admin y modificar:
- resources/views/agent/index.blade.php
- resources/views/agent/agent_dashboard.blade.php
- resources/views/agent/body/footer.blade.php
- resources/views/agent/body/header.blade.php
- resources/views/agent/body/sidebar.blade.php
Y en app/Http/Controllers/AgentController.php:
```php
// Agent Dashboard
public function AgentDashboard(){
    return view('agent.index');
} 
```
Listo!
## 87. Agent Logout Option
En resources/views/agent/body/header.blade.php
```php
{{-- Log Out --}}
<li class="dropdown-item py-2">
    <a href="{{ route('agent.logout') }}" class="text-body ms-0">
        <i class="me-2 icon-md" data-feather="log-out"></i>
        <span>Cierra Sesión</span>
    </a>
</li> 
```
En routes/web.php
```php
// Agent group middleware
Route::middleware(['auth','role:agent'])->group(function(){
    Route::get('/agent/dashboard', [AgentController::class, 'AgentDashboard'])->name('agent.dashboard');
    Route::get('/agent/logout', [AgentController::class, 'AgentLogout'])->name('agent.logout');
}); 
```
En app/Http/Controllers/AgentController.php
```php
// Agent Logout
public function AgentLogout(Request $request)
{
    Auth::guard('web')->logout();
    $request->session()->invalidate();
    $request->session()->regenerateToken();

    $notification = array(
        'message' => 'Agente Cierre de Sesión Exitosa',
        'alert-type' => 'success'
    );

    return redirect('/agent/login')->with($notification);
} 
```
Listo!
## 88. Agent Profile & Image Update
Varios Archivos Ver Este Commit
Listo!
## 89. Agent Profile Change Password
En resources/views/agent/body/header.blade.php
```php
{{-- Edit Profile --}}
<li class="dropdown-item py-2">
    <a href="{{ route('agent.change.password') }}" class="text-body ms-0">
        <i class="me-2 icon-md" data-feather="edit"></i>
        <span>Cambiar Contraseña</span>
    </a>
</li> 
```
En routes/web.php
```php
Route::get('/agent/change/password', [AgentController::class, 'AgentChangePassword'])->name('agent.change.password');
Route::post('/agent/update/password', [AgentController::class, 'AgentUpdatePassword'])->name('agent.update.password'); 
```
En app/Http/Controllers/AgentController.php
```php
// Agent Change Password
public function AgentChangePassword(){
    $id = Auth::user()->id;
    $profileData = User::find($id);
    return view('agent.agent_change_password', compact('profileData'));
}

// Agent Update Password
public function AgentUpdatePassword(Request $request){
    // Validation
    $request->validate([

        'old_password' => 'required',
        'new_password' => 'required|confirmed'

    ]);


    // Match The Old Password
    if (!Hash::check($request->old_password, auth::user()->password)) {
        $notification = array(
            'message' => 'Contraseña Vieja NO coincide!',
            'alert-type' => 'error'
        );
        return back()->with($notification);
    }

    // Update The New Password
    User::whereId(auth()->user()->id)->update([
        'password' => Hash::make($request->new_password)
    ]);

    $notification = array(
        'message' => 'Contraseña actualizada con éxito!',
        'alert-type' => 'success'
    );

    return back()->with($notification);
} 
```
En resources/views/agent/agent_change_password.blade.php
```php
{{-- Foto --}}
<div>
    <img class="wd-100 rounded-circle" src="{{ (!empty($profileData->photo)) ? url('upload/agent_images/'.$profileData->photo) : url('upload/no_image.jpg') }}" alt="profile">
    <span class="h4 ms-3">{{ $profileData->username }}</span>
</div> 
```
Listo!

# Sección 13 - Manage Agent In Admin Dashboard
## 90. Manage Agent In admin Page Part 1
En resources/views/admin/body/sidebar.blade.php
```php
<li class="nav-item">
    <a href="{{ route('all.agent') }}" class="nav-link">Todos</a>
</li> 
```
En routes/web.php
Agregar rutas en // Admin group middleware, Property Type, Amenities, and Property, All Routes
```php
// Agent All Routes desde Admin
Route::controller(AdminController::class)->group(function(){
    Route::get('/all/agent', 'AllAgent')->name('all.agent');
}); 
```
En app/Http/Controllers/AdminController.php
```php
// Desplegar todos los Agentes
public function AllAgent(){
    $allAgents = User::where('role','agent')->get();
    return view('backend.agentuser.all_agent',  compact('allAgents'));
} 
```
En resources/views/backend/agentuser/all_agent.blade.php
```php
<table id="dataTableExample" class="table">

    <thead>

        <tr>
            <th>Serie</th>
            <th>Imagen</th>
            <th>Nombre</th>
            <th>Rol</th>
            <th>Estatus</th>
            <th>Cambiar</th>
            <th>Acción</th>
        </tr>

    </thead>

    <tbody>

        @foreach ($allAgents as $key => $item)
        <tr>
            <td>{{ $key+1 }}</td>
            <td><img src="{{ (!empty($item->photo)) ? url('upload/agent_images/'.$item->photo) : url('upload/no_image.jpg') }}" style="width: 70px; height: 40px;"></td>
            <td>{{ $item->name }}</td>
            <td>{{ $item->role }}</td>

            <td>
                @if ($item->status == 'active')
                    <span class="badge rounded-pill bg-success">Activo</span>
                @else
                    <span class="badge rounded-pill bg-danger">Inactivo</span>
                @endif
            </td>

            <td>
                Cambiar
            </td>

            <td>

                <a href="{{ route('edit.property',$item->id) }}" class="btn btn-inverse-warning" title="Editar"><i data-feather="edit"></i></a>

                <a href="{{ route('delete.property',$item->id) }}" class="btn btn-inverse-danger" id="delete" title="Eliminar"><i data-feather="trash-2"></i></a>
            </td>

        </tr>
        @endforeach

    </tbody>
</table> 
```
Listo!
## 91. Manage Agent In admin Page Part 2
En resources/views/backend/agentuser/all_agent.blade.php
```php
<a href="{{ route('add.agent') }}" class="btn btn-inverse-info">Añadir Agente</a> 
```
En routes/web.php
```php
Route::get('/add/agent', 'AddAgent')->name('add.agent'); 
```
En app/Http/Controllers/AdminController.php
```php
// Añadir Agente
public function AddAgent(){
    return view('backend.agentuser.add_agent');
} 
```
En resources/views/backend/agentuser/add_agent.blade.php
```php
<form id="myForm" method="POST" action="{{ route('store.agent') }}" class="forms-sample"> 
```
En routes/web.php
```php
Route::post('/store/agent', 'StoreAgent')->name('store.agent'); 
```
En app/Http/Controllers/AdminController.php
```php
// Almacenar Agent a Base de Datos
public function StoreAgent(Request $request){
    User::insert([
        'name' => $request->name,
        'email' => $request->email,
        'phone' => $request->phone,
        'address' => $request->address,
        'password' => Hash::make($request->password),
        'role' => 'agent',
        'status' => 'active',
    ]);

    $notification = array(
        'message' => 'Agente Creado con éxito!',
        'alert-type' => 'success'
    );

    return redirect()->route('all.agent')->with($notification);
} 
```
Lito!
## 92. Manage Agent In admin Page Part 3
Implementar la ruta de Editar
En resources/views/backend/agentuser/all_agent.blade.php
```php
<a href="{{ route('edit.agent',$item->id) }}" class="btn btn-inverse-warning" title="Editar"><i data-feather="edit"></i></a> 
```
En routes/web.php
```php
Route::get('/edit/agent/{id}', 'EditAgent')->name('edit.agent'); 
```
En app/Http/Controllers/AdminController.php
```php
// Edit Agent
public function EditAgent($id){
    $allAgents = User::findOrFail($id);
    return view('backend.agentuser.edit_agent',  compact('allAgents'));
} 
```
Y en resources/views/backend/agentuser/edit_agent.blade.php
Va a ser tal cual resources/views/backend/agentuser/add_agent.blade.php asi que copiamos todo de ahi.
```php
<form id="myForm" method="POST" action="{{ route('update.agent') }}" class="forms-sample">
@csrf

    <input type="hidden" name="id" value="{{ $allAgents->id }}">

    {{-- Name --}}
    <div class="form-group mb-3">
        <label for="amenities_name" class="form-label">Nombre Agente</label>
        <input type="text" name="name" class="form-control" value="{{ $allAgents->name }}">
    </div>

    {{-- Email --}}
    <div class="form-group mb-3">
        <label for="amenities_name" class="form-label">Correo Electrónico</label>
        <input type="email" name="email" class="form-control" value="{{ $allAgents->email }}">
    </div>

    {{-- Phone --}}
    <div class="form-group mb-3">
        <label for="amenities_name" class="form-label">Teléfono</label>
        <input type="text" name="phone" class="form-control" value="{{ $allAgents->phone }}">
    </div>

    {{-- Address --}}
    <div class="form-group mb-3">
        <label for="amenities_name" class="form-label">Dirección</label>
        <input type="text" name="address" class="form-control" value="{{ $allAgents->address }}">
    </div>

    <button type="submit" class="btn btn-primary me-2">Guardar Cambios</button>

</form> 
```
Para la Ruta update.agent en routes/web.php
```php
Route::post('/update/agent', 'UpdateAgent')->name('update.agent'); 
```
En app/Http/Controllers/AdminController.php
```php
// Update Agent
public function UpdateAgent(Request $request){
    $user_id = $request->id;

    User::findOrFail($user_id)->update([
        'name' => $request->name,
        'email' => $request->email,
        'phone' => $request->phone,
        'address' => $request->address,
    ]);

    $notification = array(
        'message' => 'Agente Actualizado con éxito!',
        'alert-type' => 'success'
    );

    return redirect()->route('all.agent')->with($notification);
} 
```

Ahora vamos a implementar el Delete
En resources/views/backend/agentuser/all_agent.blade.php
```php
<a href="{{ route('delete.agent',$item->id) }}" class="btn btn-inverse-danger" id="delete" title="Eliminar"><i data-feather="trash-2"></i></a> 
```
En routes/web.php
```php
Route::get('/delete/agent/{id}', 'DeleteAgent')->name('delete.agent'); 
```
En app/Http/Controllers/AdminController.php
```php
// Delete Agent
public function DeleteAgent($id){
    User::findOrFail($id)->delete();
    $notification = array(
        'message' => 'Agente Eliminado con éxito!',
        'alert-type' => 'success'
    );
    return redirect()->back()->with($notification);
} 
```
Listo!
## 93. Active Inactive In Agent Dashboard
Cuando hagamos que el Agent este en 'status' "inactive", entonces el Agent no podra
accesar las opciones del sidebar.
En resources/views/agent/index.blade.php
```php
@php
    // Obtener el id del usuario que esta login
    $id = Auth::user()->id;
    $agentId = App\Models\User::find($id); // Con esto traemos a todo el objeto
    $status = $agentId->status;

    // Los podríamos obtener asi también
    // $name = Auth::user()->name;
    // $status = Auth::user()->status;
@endphp

{{-- Contenido --}}
<div class="page-content">

    @if ($status === 'active')
        <h6>Cuenta: <span class="text-success">Activa</span></h6>
    @else
        <h6>Cuenta: <span class="text-danger">Inactiva</span></h6>
        <p class="text-danger">Espere a que el <b>Admin</b> apruebe su cuenta!</p>
    @endif

    ...
```
Y en resources/views/agent/body/sidebar.blade.php
```php
...
{{-- Menus SideBar --}}
@if ($status === 'active')
    {{-- * Menus para Agente --}} 
    {{-- Calendar --}}
    {{-- * COMPONENTS --}}
    {{-- UI Kit --}}
    {{-- Advanced UI --}}
@else

@endif
{{-- * DOCS --}}
<li class="nav-item nav-category">Docs</li>
<li class="nav-item">
    <a href="#" target="_blank" class="nav-link">
        <i class="link-icon" data-feather="hash"></i>
        <span class="link-title">Documentation</span>
    </a>
</li>
...
```
Listo!
## 94. Active Inactive Agent From Admin Page
Vamos a usar codigo JS para que nos ayude hacer un boton de toggle.
con un boton en la lista de Agentes de Admin poder toggle el status del agent.
En resources/views/backend/agentuser/all_agent.blade.php
```php
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">

...

<td>
    <input data-id="{{ $item->id }}" class="toggle-class" type="checkbox" data-onstyle="success" data-offstyle="danger"  data-toggle="toggle" data-on="ESTATUS" data-off="ESTATUS" {{ $item->status ? 'checked' : '' }} >
</td>

...

{{-- JS para el botón de toggle de active o inactive agent --}}
<script type="text/javascript">
  $(function() {
    $('.toggle-class').change(function() {
        var status = $(this).prop('checked') == true ? 'active' : 'inactive';
        var user_id = $(this).data('id');

        $.ajax({
            type: "GET",
            dataType: "json",
            url: '/changeStatus',
            data: {'status': status, 'user_id': user_id},
            success: function(data){
                // console.log(data.success)

                // Start Message
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    icon: 'success',
                    showConfirmButton: false,
                    timer: 3000
                })
                if ($.isEmptyObject(data.error)) {
                        Toast.fire({
                        type: 'success',
                        title: data.success,
                        })
                }else{
                        Toast.fire({
                        type: 'error',
                        title: data.error,
                        })
                }
                // End Message

                // para refrescar la ventana
                window.location.reload();
            }
        });
    })
  })
</script>

```

En resources/views/admin/admin_dashboard.blade.php
```php
al final de la pagina
...
{{-- Para el boton de toggle en resources/views/backend/agentuser/all_agent.blade.php --}}
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script 
```
Listo!

# Sección 14 - Backend Add Property From Agent
## 95. Add Property From Agent Part 1
Crear controlador nuevo para manejar las propiedades por el Agente
```php
php artisan make:controller Agent/AgentPropertyController    
```

En resources/views/agent/body/sidebar.blade.php
```php
<a href="{{ route('agent.all.property') }}" class="nav-link">Todas las Propiedades</a> 
```

En routes/web.php
```php
// Agent group middleware - Propiedades
Route::middleware(['auth','role:agent'])->group(function(){

    // Grupo de Rutas AgentPropertyController - Propiedades
    Route::controller(AgentPropertyController::class)->group(function(){

        Route::get('/agent/all/property', 'AgentAllProperty')->name('agent.all.property');

    });

}); 
```

En app/Http/Controllers/Agent/AgentPropertyController.php
```php
<?php

namespace App\Http\Controllers\Agent;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use App\Models\Property;
use App\Models\MultiImage;
use App\Models\Facility;
use App\Models\Amenities;
use App\Models\PropertyType;
use App\Models\User;
use Intervention\Image\Facades\Image;
use Haruncpi\LaravelIdGenerator\IdGenerator;
use Carbon\Carbon;
use Illuminate\Support\Facades\Auth;

class AgentPropertyController extends Controller
{
    // Despliega todas las Propiedades para el Agente
    public function AgentAllProperty(){
        $id = Auth::user()->id;
        $property = Property::where('agent_id', $id)->latest()->get();
        return view('agent.property.all_property', compact('property'));
    }
} 
```

En resources/views/agent/property/all_property.blade.php
Copiamos todo de: resources/views/backend/property/all_property.blade.php

Listo!
## 96. Add Property From Agent Part 2
Agregar liga add property para el agente en resources/views/agent/property/all_property.blade.php
```php
<a href="{{ route('agent.add.property') }}" class="btn btn-inverse-info">Añadir Propiedad</a> 
```
Y en el sidebar resources/views/agent/body/sidebar.blade.php
```php
<li class="nav-item">
    <a href="{{ route('agent.add.property') }}" class="nav-link">Añadir una Propiedad</a>
</li> 
```
En routes/web.php
```php
Route::get('/agent/add/property', 'AgentAddProperty')->name('agent.add.property'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
```php
// Añadir Una Propiedad
public function AgentAddProperty(){
    $propertytype = PropertyType::latest()->get();
    $amenities = Amenities::latest()->get();
    return view('agent.property.add_property',compact('propertytype','amenities'));
} 
```
Y en resources/views/agent/property/add_property.blade.php
Copiamos de resources/views/backend/property/add_property.blade.php
y hacemos muy pocos cambios.

Para la ruta de la forma en resources/views/agent/property/add_property.blade.php
```php
<form method="POST" action="{{ route('agent.store.property') }}" id="myForm" enctype="multipart/form-data"> 
```
En routes/web.php
```php
Route::post('/agent/store/property', 'AgentStoreProperty')->name('agent.store.property'); 
```
Y en app/Http/Controllers/Agent/AgentPropertyController.php
Copiamos el mismo procedimiento de app/Http/Controllers/Backend/PropertyController.php
Lo unico que vamos a cambiar el el 'agent_id' => $request->agent_id, a:
```php
public function AgentStoreProperty(Request $request){
...
'agent_id' => Auth::user()->id,
...
return redirect()->route('agent.all.property')->with($notification);
} 
```
Listo!
## 97. Add Property From Agent Part 3
Editar
En resources/views/agent/property/all_property.blade.php
```php
<a href="{{ route('agent.edit.property',$item->id) }}" class="btn btn-inverse-warning" title="Editar"><i data-feather="edit"></i></a> 
```
En routes/web.php
```php
Route::get('/agent/edit/property/{id}', 'AgentEditProperty')->name('agent.edit.property'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php 
copiar de app/Http/Controllers/Backend/PropertyController.php
Y solo remover activeAgent
```php
// Editar Datos de la Propiedad
public function AgentEditProperty($id){

    // Cargar solo los datos de la tabla 'facilities' donde el 'property_id' es igual al $id de la Propiedad
    $facilities = Facility::where('property_id',$id)->get();

    // Cargar todos los datos de la tabla 'properties' donde el id es igual al $id pasado por la función
    $property = Property::findOrFail($id);

    $type = $property->amenities_id;
    $property_ami = explode(',', $type);

    // Cargar las imágenes de la tabla 'multi_images' que correspondan con el $id de la propiedad editada
    $multiImage = MultiImage::where('property_id',$id)->get();

    $propertytype = PropertyType::latest()->get();
    $amenities = Amenities::latest()->get();

    return view('agent.property.edit_property',compact('property','propertytype','amenities', 'property_ami', 'multiImage', 'facilities'));

} 
```
En resources/views/agent/property/edit_property.blade.php
copiar de resources/views/backend/property/edit_property.blade.php
Quitar la parte de Seleccionar Agente
Ya despliega bien la pagina para editar propiedad.
Para la ruta de la primar forma:
```php
<form method="POST" action="{{ route('agent.update.property') }}" id="myForm" enctype="multipart/form-data"> 
```
En routes/web.php
```php
Route::post('/agent/update/property', 'AgentUpdateProperty')->name('agent.update.property'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
copiar el metodo de app/Http/Controllers/Backend/PropertyController.php
y solo quitar 'agent_id' => $request->agent_id, reemplazarlo con:
```php
'agent_id' => Auth::user()->id, 
...
return redirect()->route('agent.all.property')->with($notification);
```
Ya funciono hacer edicion para la primer forma!

Ahora para editar la forma de "Property Main Thumbnail Image Update"
```php
<form method="POST" action="{{ route('agent.update.property.thumbnail') }}" id="myForm" enctype="multipart/form-data"> 
```
En routes/web.php
```php
Route::post('/agent/update/property/thumbnail', 'AgentUpdatePropertyThumbnail')->name('agent.update.property.thumbnail'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
Copir metodo de app/Http/Controllers/Backend/PropertyController.php
Queda todo igual!

Ahora vamos a la forma de {{-- Property Multiple Image Update  --}}
```php
<form method="POST" action="{{ route('agent.update.property.multi-image') }}" id="myForm" enctype="multipart/form-data"> 
```
En routes/web.php
```php
Route::post('/agent/update/property/multi-image', 'AgentUpdatePropertyMultiImage')->name('agent.update.property.multi-image'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
Copir metodo de app/Http/Controllers/Backend/PropertyController.php
Queda todo igual!

Ahora completar el boton de Delete
```php
<td>
    <input type="submit" class="btn btn-primary px-4" value="Actualizar Imagen">
    <a href="{{ route('agent.delete.property.multi-image', $img->id) }}" class="btn btn-danger" id="delete">Borrar</a>
</td> 
```
En routes/web.php
```php
Route::get('/agent/delete/property/multi-image/{id}', 'AgentDeletePropertyMultiImage')->name('agent.delete.property.multi-image'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
Copir metodo de app/Http/Controllers/Backend/PropertyController.php
Queda todo igual!

Para la siguiente leccion vemos
- Añadir una multi imagen mas
- Actualizar Instalaciones Cercanas
Listo!
## 98. Add Property From Agent Part 4
Botón par añadir una multi imagen 
En resources/views/agent/property/edit_property.blade.php
```php
<form method="POST" action="{{ route('agent.store.new.multi-image') }}" id="myForm" enctype="multipart/form-data"> 
```
En routes/web.php
```php
Route::post('/agent/store/new/multi-image', 'AgentStoreNewMultiImage')->name('agent.store.new.multi-image') 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
Copir metodo de app/Http/Controllers/Backend/PropertyController.php
Queda todo igual!

Ahora para Actualizar Instalaciones Cercanas
En resources/views/agent/property/edit_property.blade.php
```php
<form method="POST" action="{{ route('agent.update.property.facilities') }}" id="myForm" enctype="multipart/form-data"> 
```
En routes/web.php
```php
Route::post('/agent/update/property/facilities', 'AgentUpdatePropertyFacilities')->name('agent.update.property.facilities'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
Copir metodo de app/Http/Controllers/Backend/PropertyController.php
Queda todo igual!

La siguiente leccion veremos implementar el boton ver los detalles.
Listo!
## 99. Add Property From Agent Part 5
Ver los detalles
En resources/views/agent/property/all_property.blade.php
```php
<a href="{{ route('agent.details.property',$item->id) }}" class="btn btn-inverse-info" title="Detalles"><i data-feather="eye"></i></a> 
```
En routes/web.php
```php
Route::get('/agent/details/property/{id}', 'AgentDetailsProperty')->name('agent.details.property'); 
```  
En app/Http/Controllers/Agent/AgentPropertyController.php
Copir metodo de app/Http/Controllers/Backend/PropertyController.php
Queda todo igual! solo remover activeAgent, y apuntar a una nueva pagina
```php
public function AgentDetailsProperty($id){
    ...
    return view('agent.property.details_property',compact('property','propertytype','amenities', 'property_ami', 'multiImage', 'facilities'));
} 
```
En resources/views/agent/property/details_property.blade.php
Copiarlo de resources/views/backend/property/details_property.blade.php
Y solo remover el if de Active Inactive que esta al final de la pagina
```php
@extends('agent.agent_dashboard')
@section('agent')
... 
```

Ahora implementar al boton de Delete (Eliminar Propiedad)
En resources/views/agent/property/all_property.blade.php
```php
<a href="{{ route('agent.delete.property',$item->id) }}" class="btn btn-inverse-danger" id="delete" title="Eliminar"><i data-feather="trash-2"></i></a> 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
Copir metodo de app/Http/Controllers/Backend/PropertyController.php
Queda todo igual!

Listo!
## 100. Update Add Property Amenities Fields
Vamos a cambiar lo que grabamos en el campo 'amenities_id' en la tabla 'properties'
porque nos conviene mas guardar los nombres.
En vez de insertar el id, vamos a insertar el nombre de la comodidad.
En resources/views/agent/property/add_property.blade.php
```php
{{-- Property Amenities --}}
<div class="col-sm-4">
    <label class="form-label text-warning">Comodidades</label>
    <select name="amenities_id[]" class="js-example-basic-multiple form-select" multiple="multiple" data-width="100%">
        @foreach($amenities as $ameni)
            <option value="{{ $ameni->amenities_name }}">{{ $ameni->amenities_name }}</option>
        @endforeach
    </select>
</div><!-- Col --> 
```
Tenemos tambien que actualizar nuestra pagina de edit en resources/views/agent/property/edit_property.blade.php
```php
{{-- Property Amenities --}}
<div class="col-sm-4">
    <label class="form-label text-warning">Comodidades</label>
    <select name="amenities_id[]" class="js-example-basic-multiple form-select" multiple="multiple" data-width="100%">
        @foreach($amenities as $ameni)
            <option value="{{ $ameni->amenities_name }}" {{ (in_array($ameni->amenities_name, $property_ami)) ? 'selected' : '' }}>{{ $ameni->amenities_name }}</option>
        @endforeach
    </select>
</div><!-- Col --> 
```

Y lo mismo tenemos que hacer para el area de admin.
En resources/views/backend/property/add_property.blade.php
```php
{{-- Property Amenities --}}
<div class="col-sm-4">
    <label class="form-label text-warning">Comodidades</label>
    <select name="amenities_id[]" class="js-example-basic-multiple form-select" multiple="multiple" data-width="100%">
        @foreach($amenities as $ameni)
            <option value="{{ $ameni->amenities_name }}">{{ $ameni->amenities_name }}</option>
        @endforeach
    </select>
</div><!-- Col --> 
```
Y en resources/views/backend/property/edit_property.blade.php
```php
{{-- Property Amenities --}}
<div class="col-sm-4">
    <label class="form-label text-warning">Comodidades</label>
    <select name="amenities_id[]" class="js-example-basic-multiple form-select" multiple="multiple" data-width="100%">
        @foreach($amenities as $ameni)
            <option value="{{ $ameni->amenities_name }}" {{ (in_array($ameni->amenities_name, $property_ami)) ? 'selected' : '' }}>{{ $ameni->amenities_name }}</option>
        @endforeach
    </select>
</div><!-- Col --> 
```
Listo!

# Sección 15 - Backend Agent Buy Packages Option
## 101. Design Buy Package Agent Dashboard
Compra de paquete del Agente
Vamos agregar un nuevo menu en el sidebar del agente
En resources/views/agent/body/sidebar.blade.php
```php
{{-- Comprar paquete --}}
<li class="nav-item">
    <a href="{{ route('buy.package') }}" class="nav-link">
        <i class="link-icon" data-feather="calendar"></i>
        <span class="link-title">Comprar Paquete</span>
    </a>
</li> 
```
En routes/web.php
```php
// Agent group middleware
Route::middleware(['auth','role:agent'])->group(function(){
    // Agent Grupo de Rutas (AgentPropertyController) - Propiedades
    ...

    // Agent Grupo de Rutas (AgentPropertyController) - Buy Package
    Route::controller(AgentPropertyController::class)->group(function(){
        Route::get('/buy/package', 'BuyPackage')->name('buy.package');
    });
}); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
```php
/**************************
 * Agente Buy Package
 **************************/

public function BuyPackage(){
return view('agent.package.buy_package');
} 
```
En resources/views/agent/package/buy_package.blade.php
Copiar de ~/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Backend Theme/Main/pages/general/pricing.html
Solo tomar el <div class="page-content">
Hacerle los cambios pertinentes!
```php
@extends('agent.agent_dashboard')
@section('agent')

<div class="page-content">


</div>

@endsection
```
Listo!
## 102. Agent Buy Package Option Part 1
Crear nuevo modelo con migracion
```php
php artisan make:model PackagePlan -m 
```
En app/Models/PackagePlan.php
```php
class PackagePlan extends Model
{
    use HasFactory;

    // Para que todos los campos sean fillables
    protected $guarded = [];

} 
```
En database/migrations/2023_06_12_104957_create_package_plans_table.php
```php
Schema::create('package_plans', function (Blueprint $table) {
    $table->id();

    $table->integer('user_id');
    $table->string('package_name')->nullable();
    $table->string('package_credits')->nullable();
    $table->string('package_amount')->nullable();

    $table->timestamps();
}); 
```
Hacer la migracion
```php
php artisan migrate 
```

En la tabla de 'users' hay que agregar un nuevo campo, con phpMyadmin
```php
Add 1 colum(s) after status [Go] 
Name: credit
Type: VARCHAR
Length: 255
Default: As define 0
Null: check

Save
```

Ahora vamos agregar que prueba el valor de 'credit' del user para saber
si puede agregar una propiedad.
En el metodo 'AgentStoreProperty' en app/Http/Controllers/Agent/AgentPropertyController.php
```php
Agregar...
use DB;

public function AgentStoreProperty(Request $request){

    $id = Auth::user()->id;
    $uid = User::findOrFail($id);
    $nid = $uid->credit;

    ...

    // Auto incrementar el campo 'credit' en la tabla de 'users'
    User::where('id',$id)->update([
        'credit' => DB::raw('1 + '. $nid),
    ]);

    ...
} 
```
Listo!
## 103. Agent Buy Package Option Part 2
Quitar del sidebar el menu de anadir propiedad
En resources/views/agent/body/sidebar.blade.php, quedarnos por lo pronto con solo "Lista Propiedades"
```php
<div class="collapse" id="property">
    <ul class="nav sub-menu">
        <li class="nav-item">
            <a href="{{ route('agent.all.property') }}" class="nav-link">Lista Propiedades</a>
        </li>

    </ul>
</div> 
```
Poner la condicion en el metodo 'AgentAddProperty' en app/Http/Controllers/Agent/AgentPropertyController.php
```php
public function AgentAddProperty(){

    $propertytype = PropertyType::latest()->get();
    $amenities = Amenities::latest()->get();

    $id = Auth::user()->id;
    $property = User::where('role','agent')->where('id',$id)->first();
    $pcount = $property->credit;
    // dd($pcount);

    if ($pcount == 1) {
        return redirect()->route('buy.package');
    }else{
        return view('agent.property.add_property',compact('propertytype','amenities'));
    }

} 
```

En resources/views/agent/package/buy_package.blade.php
```php
<div class="d-grid">
    <a href="{{ route('buy.business.plan') }}" class="btn btn-success mt-4">Empezar Ahora</a>
</div> 
``` 
En routes/web.php
```php
Route::get('/buy/business/plan', 'BuyBusinessPlan')->name('buy.business.plan'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
```php
//  Plan de Negocios
public function BuyBusinessPlan(){
$id = Auth::user()->id;
return view('agent.package.business_plan',compact('id'));
} 
```
En resources/views/agent/package/business_plan.blade.php
Cargar el template de ~/Sites/recursos/udemy/Laravel 10 - Build Real Estate Property Listing Project A-Z/Course+Excise+Files/Course Excise Files/Backend Theme/Main/pages/general/invoice.html, solo lo de "page-content"
```php
@extends('agent.agent_dashboard')
@section('agent')

<div class="page-content">
...
</div>

@endsection 
```
Listo!
## 104. Agent Buy Package Option Part 3
En app/Http/Controllers/Agent/AgentPropertyController.php
```php
//  Plan de Negocios
public function BuyBusinessPlan(){
$id = Auth::user()->id;
$data = User::findOrFail($id);
return view('agent.package.business_plan',compact('data'));
} 
```

En resources/views/agent/package/business_plan.blade.php
```php
@extends('agent.agent_dashboard')
@section('agent')


<div class="page-content">

    <nav class="page-breadcrumb">
        <ol class="breadcrumb">

        </ol>
    </nav>

    <div class="row">
        <div class="col-md-12">
            <div class="card">

                <form method="POST" action="{{ route('store.business.plan') }}">
                @csrf

                    <div class="card-body">

                        {{-- A nombre de quien el INVOICE --}}
                        <div class="container-fluid d-flex justify-content-between">
                            <div class="col-lg-3 ps-0">
                                <a href="#" class="noble-ui-logo logo-light d-block mt-3">Noble<span>UI</span></a>
                                <p class="mt-1 mb-1"><b>NobleUI Themes</b></p>
                                <p>108,<br> Great Russell St,<br>London, WC1B 3NA.</p>
                                <h5 class="mt-5 mb-2 text-muted">Invoice to :</h5>
                                <p>{{ $data->name }},<br> {{ $data->email }},<br>{{ $data->address }}.</p>
                            </div>
                            <div class="col-lg-3 pe-0">
                                <h4 class="fw-bolder text-uppercase text-end mt-4 mb-2">invoice</h4>
                                <h6 class="text-end mb-5 pb-4"></h6>
                                <p class="text-end mb-1">Balance Due</p>
                                <h4 class="text-end fw-normal">$ 20.00</h4>
                                <h6 class="mb-0 mt-3 text-end fw-normal mb-2"><span class="text-muted"> </span> </h6>

                            </div>
                        </div>

                        {{-- Tabla de productos del Invoice --}}
                        <div class="container-fluid mt-5 d-flex justify-content-center w-100">
                            <div class="table-responsive w-100">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Paquete</th>
                                            <th class="text-end">Cantidad</th>
                                            <th class="text-end">Costo Unitario</th>
                                            <th class="text-end">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        <tr class="text-end">
                                            <td class="text-start">1</td>
                                            <td class="text-start">Paquete Negocio</td>
                                            <td>3</td>
                                            <td>$20</td>
                                            <td>$20</td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {{-- Tabla de Total y Subtotal --}}
                        <div class="container-fluid mt-5 w-100">
                            <div class="row">
                                <div class="col-md-6 ms-auto">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <tbody>

                                                <tr>
                                                    <td>Sub Total</td>
                                                    <td class="text-end">$ 20.00</td>
                                                </tr>

                                                <tr>
                                                    <td class="text-bold-800">Total</td>
                                                    <td class="text-bold-800 text-end"> $ 20.00</td>
                                                </tr>

                                                <tr>
                                                    <td>Payment Made</td>
                                                    <td class="text-danger text-end">(-) $ 20.00</td>
                                                </tr>

                                                <tr class="bg-dark">
                                                    <td class="text-bold-800">Balance Due</td>
                                                    <td class="text-bold-800 text-end">$ 20.00</td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {{-- Botón Send Invoice --}}
                        <div class="container-fluid w-100">

                            <button type="submit" class="btn btn-primary float-end mt-4 ms-2">
                                <i data-feather="send" class="me-3 icon-md"></i>Mandar Recibo
                            </button>

                            <a href="javascript:;" class="btn btn-primary float-end mt-4 ms-2"><i data-feather="send"
                                    class="me-3 icon-md"></i>Mandar Recibo</a>
                            {{-- <a href="javascript:;" class="btn btn-outline-primary float-end mt-4"><i data-feather="printer"
                                    class="me-2 icon-md"></i>Imprimir</a> --}}
                        </div>

                    </div>

                </form>

            </div>
        </div>
    </div>
</div>

@endsection 
```

En routes/web.php
```php
Route::post('/store/business/plan', 'StoreBusinessPlan')->name('store.business.plan'); 
```

En app/Http/Controllers/Agent/AgentPropertyController.php
```php
//  Store Business Plan
public function StoreBusinessPlan(Request $request){

} 
```
Listo!
## 105. Agent Buy Package Option Part 4
Agregar un campo nuevo.
En database/migrations/2023_06_12_104957_create_package_plans_table.php
```php
$table->string('invoice')->nullable(); 
```
Nota:
Lo tenemos que agregar manual con phpMyadmin tambien!

En app/Http/Controllers/Agent/AgentPropertyController.php
```php
...
use App\Models\PackagePlan; 
...
//  Store Business Plan
public function StoreBusinessPlan(Request $request){

$id = Auth::user()->id;
$uid = User::findOrFail($id);
$nid = $uid->credit;

PackagePlan::insert([
    'user_id' => $id,
    'package_name' => 'Business',
    'package_credits' => '3',
    'invoice' => 'ERS'.mt_rand(10000000,99999999),
    'package_amount' => '20',
    'created_at' => Carbon::now(),
]);

// Auto incrementar el campo 'credit' en la tabla de 'users'
User::where('id',$id)->update([
    'credit' => DB::raw('3 + '. $nid),
]);

$notification = array(
    'message' => 'Haz comprado el paquete Negocio con éxito!',
    'alert-type' => 'success'
);
return redirect()->route('agent.all.property')->with($notification);
}
```
Y controlar el acceso con el metodo AgentAddProperty en app/Http/Controllers/Agent/AgentPropertyController.php
```php
public function AgentAddProperty(){

    $propertytype = PropertyType::latest()->get();
    $amenities = Amenities::latest()->get();

    $id = Auth::user()->id;
    $property = User::where('role','agent')->where('id',$id)->first();
    $pcount = $property->credit;
    // dd($pcount);

    if ($pcount == 1 || $pcount == 7) {
        return redirect()->route('buy.package');
    }else{
        return view('agent.property.add_property',compact('propertytype','amenities'));
    }

} 
```
Listo!
## 106. Agent Buy Package Option Part 5
Ahora vamos a implementar el codigo para el "paquete profesional"
En resources/views/agent/package/buy_package.blade.php
```php
<div class="d-grid">
    <a href="{{ route('buy.professional.plan') }}" class="btn btn-primary mt-4">Empezar Ahora</a>
</div> 
```
En routes/web.php
```php
Route::get('/buy/professional/plan', 'BuyProfessionalPlan')->name('buy.professional.plan'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
```php
//  Comprar Paquete Profesional - Buy Professional Plan
public function BuyProfessionalPlan(){
$id = Auth::user()->id;
$data = User::findOrFail($id);
return view('agent.package.professional_plan',compact('data'));
} 
```
En resources/views/agent/package/professional_plan.blade.php
copiarlo de resources/views/agent/package/business_plan.blade.php

Ruta para la forma en resources/views/agent/package/professional_plan.blade.php
```php
<form method="POST" action="{{ route('store.professional.plan') }}"> 
```
En routes/web.php
```php
Route::post('/store/professional/plan', 'StoreProfessionalPlan')->name('store.professional.plan'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
```php
//  Store professional Plan
public function StoreProfessionalPlan(Request $request){

    $id = Auth::user()->id;
    $uid = User::findOrFail($id);
    $nid = $uid->credit;

    PackagePlan::insert([
        'user_id' => $id,
        'package_name' => 'Professional',
        'package_credits' => '10',
        'invoice' => 'ERS'.mt_rand(10000000,99999999),
        'package_amount' => '50',
        'created_at' => Carbon::now(),
    ]);

    // Auto incrementar el campo 'credit' en la tabla de 'users'
    User::where('id',$id)->update([
        'credit' => DB::raw('10 + '. $nid),
    ]);

    $notification = array(
        'message' => 'Haz comprado el paquete Profesional con éxito!',
        'alert-type' => 'success'
    );
    return redirect()->route('agent.all.property')->with($notification);
} 
```
Listo!

# Sección 16 - Package Sales Report In Agent Dashboard With PDF
## 107. Package sales Report In Agent Dashboard Part 1
Crear otro menu en sidebar de agent titulado "historial de pagos"
En resources/views/agent/body/sidebar.blade.php
```php
{{-- Historial de Compras de Paquetes o Pagos --}}
<li class="nav-item">
    <a href="{{ route('package.history') }}" class="nav-link">
        <i data-feather="book-open"></i>
        <span class="link-title">Historial de Pagos</span>
    </a>
</li> 
```
En routes/web.php
```php
Route::get('/package/history', 'PackageHistory')->name('package.history'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
```php
//  Package History - Historial de Pagos
public function PackageHistory(){
$id = Auth::user()->id;
$packageHistory = PackagePlan::where('user_id',$id)->get();
return view('agent.package.package_history', compact('packageHistory'));
} 
```
En resources/views/agent/package/package_history.blade.php
Copiar de resources/views/agent/property/all_property.blade.php

Crear una realacion con user en app/Models/PackagePlan.php
```php
// Relación del campo 'user_id' con el 'id' de la tabla 'users'
public function user(){
    return $this->belongsTo(User::class,'user_id','id');
} 
```
En resources/views/agent/package/package_history.blade.php
```php
@extends('agent.agent_dashboard')
@section('agent')

<div class="page-content">

    <nav class="page-breadcrumb">
        <ol class="breadcrumb">
            <a href="{{ route('agent.add.property') }}" class="btn btn-inverse-info">Añadir Propiedad</a>
        </ol>
    </nav>

    <div class="row">
        <div class="col-md-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">Historial de Compras</h6>
                    <div class="table-responsive">
                        <table id="dataTableExample" class="table">

                            <thead>

                                <tr>
                                    <th>Serie</th>
                                    <th>Imagen</th>
                                    <th>Paquete</th>
                                    <th>Recibo</th>
                                    <th>Cantidad</th>
                                    <th>Fecha</th>
                                    <th>Acción</th>
                                </tr>

                            </thead>

                            <tbody>

                                @foreach ($packageHistory as $key => $item)
                                <tr>
                                    <td>{{ $key+1 }}</td>
                                    <td><img src="{{ (!empty($item->user->photo)) ? url('upload/agent_images/'.$item->user->photo) : url('upload/no_image.jpg') }}" style="width: 70px; height: 40px;"></td>
                                    <td>{{ $item->package_name }}</td>
                                    <td>{{ $item->invoice }}</td>
                                    <td>{{ $item->package_amount }}</td>
                                    <td>{{ $item->created_at->format('d M Y') }} ({{ __($item->created_at->format('l')) }})</td>

                                    <td>

                                        <a href="{{ route('agent.edit.property',$item->id) }}" class="btn btn-inverse-warning" title="Editar"><i data-feather="edit"></i></a>

                                    </td>

                                </tr>
                                @endforeach

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

@endsection 
```
Listo!
## 108. Package sales Report In Agent Dashboard Part 2
Crear un documento PDF de descarga.
Vamos a usar un Wrapper de Laravel. 
DOMPDF Wrapper for Laravel (https://github.com/barryvdh/laravel-dompdf)
Require this package in your composer.json and update composer. This will download the package and the dompdf + fontlib libraries also.
```php
composer require barryvdh/laravel-dompdf 
```
The defaults configuration settings are set in config/dompdf.php. Copy this file to your own config directory to modify the values. You can publish the config using this command:
```php
php artisan vendor:publish --provider="Barryvdh\DomPDF\ServiceProvider" 
```

En resources/views/agent/package/package_history.blade.php
```php
<td>
    <a href="{{ route('agent.package.invoice',$item->id) }}" class="btn btn-inverse-warning" title="Descargar"><i data-feather="download"></i></a>
</td> 
``` 
En routes/web.php
```php
Route::get('/agent/package/invoice/{id}', 'AgentPackageInvoice')->name('agent.package.invoice'); 
```
En app/Http/Controllers/Agent/AgentPropertyController.php
```php
...
use Barryvdh\DomPDF\Facade\Pdf;
...
//  Agent Package Invoice - Descargar Recibo en PDF
public function AgentPackageInvoice($id){
    $packageHistory = PackagePlan::where('id', $id)->first();

    // Convertir la Vista a PDF con el paquete pdf que ya instalamos
    $pdf = Pdf::loadView('agent.package.package_history_invoice', compact('packageHistory'))->setPaper('a4')->setOption([
        'tempDir' => public_path(),
        'chroot' => public_path()
    ]);
    return $pdf->download('recibo.pdf');
} 
```
Listo!
## 109. Package sales Report In Agent Dashboard Part 3
Vamos a usar un template de Invoice Html en resources/views/agent/package/package_history_invoice.blade.php
```php
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Invoice</title>

    <style type="text/css">
        * {
            font-family: Verdana, Arial, sans-serif;
        }

        table {
            font-size: x-small;
        }

        tfoot tr td {
            font-weight: bold;
            font-size: x-small;
        }

        .gray {
            background-color: lightgray
        }

        .font {
            font-size: 15px;
        }

        .authority {
            /*text-align: center;*/
            float: right
        }

        .authority h5 {
            margin-top: -10px;
            color: green;
            /*text-align: center;*/
            margin-left: 35px;
        }

        .thanks p {
            color: green;
            ;
            font-size: 16px;
            font-weight: normal;
            font-family: serif;
            margin-top: 20px;
        }
    </style>

</head>

<body>

    <table width="100%" style="background: #F7F7F7; padding:0 20px 0 20px;">

        <tr>
            <td valign="top">
                <!-- {{-- <img src="" alt="" width="150"/> --}} -->
                <h2 style="color: green; font-size: 26px;"><strong>Recibo: {{ $packageHistory->invoice }}</strong></h2>
            </td>
            <td align="right">
                <pre class="font">
                    Fotos Oficiales
                    Email:fotosoficialest@fotos.com
                    Cel: 664-188-0604
                    Av. Playas de Tijuana 1207
                    Tijuana BC
                </pre>
            </td>
        </tr>

    </table>


    <table width="100%" style="background:white; padding:2px;"></table>

    <table width="100%" style="background: #F7F7F7; padding:0 5 0 5px;" class="font">
        <tr>
            <td>
                <p class="font" style="margin-left: 20px;">
                    <strong>Name:</strong> {{ $packageHistory->user->name }} <br>
                    <strong>Email:</strong> {{ $packageHistory->user->email }} <br>
                    <strong>Phone:</strong> {{ $packageHistory->user->phone }} <br>
                    <strong>Address:</strong>{{ $packageHistory->user->address }}
                </p>
            </td>
            <td>
                <p class="font" style="margin-left: 20px;">
                    <strong><span style="color: green;">Recibo:</span></strong>{{ $packageHistory->invoice }}<br>
                    <strong>Fecha:</strong> {{ $packageHistory->created_at }}<br>
                    <strong>Tipo de Pago:</strong>COD<br>
                </p>
                {{-- <pre class="font">
                    <h3><span style="color: green;">Recibo:</span> #{{ $packageHistory->invoice }}</h3>
                    Fecha: {{ $packageHistory->created_at }}
                    Tipo de Pago: COD
                </pre> --}}
                {{-- <p class="font">
                    <h3><span style="color: green;">Recibo:</span> #{{ $packageHistory->invoice }}</h3>
                    Fecha: {{ $packageHistory->created_at }} <br>
                    Tipo de Pago: COD </span>
                </p> --}}
            </td>
        </tr>
    </table>

    <br />

    <h3>Paquetes Adquiridos</h3>

    <table width="100%">
        <thead style="background-color: green; color:#FFFFFF;">
            <tr class="font">
                <th>Nombre</th>
                <th class="text-end">Cantidad</th>
                <th class="text-end">Costo Unitario</th>
                <th class="text-end">Total</th>
            </tr>
        </thead>
        <tbody>
            <tr class="font">
                <td align="center">{{ $packageHistory->package_name }}</td>
                <td align="center">{{ $packageHistory->package_credits }}</td>
                <td align="center">$ {{ $packageHistory->package_amount }}</td>
                <td align="center">$ {{ $packageHistory->package_amount }}</td>
            </tr>
        </tbody>
    </table>


    <div class="thanks mt-3">
        <p>Gracias por su compra..!!</p>
    </div>
    <div class="authority float-right mt-5">
        <p>-----------------------------------</p>
        <h5>Firma de Aprobación:</h5>
    </div>
</body>

</html>
```
Listo!
# Sección 17 - Package Sales Report In Admin Dashboard With PDF
## 110. Package Sales Report In Admin Dashboard Part 1
En resources/views/admin/body/sidebar.blade.php
```php
{{-- Historial de Pagos --}}
<li class="nav-item">
    <a href="{{ route('admin.package.history') }}" class="nav-link">
        {{-- <i class="link-icon" data-feather="calendar"></i> --}}
        <i data-feather="book-open"></i>
        <span class="link-title">Historial de Pagos</span>
    </a>
</li> 
```
En routes/web.php
```php
// Property All Routes
Route::controller(PropertyController::class)->group(function(){
    ...
    Route::get('/admin/package/history', 'AdminPackageHistory')->name('admin.package.history');
}); 
```
En app/Http/Controllers/Backend/PropertyController.php
```php
...
use App\Models\PackagePlan;
use Barryvdh\DomPDF\Facade\Pdf;
...
// Admin Package History
public function AdminPackageHistory(){
    $packageHistory = PackagePlan::latest()->get();
    return view('backend.package.package_history', compact('packageHistory'));
}
```
En resources/views/backend/package/package_history.blade.php
Copiarlo de resources/views/agent/package/package_history.blade.php

Agregarle nombre a la tabla, tiene ya una relacion con user asi que podemos desplegarlo asi:
En resources/views/backend/package/package_history.blade.php
```php
<td>{{ $item['user']['name'] }}</td> 
```
Listo!
## 111. Package Sales Report In Admin Dashboard Part 2
Descargar PDF desde Admin
En resources/views/backend/package/package_history.blade.php
```php
<td>
    <a href="{{ route('admin.package.invoice',$item->id) }}" class="btn btn-inverse-warning" title="Descargar"><i data-feather="download"></i></a>
</td> 
```
En routes/web.php
```php
Route::get('/admin/package/invoice/{id}', 'AdminPackageInvoice')->name('admin.package.invoice'); 
```
En app/Http/Controllers/Backend/PropertyController.php
```php
// Admin Package Invoice - Descargar PDF desde Admin
public function AdminPackageInvoice($id){
    $packageHistory = PackagePlan::where('id', $id)->first();

    // Convertir la Vista a PDF con el paquete pdf que ya instalamos
    $pdf = Pdf::loadView('backend.package.package_history_invoice', compact('packageHistory'))->setPaper('a4')->setOption([
        'tempDir' => public_path(),
        'chroot' => public_path()
    ]);
    return $pdf->download('recibo.pdf');
} 
```
La vista resources/views/backend/package/package_history_invoice.blade.php
Copiarla de resources/views/agent/package/package_history_invoice.blade.php
Listo!

# Sección 18 - Display Property Type In Frontend
## 112. Show Property Type In Frontend Part 1
Empezamos por hacer dinamica el segmento de resources/views/frontend/home/category.blade.php
```php
@php
    $propertyType = App\Models\PropertyType::latest()->limit(5)->get(); //limitado a 5 datos
@endphp

<!-- category-section -->
<section class="category-section centred">
    <div class="auto-container">
        <div class="inner-container wow slideInLeft animated" data-wow-delay="00ms" data-wow-duration="1500ms">
            <ul class="category-list clearfix">

            @foreach ($propertyType as $item)
                <li>
                    <div class="category-block-one">
                        <div class="inner-box">
                            <div class="icon-box"><i class="{{ $item->type_icon }}"></i></div>
                            <h5><a href="property-details.html">{{ $item->type_name }}</a></h5>
                            <span>52</span>
                        </div>
                    </div>
                </li>
            @endforeach

            </ul>
            <div class="more-btn"><a href="categories.html" class="theme-btn btn-one">All Categories</a></div>
        </div>
    </div>
</section>
<!-- category-section end --> 
```
Listo!
## 113. Show Property Type In Frontend Part 2
Ahora vamos a contar cuantas tipos de propiedades tenemos en la tabla 'properties'
Tenemos que contar las veces que es igual en el campo 'pttpe_id'
En resources/views/frontend/home/category.blade.php
```php
...
@foreach ($propertyType as $item)
@php
    $property = App\Models\Property::where('ptype_id',$item->id)->get();
@endphp
    <li>
        <div class="category-block-one">
            <div class="inner-box">
                <div class="icon-box"><i class="{{ $item->type_icon }}"></i></div>
                <h5><a href="property-details.html">{{ $item->type_name }}</a></h5>
                <span>{{ count($property) }}</span>
            </div>
        </div>
    </li>
@endforeach 
...
```
Listo!

# Sección 19 - Display Features Property In Frontend 
## 114. Show Features Property In Frontend Part 1
En resources/views/frontend/home/feature.blade.php
```php
@php
    $property = App\Models\Property::where('status','1')->where('featured','1')->limit(3)->get();
@endphp


<!-- feature-section -->
<section class="feature-section sec-pad bg-color-1">
    <div class="auto-container">
        <div class="sec-title centred">
            {{-- <h5>Features</h5> --}}
            <h5>Populares</h5>
            <h2>Propiedades Populares</h2>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing sed do eiusmod tempor incididunt <br />labore
                dolore magna aliqua enim.</p>
        </div>
        <div class="row clearfix">

        @foreach ($property as $item)

            <div class="col-lg-4 col-md-6 col-sm-12 feature-block">
                <div class="feature-block-one wow fadeInUp animated" data-wow-delay="00ms"
                    data-wow-duration="1500ms">
                    <div class="inner-box">
                        <div class="image-box">
                            <figure class="image"><img src="{{ asset($item->property_thambnail) }}" alt="">
                            </figure>
                            <div class="batch"><i class="icon-11"></i></div>
                            <span class="category">Popular</span>
                        </div>
                        <div class="lower-content">
                            <div class="author-info clearfix">
                                <div class="author pull-left">
                                    <figure class="author-thumb"><img src="{{ asset('frontend/assets/images/feature/author-1.jpg') }}"
                                            alt=""></figure>
                                    <h6>Michael Bean</h6>
                                </div>
                                <div class="buy-btn pull-right"><a href="property-details.html">For {{ $item->property_status }}</a>
                                </div>
                            </div>
                            <div class="title-text">
                                <h4><a href="property-details.html">{{ $item->property_name }}</a></h4>
                            </div>
                            <div class="price-box clearfix">
                                <div class="price-info pull-left">
                                    <h6>Inicia desde</h6>
                                    <h4>$ {{ $item->lowest_price }}</h4>
                                </div>
                                <ul class="other-option pull-right clearfix">
                                    <li><a href="property-details.html"><i class="icon-12"></i></a></li>
                                    <li><a href="property-details.html"><i class="icon-13"></i></a></li>
                                </ul>
                            </div>
                            <p>{{ $item->short_descp }}</p>
                            <ul class="more-details clearfix">
                                <li><i class="icon-14"></i>{{ $item->bedrooms }} Cuartos</li>
                                <li><i class="icon-15"></i>{{ $item->bathrooms }} Baños</li>
                                <li><i class="icon-16"></i>{{ $item->property_size }} m²</li>
                            </ul>
                            <div class="btn-box"><a href="property-details.html" class="theme-btn btn-two">Ver Detalles</a></div>
                        </div>
                    </div>
                </div>
            </div>

        @endforeach

        </div>
        <div class="more-btn centred"><a href="property-list.html" class="theme-btn btn-one">View All
                Listing</a></div>
    </div>
</section>
<!-- feature-section end --> 
```
Listo!
## 115. Show Features Property In Frontend Part 2
En resources/views/frontend/home/feature.blade.php
```php
@if ($item->agent_id == Null)
    <figure class="author-thumb"><img src="{{ url('upload/admin.png') }}" alt=""></figure>
    <h6>Admin</h6>
@else
    <figure class="author-thumb"><img src="{{ (!empty($item->user->photo)) ? url('upload/agent_images/'.$item->user->photo) : url('upload/no_image.jpg') }}" alt=""></figure>
    <h6>{{ $item->user->name }}</h6>
@endif 
```
Listo!

# Sección 20 - Setup Property Details Page 
## 116. Setup Property Details Page Part 1
En resources/views/frontend/home/feature.blade.php
```php
{{-- botón ver detalles --}}
<div class="btn-box">
    <a href="{{ url('property/details/'.$item->id.'/'.$item->property_slug) }}" class="theme-btn btn-two">Ver Detalles</a>
</div> 
```
Crear nuevo controlador.
```php
php artisan make:controller Frontend/IndexController
```
En routes/web.php
```php
/******************
* Acceso para todos
*******************/
...
// Frontend Property Details All Routes (IndexController)
Route::get('/property/details/{id}/{slug}', [IndexController::class, 'PropertyDetails']); 
```
En app/Http/Controllers/Frontend/IndexController.php
```php
<?php

namespace App\Http\Controllers\Frontend;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

use App\Models\Property;
use App\Models\MultiImage;
use App\Models\Facility;
use App\Models\Amenities;
use App\Models\PropertyType;
use App\Models\User;
use App\Models\PackagePlan;


class IndexController extends Controller
{

    // PropertyDetails - Detalle de la Propiedad
    public function PropertyDetails($id, $slug){
        return view('frontend.property.property_details');
    }

}
```
En resources/views/frontend/property/property_details.blade.php
```php
@extends('frontend.frontend_dashboard')
@section('main')


@endsection 
```
Listo!
## 117. Setup Property Details Page Part 2
En app/Http/Controllers/Frontend/IndexController.php
```php
// PropertyDetails - Detalle de la Propiedad
public function PropertyDetails($id, $slug){
    $property = Property::findOrFail($id);
    $multiImage = MultiImage::where('property_id',$id)->get();
    return view('frontend.property.property_details', compact('property', 'multiImage'));
} 
```
Empezamos por pasar algunos datos a resources/views/frontend/property/property_details.blade.php
```php
...
<div class="content-box clearfix">
    <h1>Detalles de la Propiedad</h1>
    <ul class="bread-crumb clearfix">
        {{-- <li><a href="index.html">Home</a></li> --}}
        <li>{{ $property->property_name }}</li>
    </ul>
</div>
...
{{-- Titulo de la Propiedad y Agente mas estrellas de calificación --}}
<div class="left-column pull-left clearfix">
    <h3>{{ $property->property_name }}</h3>
    <div class="author-info clearfix">
        <div class="author-box pull-left">

            @if ($property->agent_id == Null)
                <figure class="author-thumb"><img src="{{ url('upload/admin.png') }}" alt=""></figure>
                <h6>Admin</h6>
            @else
                <figure class="author-thumb"><img src="{{ (!empty($property->user->photo)) ? url('upload/agent_images/'.$property->user->photo) : url('upload/no_image.jpg') }}" alt=""></figure>
                <h6>{{ $property->user->name }}</h6>
            @endif

        </div>
        <ul class="rating clearfix pull-left">
            <li><i class="icon-39"></i></li>
            <li><i class="icon-39"></i></li>
            <li><i class="icon-39"></i></li>
            <li><i class="icon-39"></i></li>
            <li><i class="icon-40"></i></li>
        </ul>
    </div>
</div>
...
<div class="price-inner clearfix">
    <ul class="category clearfix pull-left">
        <li><a href="property-details.html">{{ $property->type->type_name }}</a></li>
        <li><a href="property-details.html">Para {{ $property->property_status }}</a></li>
    </ul>
    <div class="price-box pull-right">
        <h3>${{ $property->lowest_price }}</h3>
    </div>
</div>
...
{{-- Display Multi Images en Carousel --}}
<div class="carousel-inner">
    <div class="single-item-carousel owl-carousel owl-theme owl-dots-none">
        @foreach ($multiImage as $image)
            <figure class="image-box"><img src="{{ asset($image->photo_name) }}" alt=""></figure>
        @endforeach
    </div>
</div>
...
```
Listo!
## 118. Setup Property Details Page Part 3
En app/Http/Controllers/Frontend/IndexController.php
```php
// PropertyDetails - Detalle de la Propiedad
public function PropertyDetails($id, $slug){

    $property = Property::findOrFail($id);

    $amenities = $property->amenities_id;
    $property_amenities = explode(',',$amenities);

    $multiImage = MultiImage::where('property_id',$id)->get();

    return view('frontend.property.property_details', compact('property', 'multiImage', 'property_amenities'));
} 
```
En resources/views/frontend/property/property_details.blade.php
```php
{{-- Property Description --}}
...
{{-- Property Details, ID, Rooms, Garage etc... --}}
...
{{-- Amenities --}}
...
{{-- Location google-map-area --}} 
...
```
Listo!
## 119. Setup Property Details Page Part 4
Implemetar el mapa de google
Insertar el google map script antes de main-js al final en mis dos templates.
resources/views/frontend/frontend_dashboard.blade.php y 
resources/views/frontend/frontend_dashboard_no_preload.blade.php
```php
...
<!-- map script -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-CE0deH3Jhj6GN4YvdCFZS7DpbXexzGU"></script>
<script src="{{ asset('frontend/assets/js/gmaps.js') }}"></script>
<script src="{{ asset('frontend/assets/js/map-helper.js') }}"></script>

<!-- main-js -->
<script src="{{ asset('frontend/assets/js/script.js') }}"></script> 
```
Y en resources/views/frontend/property/property_details.blade.php
```php
{{-- google-map-area --}}
<div class="google-map-area">
    <div class="google-map" id="contact-google-map"
        data-map-lat="{{ $property-> latitude }}"
        data-map-lng="{{ $property-> longitude }}"
        data-icon-path="{{ asset('frontend/assets/images/icons/map-marker.png') }}"
        data-map-title="Iglesia Estrella del Mar, Playas de Tijuana" data-map-zoom="12"
        data-markers='{
            "marker-1":
            [32.524690, -117.120030,
            "<h4>Iglesia Estrella del Mar</h4><p>Playas de Tijuana</p>",
            "{{ asset('frontend/assets/images/icons/map-marker.png') }}"]
        }'>
    </div>
    {{-- botón ver en google maps --}}
    <div class="btn-box mt-2" >
        <a href="{{ url('/google/maps/'.$property-> latitude.'/'.$property-> longitude) }}" class="theme-btn btn-two" target="_blank">Ver en Google Maps</a>

        <a href="{{ url('/google/maps/'.$property->latitude.'/'.$property->longitude.'/'.$property->google_map) }}" class="theme-btn btn-two">Ver en Google Maps</a>

    </div>
</div> 
```
En routes/web.php
```php
// Frontend Property Details All Routes (IndexController)
Route::get('/property/details/{id}/{slug}', [IndexController::class, 'PropertyDetails']);
Route::get('/google/maps/{latitude}/{longitude}', [IndexController::class, 'VerEnGoogleMaps']); 
```
En app/Http/Controllers/Frontend/IndexController.php
```php
// PropertyDetails - Detalle de la Propiedad
public function PropertyDetails($id, $slug){

    $property = Property::findOrFail($id);

    $amenities = $property->amenities_id;
    $property_amenities = explode(',',$amenities);

    $multiImage = MultiImage::where('property_id',$id)->get();
    $facility = Facility::where('property_id',$id)->get();

    return view('frontend.property.property_details', compact('property', 'multiImage', 'property_amenities', 'facility'));
}

// Ver en Google Maps
// "http://maps.google.com/?q=[lat],[long]"
// "http://maps.google.com/?q=32.524690,-117.120030"
// por vinculo: https://goo.gl/maps/eK8L7DbqUzmnqcbw9
public function VerEnGoogleMaps($latitude, $longitude){
    // return Redirect::to('https://goo.gl/maps/eK8L7DbqUzmnqcbw9');
    $mapa1 = 'https://goo.gl/maps/eK8L7DbqUzmnqcbw9';
    // $mapa = 'http://maps.google.com/?q='.$latitude.','.$longitude;
    return Redirect::to($mapa1);
    // Cualquiera de los dos me funciona $mapa1 o $map
} 
```
En resources/views/frontend/property/property_details.blade.php
```php
...
{{-- Botón Ver en Google Maps --}}
<div class="btn-box m-2" >
    <a href="{{ url('/google/maps/'.$property->latitude.'/'.$property->longitude) }}" class="theme-btn btn-two" target="_blank">Ver en Google Maps</a>
</div>

@if ($property->google_map !== Null)
    {{-- link con iframe --}}
    <iframe src="https://www.google.com/maps/embed?pb=!1m17!1m12!1m3!1d3363.962744026947!2d-117.11778768482424!3d32.52714198104826!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zMzLCsDMxJzM3LjciTiAxMTfCsDA2JzU2LjIiVw!5e0!3m2!1ses-419!2smx!4v1686880226544!5m2!1ses-419!2smx" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
@endif 
...
{{-- Video Link --}}
<div class="statistics-box content-widget">
    <div class="title-box">
        <h4>Video</h4>
    </div>
    <figure class="image-box">
        <iframe width="700" height="415" src="{{ $property->property_video }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    </figure>
</div>
...
```
Para copiar el iframe tenemos ue ir a la parte de compartir video y escoger incrustar!
Listo!
## 120. Setup Property Details Page Part 5
En resources/views/frontend/property/property_details.blade.php
```php
{{-- Caja del Agente, Nombre, Dirección, Teléfono --}}
<div class="author-box">

    @if ($property->agent_id == Null)
        <figure class="author-thumb"><img src="{{ url('upload/admin.png') }}" alt="">
        </figure>
        <div class="inner">
            <h4>Admin</h4>
            <ul class="info clearfix">
                <li><i class="fas fa-map-marker-alt"></i>Dirección de Admin Estática</li>
                <li><i class="fas fa-phone"></i><a href="tel:03030571965">030 3057 1965 (Estático)</a></li>
            </ul>
            <div class="btn-box"><a href="agents-details.html">Lista de Propiedades</a></div>
        </div>
    @else
        <figure class="author-thumb"><img src="{{ (!empty($property->user->photo)) ? url('upload/agent_images/'.$property->user->photo) : url('upload/no_image.jpg') }}" alt="">
        </figure>
        <div class="inner">
            <h4>{{ $property->user->name }}</h4>
            <ul class="info clearfix">
                <li><i class="fas fa-map-marker-alt"></i>{{ $property->user->address }}</li>
                <li><i class="fas fa-phone"></i><a href="tel:03030571965">{{ $property->user->phone }}</a></li>
            </ul>
            <div class="btn-box"><a href="agents-details.html">Lista de Propiedades</a></div>
        </div>
    @endif

</div> 
```
Listo!
## 121. Setup Property Details Related Page
Propiedades similares.
Preparamos datos para las propiedades similares, en app/Http/Controllers/Frontend/IndexController.php
```php
$type_id = $property->ptype_id;
$relatedProperty = Property::where('ptype_id',$type_id)->where('id','!=',$id)->orderBy('id','DESC')->limit(3)->get();

return view('frontend.property.property_details', compact('property', 'multiImage', 'property_amenities', 'facility','relatedProperty'));
```
Ahora en la vista resources/views/frontend/property/property_details.blade.php
```php
{{-- Propiedades Similares --}}
...
```
Listo!

# Sección 21 - Setup Property Wishlist Option
## 122. Property Wishlist Setup Part 1
Whish List, Lista de Deseos
Vamos a crear otro controlador y tabla para almacenar los favoritos.
```php
php artisan make:controller Frontend/WishlistController 
```
Crear Mpdelo y tabla de migracion:
```php
php artisan make:model Wishlist -m 
```
Que sen fillable los campos de la tabla en app/Models/Wishlist.php
```php
// Para que todos los campos sean fillables
protected $guarded = []; 
```
Agregamos campos a la tabla database/migrations/2023_06_17_120222_create_wishlists_table.php
```php
Schema::create('wishlists', function (Blueprint $table) {
    $table->id();

    $table->unsignedBigInteger('user_id');
    $table->unsignedBigInteger('property_id');

    $table->timestamps();
}); 
```
Hacemos la migracion:
```php
php artisan migrate 
```
Preparar el boton en resources/views/frontend/home/feature.blade.php
```php
{{-- botón añadir a favoritos --}}
<li>
    <a aria-label="Añadir a Deseo" class="action-btn" id="{{ $item->id }}" onclick="addToWishList(this.id)">
        <i class="icon-13"></i>
    </a>
</li>
```    

Y la funcion JS en resources/views/frontend/frontend_dashboard.blade.php
```php
<head>
   ...
    {{-- Para soportar el csrf token en la función de JS, Ver al final, Añadir a Lista de Favoritos, add to wishlist --}}
    <meta name="csrf-token" content="{{ csrf_token() }}" > 
    ...
</head>

<body>
    ...

    {{-- Añadir a Lista de Favoritos, add to wishlist --}}
    <script type="text/javascript">

        // Soportar el csrf token
        $.ajaxSetup({
            headers:{
                'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')
            }
        })

        // Función para añadir a lista de favoritos, viene de resources/views/frontend/home/feature.blade.php
        function addToWishList(property_id){

        }

    </script>
</body>
```
En la siguiente clase seguimo con la funcion
Listo!
## 123. Property Wishlist Setup Part 2
Funcion de JS
En resources/views/admin/admin_dashboard.blade.php
```php
{{-- Plugin for sweet alert 2 --}}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

{{-- Añadir a Lista de Favoritos, add to wishlist --}}
<script type="text/javascript">

    // Soportar el csrf token
    $.ajaxSetup({
        headers:{
            'X-CSRF-TOKEN':$('meta[name="csrf-token"]').attr('content')
        }
    })

    // Función para añadir a lista de favoritos, viene de resources/views/frontend/home/feature.blade.php
    function addToWishList(property_id){

        $.ajax({

            type: "POST",
            dataType: 'json',
            url: "/add-to-wishList/"+property_id,

            // Si hay datos json data se llena de info, entonces manda un mensaje de éxito! (data.success)
            // O si hay error, también el toaster message despliega el mensaje de error. (data.error)
            success:function(data){

                // Start Toaster Message
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',

                    showConfirmButton: false,
                    timer: 3000
                })

                if ($.isEmptyObject(data.error)) {
                    Toast.fire({
                        type: 'success',
                        icon: 'success',
                        title: data.success,
                    })
                }else{
                    Toast.fire({
                        type: 'error',
                        icon: 'error',
                        title: data.error,
                    })
                }
                // End Toaster Message

            }

        })

    }

</script> 
```
No olvidar soportar el Plugin for sweet alert 2, en la pagina para poder desplegar los mensajes.

Ahora soportar en nuestras rutas la liga que dimos "/add-to-wishList/"
En routes/web.php
```php
// Para Wishlist
Route::post('/add-to-wishList/{property_id}', [WishlistController::class, 'AddToWishList']); 
```

En app/Http/Controllers/Frontend/WishlistController.php
```php
<?php

namespace App\Http\Controllers\Frontend;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

use App\Models\Property;
use App\Models\MultiImage;
use App\Models\Facility;
use App\Models\Amenities;
use App\Models\PropertyType;
use App\Models\User;
use App\Models\PackagePlan;
use Redirect;

class WishlistController extends Controller
{
    // Añadir a Lista de Deseos
    public function AddToWishList(Request $request, $property_id){

    }
} 
```
Listo!
## 124. Property Wishlist Setup Part 3
El usuario tiene que estar Login para poder guardar al WishList
En app/Http/Controllers/Frontend/WishlistController.php
```php
public function AddToWishList(Request $request, $property_id){

    if (Auth::check()) {
        $exists = Wishlist::where('user_id', Auth::id())->where('property_id', $property_id)->first();

        if (!$exists) {
            Wishlist::insert([
                'user_id' => Auth::id(),
                'property_id' => $property_id,
                'created_at' => Carbon::now(),
            ]);
            return response()->json(['success' => 'Se añadió con éxito a tu lista de deseos!']);
        }
        else{
            return response()->json(['error' => 'Esta propiedad ya esta en tu lista de deseos!']);
        }

    }else{
        return response()->json(['error' => 'Primero inicie sesión!']);
    }

} 
```
Listo!
## 125. Property Wishlist Setup Part 4







## 126. Property Wishlist Setup Part 5
## 127. Property Wishlist Setup Part 6
## 128. Property Wishlist Setup Part 7

